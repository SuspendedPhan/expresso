{"remainingRequest":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/babel-loader/lib/index.js!/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/Attribute.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/Attribute.vue","mtime":1714946187069},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/babel.config.js","mtime":1714946187052},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/babel-loader/lib/index.js","mtime":1714947394795},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js","mtime":1714947393584}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9pbml0aWFsaXplckRlZmluZVByb3BlcnR5IGZyb20gIi9Vc2Vycy9keWxhbi5waGFuL3N0dWZmL2V4cHItZXhwbG9yYXRpb25zL2V4cHJlc3NvL2pzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbml0aWFsaXplckRlZmluZVByb3BlcnR5LmpzIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICIvVXNlcnMvZHlsYW4ucGhhbi9zdHVmZi9leHByLWV4cGxvcmF0aW9ucy9leHByZXNzby9qcy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkuanMiOwppbXBvcnQgX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvciBmcm9tICIvVXNlcnMvZHlsYW4ucGhhbi9zdHVmZi9leHByLWV4cGxvcmF0aW9ucy9leHByZXNzby9qcy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yLmpzIjsKaW1wb3J0IF9pbml0aWFsaXplcldhcm5pbmdIZWxwZXIgZnJvbSAiL1VzZXJzL2R5bGFuLnBoYW4vc3R1ZmYvZXhwci1leHBsb3JhdGlvbnMvZXhwcmVzc28vanMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaXRpYWxpemVyV2FybmluZ0hlbHBlci5qcyI7CnZhciBfZGVjLCBfZGVjMiwgX2RlYzMsIF9kZWM0LCBfZGVjNSwgX2NsYXNzLCBfY2xhc3MyLCBfZGVzY3JpcHRvciwgX2Rlc2NyaXB0b3IyOwppbXBvcnQgVnVlIGZyb20gInZ1ZSI7CmltcG9ydCBDb21wb25lbnQgZnJvbSAidnVlLWNsYXNzLWNvbXBvbmVudCI7CmltcG9ydCB7IFByb3AsIFdhdGNoIH0gZnJvbSAidnVlLXByb3BlcnR5LWRlY29yYXRvciI7CmltcG9ydCBSb290IGZyb20gIi4uL3N0b3JlL1Jvb3QiOwppbXBvcnQgTm9kZVBpY2tlciBmcm9tICIuL05vZGVQaWNrZXIiOwppbXBvcnQgSW5saW5lSW5wdXQgZnJvbSAiLi9JbmxpbmVJbnB1dCI7CmltcG9ydCBRdWlsbCBmcm9tICJxdWlsbCI7CmltcG9ydCBBdHRyaWJ1dGVNb2RlbCBmcm9tICJAL21vZGVscy9BdHRyaWJ1dGUiOwpsZXQgQXR0cmlidXRlID0gKF9kZWMgPSBDb21wb25lbnQoewogIGNvbXBvbmVudHM6IHsKICAgIE5vZGVQaWNrZXIsCiAgICBJbmxpbmVJbnB1dAogIH0KfSksIF9kZWMyID0gUHJvcCgpLCBfZGVjMyA9IFByb3AoKSwgX2RlYzQgPSBXYXRjaCgicGlja2luZyIpLCBfZGVjNSA9IFdhdGNoKCJwZW4uc2VsZWN0aW9uIiksIF9kZWMoX2NsYXNzID0gKF9jbGFzczIgPSBjbGFzcyBBdHRyaWJ1dGUgZXh0ZW5kcyBWdWUgewogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKC4uLmFyZ3MpOwogICAgX2luaXRpYWxpemVyRGVmaW5lUHJvcGVydHkodGhpcywgImFzdE5vZGUiLCBfZGVzY3JpcHRvciwgdGhpcyk7CiAgICBfaW5pdGlhbGl6ZXJEZWZpbmVQcm9wZXJ0eSh0aGlzLCAiYXR0cmlidXRlTW9kZWwiLCBfZGVzY3JpcHRvcjIsIHRoaXMpOwogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJxdWlsbCIsIG51bGwpOwogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJwZW4iLCBSb290LnBlblN0b3JlKTsKICB9CiAgbW91bnRlZCgpIHsKICAgIFF1aWxsLnJlZ2lzdGVyKFF1aWxsLmltcG9ydCgiYXR0cmlidXRvcnMvY2xhc3MvY29sb3IiKSwgdHJ1ZSk7CiAgICBRdWlsbC5yZWdpc3RlcihRdWlsbC5pbXBvcnQoImF0dHJpYnV0b3JzL2NsYXNzL2JhY2tncm91bmQiKSwgdHJ1ZSk7CiAgICB2YXIgYmluZGluZ3MgPSB7CiAgICAgIC8vIFRoaXMgd2lsbCBvdmVyd3JpdGUgdGhlIGRlZmF1bHQgYmluZGluZyBhbHNvIG5hbWVkICd0YWInCiAgICAgIGVudGVyOiB7CiAgICAgICAga2V5OiAxMywKICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBzdXBwcmVzcwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHRoaXMucXVpbGwgPSBuZXcgUXVpbGwodGhpcy4kcmVmc1sidGV4dGFyZWEiXSwgewogICAgICBtb2R1bGVzOiB7CiAgICAgICAga2V5Ym9hcmQ6IHsKICAgICAgICAgIGJpbmRpbmdzOiBiaW5kaW5ncwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICB0aGlzLnF1aWxsLnJvb3Quc2V0QXR0cmlidXRlKCJzcGVsbGNoZWNrIiwgZmFsc2UpOwogICAgdGhpcy5zZXRUZXh0KHRoaXMucXVpbGwsIHRoaXMuZ2V0VGV4dCgxKSk7CiAgICB0aGlzLnF1aWxsLnJvb3QuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGV2ZW50ID0+IHsKICAgICAgaWYgKGV2ZW50LmtleS5sZW5ndGggPT09IDEgJiYgIWV2ZW50LmN0cmxLZXkgJiYgIWV2ZW50LmFsdEtleSkgewogICAgICAgIHRoaXMucGVuLnNldElzUXVlcnlpbmcodHJ1ZSk7CiAgICAgICAgdGhpcy5wZW4uc2V0UXVlcnkoZXZlbnQua2V5KTsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gIkVudGVyIikgewogICAgICAgIHRoaXMucGVuLnNldElzUXVlcnlpbmcodHJ1ZSk7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICJyIiAmJiBldmVudC5hbHRLZXkpIHsKICAgICAgICBpZiAoIVJvb3QucGVuLmlzQ3Vyc29ySW5zZXJ0aW5nKCkpIHsKICAgICAgICAgIFJvb3QucGVuLnRyeVByb21vdGVTZWxlY3Rpb25Ub1Jvb3QoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSAiYSIgJiYgZXZlbnQuYWx0S2V5KSB7CiAgICAgICAgUm9vdC5ub2RlQ29sbGVjdGlvbi5jb252ZXJ0VG9BdHRyaWJ1dGUoUm9vdC5wZW4uZ2V0UG9pbnRlZE5vZGUoKSk7CiAgICAgICAgUm9vdC5zYXZlKCk7CiAgICAgICAgdGhpcy51cGRhdGVFZGl0b3JJZlNlbGVjdGVkKCk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy5xdWlsbC5vbigidGV4dC1jaGFuZ2UiLCAoZGVsdGEsIG9sZERlbHRhLCBzb3VyY2UpID0+IHsKICAgICAgaWYgKHNvdXJjZSAhPT0gInVzZXIiKSByZXR1cm47CiAgICAgIFZ1ZS5uZXh0VGljaygoKSA9PiB7CiAgICAgICAgdGhpcy5zZXRUZXh0KHRoaXMucXVpbGwsIG9sZERlbHRhLm9wc1swXS5pbnNlcnQpOwogICAgICB9KTsKICAgIH0pOwogICAgdGhpcy5xdWlsbC5vbigic2VsZWN0aW9uLWNoYW5nZSIsIChyYW5nZSwgb2xkUmFuZ2UsIHNvdXJjZSkgPT4gewogICAgICBpZiAoc291cmNlICE9PSAidXNlciIpIHJldHVybjsKICAgICAgaWYgKHRoaXMucGVuLmdldElzUXVlcnlpbmcoKSkgcmV0dXJuOwogICAgICBpZiAocmFuZ2UgPT09IG51bGwpIHsKICAgICAgICB0aGlzLnBlbi5zZXRTZWxlY3Rpb24obnVsbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wZW4uc2V0U2VsZWN0aW9uKHsKICAgICAgICAgIGF0dHJpYnV0ZUlkOiB0aGlzLmF0dHJpYnV0ZU1vZGVsLmlkLAogICAgICAgICAgc3RhcnRJbmRleDogcmFuZ2UuaW5kZXgsCiAgICAgICAgICBlbmRJbmRleDogcmFuZ2UuaW5kZXggKyByYW5nZS5sZW5ndGgKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLnBlbi5ldmVudHMub24oImFmdGVyUGVuQ29tbWl0IiwgKCkgPT4gdGhpcy51cGRhdGVFZGl0b3JJZlNlbGVjdGVkKCkpOwogICAgQXR0cmlidXRlTW9kZWwub25Tb21lQXR0cmlidXRlQ2hhbmdlZC5zdWIoKCkgPT4gdGhpcy51cGRhdGVFZGl0b3IoKSk7CiAgfQogIGJsdXIoKSB7CiAgICB0aGlzLnF1aWxsLmZvY3VzKCk7CiAgfQogIHJlbW92ZSgpIHsKICAgIHRoaXMuYXR0cmlidXRlTW9kZWwuaW5saW5lV2l0aERlZmF1bHRzKCk7CiAgICBSb290LnNhdmUoKTsKICB9CiAgc3RhcnRFZGl0aW5nTmFtZSgpIHsKICAgIGlmICghdGhpcy5hdHRyaWJ1dGVNb2RlbC5pc0Zyb3plbikgewogICAgICB0aGlzLmlucHV0TmFtZSA9IHRoaXMuYXR0cmlidXRlTW9kZWwubmFtZTsKICAgICAgdGhpcy5pc0VkaXRpbmdOYW1lID0gdHJ1ZTsKICAgICAgVnVlLm5leHRUaWNrKCgpID0+IHRoaXMuJHJlZnNbIm5hbWVJbnB1dCJdLmZvY3VzKCkpOwogICAgfQogIH0KICBjb21taXROYW1lKCkgewogICAgdGhpcy5hdHRyaWJ1dGVNb2RlbC5uYW1lID0gdGhpcy5pbnB1dE5hbWU7CiAgICB0aGlzLmlzRWRpdGluZ05hbWUgPSBmYWxzZTsKICB9CiAgb25JbnB1dEtleXByZXNzKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQua2V5ID09PSAiRW50ZXIiKSB7CiAgICAgIHRoaXMuY29tbWl0TmFtZSgpOwogICAgfQogIH0KICBvbklucHV0Qmx1cigpIHsKICAgIHRoaXMuaXNFZGl0aW5nTmFtZSA9IGZhbHNlOwogIH0KICBvbk5hbWVDaGFuZ2UodmFsdWUpIHsKICAgIHRoaXMuYXR0cmlidXRlTW9kZWwubmFtZSA9IHZhbHVlOwogICAgUm9vdC5zYXZlKCk7CiAgfQogIGZvY3VzU2VhcmNoZXIoKSB7CiAgICBpZiAodGhpcy5waWNraW5nKSB7CiAgICAgIHRoaXMuJG5leHRUaWNrKCkudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy4kcmVmc1sic2VhcmNoZXIiXS5mb2N1cygpOwogICAgICB9KTsKICAgIH0KICB9CiAgZ2V0IHBpY2tpbmcoKSB7CiAgICByZXR1cm4gUm9vdC5wZW5TdG9yZS5nZXRJc1F1ZXJ5aW5nKCkgJiYgUm9vdC5wZW4uZ2V0U2VsZWN0ZWRBdHRyaWJ1dGUoKSA9PT0gdGhpcy5hdHRyaWJ1dGVNb2RlbDsKICB9CiAgdXBkYXRlRWRpdG9yKCkgewogICAgaWYgKEF0dHJpYnV0ZU1vZGVsLmF0dHJpYnV0ZXMuaW5kZXhPZih0aGlzLmF0dHJpYnV0ZU1vZGVsKSAhPT0gLTEpIHsKICAgICAgdGhpcy5zZXRUZXh0KHRoaXMucXVpbGwsIHRoaXMuZ2V0VGV4dCgpKTsKICAgIH0KICB9CiAgdXBkYXRlRWRpdG9ySWZTZWxlY3RlZCgpIHsKICAgIGlmICh0aGlzLnBlbi5nZXRTZWxlY3RlZEF0dHJpYnV0ZSgpICE9PSB0aGlzLmF0dHJpYnV0ZU1vZGVsKSByZXR1cm47CiAgICB0aGlzLnVwZGF0ZUVkaXRvcigpOwogIH0KICBzZXRUZXh0KHF1aWxsLCB0ZXh0KSB7CiAgICB0aGlzLnF1aWxsLnJlbW92ZUZvcm1hdCgwLCB0aGlzLnF1aWxsLmdldExlbmd0aCgpKTsKICAgIHRoaXMucXVpbGwuc2V0VGV4dCh0ZXh0LCAic2lsZW50Iik7CiAgICBjb25zdCBhbm5vdGF0ZWRUZXh0ID0gUm9vdC5wZW4uZ2V0QW5ub3RhdGVkVGV4dEZvckF0dHJpYnV0ZSh0aGlzLmF0dHJpYnV0ZU1vZGVsKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYW5ub3RhdGVkVGV4dC5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBhbm5vdGF0ZWRDaGFyID0gYW5ub3RhdGVkVGV4dFtpXTsKICAgICAgY29uc3Qgbm9kZSA9IGFubm90YXRlZENoYXIubm9kZTsKICAgICAgaWYgKG5vZGUgPT09IG51bGwpIGNvbnRpbnVlOwogICAgICBpZiAobm9kZS5tZXRhbmFtZSA9PT0gIkZ1bmN0aW9uIikgewogICAgICAgIHRoaXMucXVpbGwuZm9ybWF0VGV4dChpLCAxLCAiY29sb3IiLCAiZnVuY3Rpb24iLCAic2lsZW50Iik7CiAgICAgIH0gZWxzZSBpZiAobm9kZS5tZXRhbmFtZSAhPT0gIk51bWJlciIgJiYgbm9kZS5tZXRhbmFtZSAhPT0gIlZlY3RvciIpIHsKICAgICAgICB0aGlzLnF1aWxsLmZvcm1hdFRleHQoaSwgMSwgImNvbG9yIiwgInZhcmlhYmxlIiwgInNpbGVudCIpOwogICAgICB9CiAgICB9CiAgICB0aGlzLnVwZGF0ZUN1cnNvcigpOwogIH0KICB1cGRhdGVDdXJzb3IoKSB7CiAgICB2YXIgX3RoaXMkcGVuJGdldFNlbGVjdGlvOwogICAgaWYgKHRoaXMucGVuLmdldElzUXVlcnlpbmcoKSkgcmV0dXJuOwogICAgdGhpcy5xdWlsbC5mb3JtYXRUZXh0KDAsIHRoaXMucXVpbGwuZ2V0TGVuZ3RoKCksICJiYWNrZ3JvdW5kIiwgZmFsc2UsICJzaWxlbnQiKTsKICAgIGlmICgoKF90aGlzJHBlbiRnZXRTZWxlY3RpbyA9IHRoaXMucGVuLmdldFNlbGVjdGlvbigpKSA9PT0gbnVsbCB8fCBfdGhpcyRwZW4kZ2V0U2VsZWN0aW8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJHBlbiRnZXRTZWxlY3Rpby5hdHRyaWJ1dGVJZCkgPT09IHRoaXMuYXR0cmlidXRlTW9kZWwuaWQpIHsKICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5wZW4uZ2V0U2VsZWN0aW9uKCk7CiAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHNlbGVjdGlvbi5zdGFydEluZGV4LCBzZWxlY3Rpb24uZW5kSW5kZXggLSBzZWxlY3Rpb24uc3RhcnRJbmRleCwgInNpbGVudCIpOwogICAgICBjb25zdCBsZW5ndGggPSBzZWxlY3Rpb24uZW5kSW5kZXggLSBzZWxlY3Rpb24uc3RhcnRJbmRleDsKICAgICAgdGhpcy5xdWlsbC5mb3JtYXRUZXh0KHNlbGVjdGlvbi5zdGFydEluZGV4LCBsZW5ndGgsICJiYWNrZ3JvdW5kIiwgInNlbGVjdGVkIiwgInNpbGVudCIpOwogICAgfQogIH0KICBnZXRUZXh0KCkgewogICAgcmV0dXJuIFJvb3QucGVuLmdldFRleHRGb3JBdHRyaWJ1dGUodGhpcy5hdHRyaWJ1dGVNb2RlbCk7CiAgfQp9LCAoX2Rlc2NyaXB0b3IgPSBfYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yKF9jbGFzczIucHJvdG90eXBlLCAiYXN0Tm9kZSIsIFtfZGVjMl0sIHsKICBjb25maWd1cmFibGU6IHRydWUsCiAgZW51bWVyYWJsZTogdHJ1ZSwKICB3cml0YWJsZTogdHJ1ZSwKICBpbml0aWFsaXplcjogbnVsbAp9KSwgX2Rlc2NyaXB0b3IyID0gX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3MyLnByb3RvdHlwZSwgImF0dHJpYnV0ZU1vZGVsIiwgW19kZWMzXSwgewogIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICBlbnVtZXJhYmxlOiB0cnVlLAogIHdyaXRhYmxlOiB0cnVlLAogIGluaXRpYWxpemVyOiBudWxsCn0pLCBfYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yKF9jbGFzczIucHJvdG90eXBlLCAiZm9jdXNTZWFyY2hlciIsIFtfZGVjNF0sIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoX2NsYXNzMi5wcm90b3R5cGUsICJmb2N1c1NlYXJjaGVyIiksIF9jbGFzczIucHJvdG90eXBlKSwgX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3MyLnByb3RvdHlwZSwgInVwZGF0ZUN1cnNvciIsIFtfZGVjNV0sIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoX2NsYXNzMi5wcm90b3R5cGUsICJ1cGRhdGVDdXJzb3IiKSwgX2NsYXNzMi5wcm90b3R5cGUpKSwgX2NsYXNzMikpIHx8IF9jbGFzcyk7CmV4cG9ydCB7IEF0dHJpYnV0ZSBhcyBkZWZhdWx0IH07"},{"version":3,"names":["Vue","Component","Prop","Watch","Root","NodePicker","InlineInput","Quill","AttributeModel","Attribute","_dec","components","_dec2","_dec3","_dec4","_dec5","_class","_class2","constructor","args","_initializerDefineProperty","_descriptor","_descriptor2","_defineProperty","penStore","mounted","register","import","bindings","enter","key","handler","quill","$refs","modules","keyboard","root","setAttribute","setText","getText","addEventListener","event","length","ctrlKey","altKey","pen","setIsQuerying","setQuery","preventDefault","stopPropagation","isCursorInserting","tryPromoteSelectionToRoot","nodeCollection","convertToAttribute","getPointedNode","save","updateEditorIfSelected","on","delta","oldDelta","source","nextTick","ops","insert","range","oldRange","getIsQuerying","setSelection","attributeId","attributeModel","id","startIndex","index","endIndex","events","onSomeAttributeChanged","sub","updateEditor","blur","focus","remove","inlineWithDefaults","startEditingName","isFrozen","inputName","name","isEditingName","commitName","onInputKeypress","onInputBlur","onNameChange","value","focusSearcher","picking","$nextTick","then","getSelectedAttribute","attributes","indexOf","text","removeFormat","getLength","annotatedText","getAnnotatedTextForAttribute","i","annotatedChar","node","metaname","formatText","updateCursor","_this$pen$getSelectio","getSelection","selection","getTextForAttribute","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","Object","getOwnPropertyDescriptor","default"],"sources":["src/components/Attribute.vue"],"sourcesContent":["<template>\n  <div>\n    <div class=\"flex flex-col space-y-2\">\n      <div class=\"flex justify-between\">\n        <InlineInput\n          :value='attributeModel.name'\n          @input='onNameChange'\n          :readonly=\"attributeModel.isFrozen\"\n        >\n          <span class=\"text-attribute\">{{ attributeModel.name }}</span>\n        </InlineInput>\n        <button v-if=\"!attributeModel.isFrozen\" @click=\"remove\">Remove</button>\n      </div>\n      <div ref=\"textarea\"></div>\n    </div>\n    <NodePicker\n      ref=\"searcher\"\n      v-if=\"picking\"\n      @blur=\"blur\"\n      :class=\"['searcher', { 'bring-to-front': picking }]\"\n    />\n  </div>\n</template>\n\n<script>\nimport Vue from \"vue\";\nimport Component from \"vue-class-component\";\nimport { Prop, Watch } from \"vue-property-decorator\";\nimport Root from \"../store/Root\";\nimport NodePicker from \"./NodePicker\";\nimport InlineInput from \"./InlineInput\";\nimport Quill from \"quill\";\nimport AttributeModel from \"@/models/Attribute\";\n\n@Component({\n  components: { NodePicker, InlineInput },\n})\nexport default class Attribute extends Vue {\n  @Prop() astNode;\n  @Prop() attributeModel;\n\n  quill = null;\n  pen = Root.penStore;\n\n  mounted() {\n    Quill.register(Quill.import(\"attributors/class/color\"), true);\n    Quill.register(Quill.import(\"attributors/class/background\"), true);\n    var bindings = {\n      // This will overwrite the default binding also named 'tab'\n      enter: {\n        key: 13,\n        handler: function () {\n          // suppress\n        },\n      },\n    };\n    this.quill = new Quill(this.$refs[\"textarea\"], {\n      modules: {\n        keyboard: {\n          bindings: bindings,\n        },\n      },\n    });\n    this.quill.root.setAttribute(\"spellcheck\", false);\n\n    this.setText(this.quill, this.getText(1));\n\n    this.quill.root.addEventListener(\"keydown\", (event) => {\n      if (event.key.length === 1 && !event.ctrlKey && !event.altKey) {\n        this.pen.setIsQuerying(true);\n        this.pen.setQuery(event.key);\n        event.preventDefault();\n        event.stopPropagation();\n      } else if (event.key === \"Enter\") {\n        this.pen.setIsQuerying(true);\n        event.preventDefault();\n        event.stopPropagation();\n      } else if (event.key === \"r\" && event.altKey) {\n        if (!Root.pen.isCursorInserting()) {\n          Root.pen.tryPromoteSelectionToRoot();\n        }\n      } else if (event.key === \"a\" && event.altKey) {\n        Root.nodeCollection.convertToAttribute(Root.pen.getPointedNode());\n        Root.save();\n        this.updateEditorIfSelected();\n      }\n    });\n\n    this.quill.on(\"text-change\", (delta, oldDelta, source) => {\n      if (source !== \"user\") return;\n      Vue.nextTick(() => {\n        this.setText(this.quill, oldDelta.ops[0].insert);\n      });\n    });\n\n    this.quill.on(\"selection-change\", (range, oldRange, source) => {\n      if (source !== \"user\") return;\n      if (this.pen.getIsQuerying()) return;\n\n      if (range === null) {\n        this.pen.setSelection(null);\n      } else {\n        this.pen.setSelection({\n          attributeId: this.attributeModel.id,\n          startIndex: range.index,\n          endIndex: range.index + range.length,\n        });\n      }\n    });\n\n    this.pen.events.on(\"afterPenCommit\", () => this.updateEditorIfSelected());\n\n    AttributeModel.onSomeAttributeChanged.sub(() => this.updateEditor());\n  }\n\n  blur() {\n    this.quill.focus();\n  }\n\n  remove() {\n    this.attributeModel.inlineWithDefaults();\n    Root.save();\n  }\n\n  startEditingName() {\n    if (!this.attributeModel.isFrozen) {\n      this.inputName = this.attributeModel.name;\n      this.isEditingName = true;\n      Vue.nextTick(() => this.$refs[\"nameInput\"].focus());\n    }\n  }\n\n  commitName() {\n    this.attributeModel.name = this.inputName;\n    this.isEditingName = false;\n  }\n\n  onInputKeypress(event) {\n    if (event.key === \"Enter\") {\n      this.commitName();\n    }\n  }\n\n  onInputBlur() {\n    this.isEditingName = false;\n  }\n\n  onNameChange(value) {\n    this.attributeModel.name = value;\n    Root.save();\n  }\n\n  @Watch(\"picking\")\n  focusSearcher() {\n    if (this.picking) {\n      this.$nextTick().then(() => {\n        this.$refs[\"searcher\"].focus();\n      });\n    }\n  }\n\n  get picking() {\n    return (\n      Root.penStore.getIsQuerying() &&\n      Root.pen.getSelectedAttribute() === this.attributeModel\n    );\n  }\n\n  updateEditor() {\n    if (AttributeModel.attributes.indexOf(this.attributeModel) !== -1) {\n      this.setText(this.quill, this.getText());\n    }\n  }\n\n  updateEditorIfSelected() {\n    if (this.pen.getSelectedAttribute() !== this.attributeModel) return;\n    this.updateEditor();\n  }\n\n  setText(quill, text) {\n    this.quill.removeFormat(0, this.quill.getLength());\n    this.quill.setText(text, \"silent\");\n    const annotatedText = Root.pen.getAnnotatedTextForAttribute(\n      this.attributeModel\n    );\n\n    for (let i = 0; i < annotatedText.length; i++) {\n      const annotatedChar = annotatedText[i];\n      const node = annotatedChar.node;\n      if (node === null) continue;\n      if (node.metaname === \"Function\") {\n        this.quill.formatText(i, 1, \"color\", \"function\", \"silent\");\n      } else if (node.metaname !== \"Number\" && node.metaname !== \"Vector\") {\n        this.quill.formatText(i, 1, \"color\", \"variable\", \"silent\");\n      }\n    }\n    this.updateCursor();\n  }\n\n  @Watch(\"pen.selection\")\n  updateCursor() {\n    if (this.pen.getIsQuerying()) return;\n\n    this.quill.formatText(\n      0,\n      this.quill.getLength(),\n      \"background\",\n      false,\n      \"silent\"\n    );\n\n    if (this.pen.getSelection()?.attributeId === this.attributeModel.id) {\n      const selection = this.pen.getSelection();\n      this.quill.setSelection(\n        selection.startIndex,\n        selection.endIndex - selection.startIndex,\n        \"silent\"\n      );\n      const length = selection.endIndex - selection.startIndex;\n\n      this.quill.formatText(\n        selection.startIndex,\n        length,\n        \"background\",\n        \"selected\",\n        \"silent\"\n      );\n    }\n  }\n\n  getText() {\n    return Root.pen.getTextForAttribute(this.attributeModel);\n  }\n}\n</script>\n\n<style scoped>\n</style>"],"mappings":"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","ignoreList":[]}]}