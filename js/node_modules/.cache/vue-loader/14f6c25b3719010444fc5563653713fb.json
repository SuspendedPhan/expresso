{"remainingRequest":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/WasmExpressor.vue?vue&type=script&lang=ts","dependencies":[{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/WasmExpressor.vue","mtime":1714946187072},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/babel-loader/lib/index.js","mtime":1714947394795},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/ts-loader/index.js","mtime":1714947267504},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js","mtime":1714947393584}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgppbXBvcnQgQ29tcG9uZW50IGZyb20gInZ1ZS1jbGFzcy1jb21wb25lbnQiOwppbXBvcnQge1Byb3AsIFByb3ZpZGV9IGZyb20gInZ1ZS1wcm9wZXJ0eS1kZWNvcmF0b3IiOwppbXBvcnQgVnVlIGZyb20gInZ1ZSI7CmltcG9ydCBXYXNtT3JnYW5pc20gZnJvbSAiQC9jb21wb25lbnRzL1dhc21PcmdhbmlzbS52dWUiOwppbXBvcnQge0VsZW1lbnRMYXlvdXR9IGZyb20gIkAvY29kZS9FbGVtZW50TGF5b3V0IjsKaW1wb3J0IEZ1bmN0aW9ucyBmcm9tICJAL2NvZGUvRnVuY3Rpb25zIjsKCmltcG9ydCBwYW56b29tIGZyb20gInBhbnpvb20iOwppbXBvcnQgUmVzaXplU2Vuc29yIGZyb20gImNzcy1lbGVtZW50LXF1ZXJpZXMvc3JjL1Jlc2l6ZVNlbnNvciI7CmltcG9ydCBXYXNtUGVuIGZyb20gIkAvY29kZS9XYXNtUGVuIjsKCkBDb21wb25lbnQoewogIGNvbXBvbmVudHM6IHtXYXNtT3JnYW5pc219Cn0pCmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdhc21FeHByZXNzb3IgZXh0ZW5kcyBWdWUgewogIEBQcm9wKCkKICBwcm9qZWN0OwoKICByb290T3JnYW5pc20gPSBudWxsOwogIG9yZ2FuaXNtTGF5b3V0ID0gbnVsbCBhcyBhbnk7CgogIGNvbnNvbGVFcnJvciA9IGZhbHNlOwogIGNhbnZhc1dpZHRoID0gMDsKICBjYW52YXNIZWlnaHQgPSAwOwogIHBhbnpvb21UcmFuc2Zvcm0gPSB7fTsKICBsaW5lcyA9IFtdOwoKICBhc3luYyBtb3VudGVkKCkgewogICAgdGhpcy5yb290T3JnYW5pc20gPSB0aGlzLnByb2plY3QuZ2V0Um9vdE9yZ2FuaXNtKCk7CiAgICB0aGlzLm9yZ2FuaXNtTGF5b3V0ID0gbmV3IEVsZW1lbnRMYXlvdXQoKCkgPT4gdGhpcy5yb290T3JnYW5pc20sIFdhc21FeHByZXNzb3IuZ2V0Q2hpbGRyZW4sIFdhc21FeHByZXNzb3IuZ2V0S2V5LCBob3Jpem9udGFsTWFyZ2luLCB2ZXJ0aWNhbE1hcmdpbik7CiAgICB0aGlzLm9sZE1vdW50ZWQoKTsKICB9CgogIHByaXZhdGUgc3RhdGljIGdldENoaWxkcmVuKG9yZ2FuaXNtKSB7CiAgICByZXR1cm4gRnVuY3Rpb25zLnZlY3RvclRvQXJyYXkob3JnYW5pc20uZ2V0U3Vib3JnYW5pc21zKCkpOwogIH0KCiAgcHJpdmF0ZSBzdGF0aWMgZ2V0S2V5KG9yZ2FuaXNtKSB7CiAgICByZXR1cm4gb3JnYW5pc20uZ2V0SWQoKTsKICB9CgogIC8vIC0tLSBvbGQgc3R1ZmYgLS0tCgogIG9sZE1vdW50ZWQoKSB7CiAgICBjb25zdCBweiA9IHBhbnpvb20odGhpcy4kcmVmc1sicGFuem9vbSJdIGFzIGFueSwgewogICAgICBiZWZvcmVNb3VzZURvd246IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHNob3VsZElnbm9yZSA9ICFlLmFsdEtleTsKICAgICAgICByZXR1cm4gc2hvdWxkSWdub3JlOwogICAgICB9LAogICAgICBmaWx0ZXJLZXk6IGZ1bmN0aW9uICgvKiBlLCBkeCwgZHksIGR6ICovKSB7CiAgICAgICAgLy8gZG9uJ3QgbGV0IHBhbnpvb20gaGFuZGxlIHRoaXMgZXZlbnQ6CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0sCiAgICAgIHpvb21Eb3VibGVDbGlja1NwZWVkOiAxLAogICAgfSk7CiAgICBwei5vbigidHJhbnNmb3JtIiwgKGUpID0+IHsKICAgICAgdGhpcy5wYW56b29tVHJhbnNmb3JtID0gcHouZ2V0VHJhbnNmb3JtKCk7CiAgICAgIHRoaXMuZHJhd0xpbmVzKCk7CiAgICB9KTsKCiAgICAvLyBOT1RFOiBtYXliZSBjYW4gcmVtb3ZlPwogICAgY29uc3QgZXhwcmVzc29yRWxlbWVudCA9IHRoaXMuJHJlZnNbImV4cHJlc3NvciJdIGFzIGFueTsKICAgIHRoaXMuY2FudmFzV2lkdGggPSBleHByZXNzb3JFbGVtZW50LmNsaWVudFdpZHRoOwogICAgdGhpcy5jYW52YXNIZWlnaHQgPSBleHByZXNzb3JFbGVtZW50LmNsaWVudEhlaWdodDsKCiAgICBuZXcgUmVzaXplU2Vuc29yKGV4cHJlc3NvckVsZW1lbnQgYXMgYW55LCAoKSA9PiB7CiAgICAgIHRoaXMuY2FudmFzV2lkdGggPSBleHByZXNzb3JFbGVtZW50LmNsaWVudFdpZHRoOwogICAgICB0aGlzLmNhbnZhc0hlaWdodCA9IGV4cHJlc3NvckVsZW1lbnQuY2xpZW50SGVpZ2h0OwogICAgfSk7CgogICAgdGhpcy5vcmdhbmlzbUxheW91dC5vbkNhbGN1bGF0ZWQuc3Vic2NyaWJlKChvdXRwdXQpID0+IHsKICAgICAgdGhpcy5saW5lcyA9IG91dHB1dC5saW5lczsKICAgICAgdGhpcy5kcmF3TGluZXMoKTsKICAgIH0pOwogIH0KCiAgLy8gY2xlYXJTdG9yYWdlKCkgewogIC8vICAgdGhpcy5yb290LmNsZWFyU3RvcmFnZSgpOwogIC8vIH0KCiAgZHJhd0xpbmVzKCkgewogICAgY29uc3QgY2FudmFzRWxlbWVudCA9IHRoaXMuJHJlZnNbImNhbnZhcyJdIGFzIGFueTsKICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXNFbGVtZW50LmdldENvbnRleHQoIjJkIik7CiAgICBjb250ZXh0LnJlc2V0VHJhbnNmb3JtKCk7CiAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhc1dpZHRoLCB0aGlzLmNhbnZhc0hlaWdodCk7CiAgICBjb25zdCB0cmFuc2Zvcm0gPSB0aGlzLnBhbnpvb21UcmFuc2Zvcm0gYXMgYW55OwogICAgY29udGV4dC5zZXRUcmFuc2Zvcm0oCiAgICAgICAgdHJhbnNmb3JtLnNjYWxlLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICB0cmFuc2Zvcm0uc2NhbGUsCiAgICAgICAgdHJhbnNmb3JtLngsCiAgICAgICAgdHJhbnNmb3JtLnkKICAgICk7CiAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gImdyYXkiOwogICAgZm9yIChjb25zdCBsaW5lIG9mIHRoaXMubGluZXMgYXMgYW55KSB7CiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7CiAgICAgIGNvbnRleHQubW92ZVRvKGxpbmUuc3RhcnRYLCBsaW5lLnN0YXJ0WSk7CiAgICAgIGNvbnRleHQubGluZVRvKGxpbmUuZW5kWCwgbGluZS5lbmRZKTsKICAgICAgY29udGV4dC5zdHJva2UoKTsKICAgIH0KICB9Cn0KCg=="},{"version":3,"sources":["WasmExpressor.vue"],"names":[],"mappings":";;AA2BA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"WasmExpressor.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"expressor\" ref=\"expressor\">\n    <div>\n      <canvas\n          ref=\"canvas\"\n          type=\"2d\"\n          :width=\"canvasWidth\"\n          :height=\"canvasHeight\"\n          class=\"canvas\"\n      ></canvas>\n    </div>\n    <div ref=\"panzoom\">\n      <WasmOrganism v-if=\"rootOrganism\" :organism=\"rootOrganism\" :organismLayout=\"organismLayout\" :isRoot=\"true\"></WasmOrganism>\n      <!--      <div class=\"bottom-group\">-->\n<!--        <button @click=\"clearStorage\" class=\"clearStorage\">-->\n<!--          Clear storage-->\n<!--        </button>-->\n<!--        <div :class=\"['error-box', { error: consoleError }]\">-->\n<!--          you have console errors-->\n<!--        </div>-->\n<!--      </div>-->\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport Component from \"vue-class-component\";\nimport {Prop, Provide} from \"vue-property-decorator\";\nimport Vue from \"vue\";\nimport WasmOrganism from \"@/components/WasmOrganism.vue\";\nimport {ElementLayout} from \"@/code/ElementLayout\";\nimport Functions from \"@/code/Functions\";\n\nimport panzoom from \"panzoom\";\nimport ResizeSensor from \"css-element-queries/src/ResizeSensor\";\nimport WasmPen from \"@/code/WasmPen\";\n\n@Component({\n  components: {WasmOrganism}\n})\nexport default class WasmExpressor extends Vue {\n  @Prop()\n  project;\n\n  rootOrganism = null;\n  organismLayout = null as any;\n\n  consoleError = false;\n  canvasWidth = 0;\n  canvasHeight = 0;\n  panzoomTransform = {};\n  lines = [];\n\n  async mounted() {\n    this.rootOrganism = this.project.getRootOrganism();\n    this.organismLayout = new ElementLayout(() => this.rootOrganism, WasmExpressor.getChildren, WasmExpressor.getKey, horizontalMargin, verticalMargin);\n    this.oldMounted();\n  }\n\n  private static getChildren(organism) {\n    return Functions.vectorToArray(organism.getSuborganisms());\n  }\n\n  private static getKey(organism) {\n    return organism.getId();\n  }\n\n  // --- old stuff ---\n\n  oldMounted() {\n    const pz = panzoom(this.$refs[\"panzoom\"] as any, {\n      beforeMouseDown: function (e) {\n        var shouldIgnore = !e.altKey;\n        return shouldIgnore;\n      },\n      filterKey: function (/* e, dx, dy, dz */) {\n        // don't let panzoom handle this event:\n        return true;\n      },\n      zoomDoubleClickSpeed: 1,\n    });\n    pz.on(\"transform\", (e) => {\n      this.panzoomTransform = pz.getTransform();\n      this.drawLines();\n    });\n\n    // NOTE: maybe can remove?\n    const expressorElement = this.$refs[\"expressor\"] as any;\n    this.canvasWidth = expressorElement.clientWidth;\n    this.canvasHeight = expressorElement.clientHeight;\n\n    new ResizeSensor(expressorElement as any, () => {\n      this.canvasWidth = expressorElement.clientWidth;\n      this.canvasHeight = expressorElement.clientHeight;\n    });\n\n    this.organismLayout.onCalculated.subscribe((output) => {\n      this.lines = output.lines;\n      this.drawLines();\n    });\n  }\n\n  // clearStorage() {\n  //   this.root.clearStorage();\n  // }\n\n  drawLines() {\n    const canvasElement = this.$refs[\"canvas\"] as any;\n    const context = canvasElement.getContext(\"2d\");\n    context.resetTransform();\n    context.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n    const transform = this.panzoomTransform as any;\n    context.setTransform(\n        transform.scale,\n        0,\n        0,\n        transform.scale,\n        transform.x,\n        transform.y\n    );\n    context.strokeStyle = \"gray\";\n    for (const line of this.lines as any) {\n      context.beginPath();\n      context.moveTo(line.startX, line.startY);\n      context.lineTo(line.endX, line.endY);\n      context.stroke();\n    }\n  }\n}\n\n</script>\n<style scoped>\n.expressor {\n  position: relative;\n  outline: none;\n}\n.organism {\n  margin-bottom: 20px;\n}\n.attribute {\n}\n.controls {\n  display: grid;\n  grid-template-columns: max-content max-content max-content;\n  gap: 10px;\n}\n.bottom-group {\n  display: flex;\n  justify-content: space-between;\n}\n.error-box {\n  padding: 5px;\n  font-size: 12px;\n  background-color: hsl(0, 100%, 67%);\n  visibility: hidden;\n  color: white;\n}\n.error-box.error {\n  visibility: visible;\n}\n.canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n  left: 0px;\n  border: none;\n}\n.clearStorage {\n  position: fixed;\n  top: 10px;\n  left: 200px;\n  z-index: 2;\n}\n</style>"]}]}