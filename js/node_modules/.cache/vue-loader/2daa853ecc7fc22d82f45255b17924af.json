{"remainingRequest":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/Viewport.vue?vue&type=script&lang=ts","dependencies":[{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/Viewport.vue","mtime":1714946187072},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/babel-loader/lib/index.js","mtime":1714947394795},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/ts-loader/index.js","mtime":1714947267504},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js","mtime":1714947393584}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBSb290LCB7IFJlbmRlclNoYXBlIH0gZnJvbSAiLi4vc3RvcmUvUm9vdCI7CmltcG9ydCBmcHMgZnJvbSAiZnBzIjsKaW1wb3J0IG51bWVyYWwgZnJvbSAibnVtZXJhbCI7CmltcG9ydCBDb21wb25lbnQgZnJvbSAidnVlLWNsYXNzLWNvbXBvbmVudCI7CmltcG9ydCBWdWUgZnJvbSAidnVlIjsKaW1wb3J0ICogYXMgUElYSSBmcm9tICJwaXhpLmpzIjsKaW1wb3J0IGRlZVBvb2wgZnJvbSAiZGVlcG9vbCI7CmltcG9ydCB7IFNpZ25hbERpc3BhdGNoZXIgfSBmcm9tICJzdGUtc2lnbmFscyI7Cgood2luZG93IGFzIGFueSkucm9vdCA9IFJvb3Q7CgpAQ29tcG9uZW50KHt9KQpleHBvcnQgZGVmYXVsdCBjbGFzcyBWaWV3cG9ydCBleHRlbmRzIFZ1ZSB7CiAgd2lkdGggPSAwOwogIGhlaWdodCA9IDA7CiAgZnJhbWVyYXRlID0gMDsKICBSb290ID0gUm9vdDsKICBtb3N0UmVjZW50Q2xpY2tDb29yZGluYXRlcyA9IHsgeDogMCwgeTogMCB9OwogIGFwcCA9IG51bGwgYXMgYW55OwogIGNpcmNsZVBvb2wgPSBudWxsIGFzIGFueTsKICBjaXJjbGVzID0gW10gYXMgYW55W107CiAgcmVjdGFuZ2xlUG9vbCA9IG51bGwgYXMgYW55OwogIHJlY3RhbmdsZXMgPSBbXSBhcyBhbnlbXTsKICB0aWNrZXIgPSBmcHMoeyBldmVyeTogMTAgfSk7CgogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnRpY2tlci5vbigKICAgICAgImRhdGEiLAogICAgICAoZnJhbWVyYXRlKSA9PiAodGhpcy5mcmFtZXJhdGUgPSBudW1lcmFsKGZyYW1lcmF0ZSkuZm9ybWF0KCIwIikpCiAgICApOwogIH0KCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuYXBwID0gbmV3IFBJWEkuQXBwbGljYXRpb24oewogICAgICByZXNpemVUbzogdGhpcy4kcmVmc1sidmlld3BvcnQiXSBhcyBhbnksCiAgICAgIHZpZXc6IHRoaXMuJHJlZnNbImNhbnZhcyJdIGFzIGFueSwKICAgICAgYW50aWFsaWFzOiB0cnVlLAogICAgfSk7CiAgICB0aGlzLmNpcmNsZVBvb2wgPSBkZWVQb29sLmNyZWF0ZSh0aGlzLm1ha2VDaXJjbGUpOwogICAgdGhpcy5jaXJjbGVQb29sLmdyb3coMTAwKTsKICAgIHRoaXMucmVjdGFuZ2xlUG9vbCA9IGRlZVBvb2wuY3JlYXRlKHRoaXMubWFrZVJlY3RhbmdsZSk7CiAgICB0aGlzLnJlY3RhbmdsZVBvb2wuZ3JvdygxMDApOwogICAgdGhpcy51cGRhdGUoKTsKICB9CgogIHRlc3RNZXRob2QoZXZlbnQpIHsKICAgIHRoaXMubW9zdFJlY2VudENsaWNrQ29vcmRpbmF0ZXMgPSB7CiAgICAgIHg6IGV2ZW50LmNsaWVudFgsCiAgICAgIHk6IGV2ZW50LmNsaWVudFksCiAgICB9OwogIH0KCiAgdXBkYXRlKCkgewogICAgaWYgKHRoaXMuJHJlZnMudmlld3BvcnQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwoKICAgIHRoaXMudGlja2VyLnRpY2soKTsKICAgIGNvbnN0IHZpZXdwb3J0ID0gdGhpcy4kcmVmcy52aWV3cG9ydCBhcyBhbnk7CiAgICBjb25zdCBjYW52YXMgPSB0aGlzLiRyZWZzLmNhbnZhczsKICAgIHRoaXMud2lkdGggPSB2aWV3cG9ydC5jbGllbnRXaWR0aDsKICAgIHRoaXMuaGVpZ2h0ID0gdmlld3BvcnQuY2xpZW50SGVpZ2h0OwogICAgUm9vdC5zZXRXaW5kb3dTaXplKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKICAgIFJvb3Quc2V0TW91c2VMb2NhdGlvbigKICAgICAgdGhpcy5tb3N0UmVjZW50Q2xpY2tDb29yZGluYXRlcy54LAogICAgICB0aGlzLm1vc3RSZWNlbnRDbGlja0Nvb3JkaW5hdGVzLnkKICAgICk7CgogICAgZm9yIChjb25zdCBjaXJjbGUgb2YgdGhpcy5jaXJjbGVzKSB7CiAgICAgIGNpcmNsZS52aXNpYmxlID0gZmFsc2U7CiAgICB9CgogICAgZm9yIChjb25zdCByZWN0YW5nbGUgb2YgdGhpcy5yZWN0YW5nbGVzKSB7CiAgICAgIHJlY3RhbmdsZS52aXNpYmxlID0gZmFsc2U7CiAgICB9CgogICAgY29uc3QgZG9uZVJlbmRlcmluZ1NpZ25hbCA9IG5ldyBTaWduYWxEaXNwYXRjaGVyKCk7CiAgICBjb25zdCByZW5kZXJDb21tYW5kcyA9IFJvb3QuY29tcHV0ZVJlbmRlckNvbW1hbmRzKCk7CiAgICBmb3IgKGNvbnN0IHJlbmRlckNvbW1hbmQgb2YgcmVuZGVyQ29tbWFuZHMpIHsKICAgICAgY29uc3QgYWxwaGEgPSByZW5kZXJDb21tYW5kLmFscGhhID8/IDAuNTsKICAgICAgY29uc3QgaHVlID0gcmVuZGVyQ29tbWFuZC5odWUgPz8gMDsKICAgICAgY29uc3Qgc2F0dXJhdGlvbiA9IHJlbmRlckNvbW1hbmQuc2F0dXJhdGlvbiA/PyAwOwogICAgICBjb25zdCBsaWdodG5lc3MgPSByZW5kZXJDb21tYW5kLmxpZ2h0bmVzcyA/PyAwLjU7CiAgICAgIGNvbnN0IGZpbGxTdHlsZSA9IGBoc2xhKCR7aHVlICogMzYwfSwgJHtzYXR1cmF0aW9uICogMTAwfSUsICR7CiAgICAgICAgbGlnaHRuZXNzICogMTAwCiAgICAgIH0lLCAke2FscGhhfSlgOwogICAgICBpZiAocmVuZGVyQ29tbWFuZC5zaGFwZSA9PT0gUmVuZGVyU2hhcGUuQ2lyY2xlKSB7CiAgICAgICAgY29uc3QgY2lyY2xlID0gdGhpcy5jaXJjbGVQb29sLnVzZSgpOwogICAgICAgIGNpcmNsZS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICBjaXJjbGUueCA9IHJlbmRlckNvbW1hbmQueDsKICAgICAgICBjaXJjbGUueSA9IHJlbmRlckNvbW1hbmQueTsKICAgICAgICBjaXJjbGUuc2NhbGUueCA9IHJlbmRlckNvbW1hbmQucmFkaXVzOwogICAgICAgIGNpcmNsZS5zY2FsZS55ID0gcmVuZGVyQ29tbWFuZC5yYWRpdXM7CiAgICAgICAgLy8gY2lyY2xlLnRpbnQgPSAnJwogICAgICAgIGRvbmVSZW5kZXJpbmdTaWduYWwuc3ViKCgpID0+IHRoaXMuY2lyY2xlUG9vbC5yZWN5Y2xlKGNpcmNsZSkpOwogICAgICB9IGVsc2UgaWYgKHJlbmRlckNvbW1hbmQuc2hhcGUgPT09IFJlbmRlclNoYXBlLlJlY3RhbmdsZSkgewogICAgICAgIGNvbnN0IGNlbnRlcnggPSByZW5kZXJDb21tYW5kLnggLSByZW5kZXJDb21tYW5kLndpZHRoIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJ5ID0gcmVuZGVyQ29tbWFuZC55IC0gcmVuZGVyQ29tbWFuZC5oZWlnaHQgLyAyOwogICAgICAgIGNvbnN0IHJlY3RhbmdsZSA9IHRoaXMucmVjdGFuZ2xlUG9vbC51c2UoKTsKICAgICAgICByZWN0YW5nbGUudmlzaWJsZSA9IHRydWU7CiAgICAgICAgcmVjdGFuZ2xlLnggPSBjZW50ZXJ4OwogICAgICAgIHJlY3RhbmdsZS55ID0gY2VudGVyeTsKICAgICAgICByZWN0YW5nbGUuc2NhbGUueCA9IHJlbmRlckNvbW1hbmQud2lkdGg7CiAgICAgICAgcmVjdGFuZ2xlLnNjYWxlLnkgPSByZW5kZXJDb21tYW5kLmhlaWdodDsKICAgICAgICBkb25lUmVuZGVyaW5nU2lnbmFsLnN1YigoKSA9PiB0aGlzLnJlY3RhbmdsZVBvb2wucmVjeWNsZShyZWN0YW5nbGUpKTsKICAgICAgfSBlbHNlIGlmIChyZW5kZXJDb21tYW5kLnNoYXBlID09PSBSZW5kZXJTaGFwZS5MaW5lKSB7CiAgICAgIH0KICAgIH0KCiAgICBkb25lUmVuZGVyaW5nU2lnbmFsLmRpc3BhdGNoKCk7CgogICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnVwZGF0ZSk7CiAgfQoKICBtYWtlQ2lyY2xlKCkgewogICAgY29uc3QgcmV0ID0gbmV3IFBJWEkuR3JhcGhpY3MoKTsKICAgIHJldC5iZWdpbkZpbGwoMHg5OTY2ZmYpOwogICAgcmV0LmRyYXdDaXJjbGUoMCwgMCwgMSk7CiAgICByZXQuZW5kRmlsbCgpOwogICAgdGhpcy5jaXJjbGVzLnB1c2gocmV0KTsKICAgIHRoaXMuYXBwLnN0YWdlLmFkZENoaWxkKHJldCk7CiAgICByZXR1cm4gcmV0OwogIH0KCiAgbWFrZVJlY3RhbmdsZSgpIHsKICAgIGNvbnN0IHJldCA9IG5ldyBQSVhJLkdyYXBoaWNzKCk7CiAgICByZXQuYmVnaW5GaWxsKDB4OTk2NmZmKTsKICAgIHJldC5kcmF3UmVjdCgwLCAwLCAxLCAxKTsKICAgIHJldC5lbmRGaWxsKCk7CiAgICB0aGlzLnJlY3RhbmdsZXMucHVzaChyZXQpOwogICAgdGhpcy5hcHAuc3RhZ2UuYWRkQ2hpbGQocmV0KTsKICAgIHJldHVybiByZXQ7CiAgfQp9Cg=="},{"version":3,"sources":["Viewport.vue"],"names":[],"mappings":";AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Viewport.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"viewport\" ref=\"viewport\">\n    <canvas\n      :width=\"width\"\n      :height=\"height\"\n      ref=\"canvas\"\n      @mousemove=\"testMethod($event)\"\n    >\n    </canvas>\n    <div class=\"fps\">{{ framerate }}</div>\n    <div class=\"nodes\">nodes: {{ Root.nodeCollection.nodes.items.length }}</div>\n  </div>\n</template>\n\n<script lang='ts'>\nimport Root, { RenderShape } from \"../store/Root\";\nimport fps from \"fps\";\nimport numeral from \"numeral\";\nimport Component from \"vue-class-component\";\nimport Vue from \"vue\";\nimport * as PIXI from \"pixi.js\";\nimport deePool from \"deepool\";\nimport { SignalDispatcher } from \"ste-signals\";\n\n(window as any).root = Root;\n\n@Component({})\nexport default class Viewport extends Vue {\n  width = 0;\n  height = 0;\n  framerate = 0;\n  Root = Root;\n  mostRecentClickCoordinates = { x: 0, y: 0 };\n  app = null as any;\n  circlePool = null as any;\n  circles = [] as any[];\n  rectanglePool = null as any;\n  rectangles = [] as any[];\n  ticker = fps({ every: 10 });\n\n  created() {\n    this.ticker.on(\n      \"data\",\n      (framerate) => (this.framerate = numeral(framerate).format(\"0\"))\n    );\n  }\n\n  mounted() {\n    this.app = new PIXI.Application({\n      resizeTo: this.$refs[\"viewport\"] as any,\n      view: this.$refs[\"canvas\"] as any,\n      antialias: true,\n    });\n    this.circlePool = deePool.create(this.makeCircle);\n    this.circlePool.grow(100);\n    this.rectanglePool = deePool.create(this.makeRectangle);\n    this.rectanglePool.grow(100);\n    this.update();\n  }\n\n  testMethod(event) {\n    this.mostRecentClickCoordinates = {\n      x: event.clientX,\n      y: event.clientY,\n    };\n  }\n\n  update() {\n    if (this.$refs.viewport === undefined) return;\n\n    this.ticker.tick();\n    const viewport = this.$refs.viewport as any;\n    const canvas = this.$refs.canvas;\n    this.width = viewport.clientWidth;\n    this.height = viewport.clientHeight;\n    Root.setWindowSize(this.width, this.height);\n    Root.setMouseLocation(\n      this.mostRecentClickCoordinates.x,\n      this.mostRecentClickCoordinates.y\n    );\n\n    for (const circle of this.circles) {\n      circle.visible = false;\n    }\n\n    for (const rectangle of this.rectangles) {\n      rectangle.visible = false;\n    }\n\n    const doneRenderingSignal = new SignalDispatcher();\n    const renderCommands = Root.computeRenderCommands();\n    for (const renderCommand of renderCommands) {\n      const alpha = renderCommand.alpha ?? 0.5;\n      const hue = renderCommand.hue ?? 0;\n      const saturation = renderCommand.saturation ?? 0;\n      const lightness = renderCommand.lightness ?? 0.5;\n      const fillStyle = `hsla(${hue * 360}, ${saturation * 100}%, ${\n        lightness * 100\n      }%, ${alpha})`;\n      if (renderCommand.shape === RenderShape.Circle) {\n        const circle = this.circlePool.use();\n        circle.visible = true;\n        circle.x = renderCommand.x;\n        circle.y = renderCommand.y;\n        circle.scale.x = renderCommand.radius;\n        circle.scale.y = renderCommand.radius;\n        // circle.tint = ''\n        doneRenderingSignal.sub(() => this.circlePool.recycle(circle));\n      } else if (renderCommand.shape === RenderShape.Rectangle) {\n        const centerx = renderCommand.x - renderCommand.width / 2;\n        const centery = renderCommand.y - renderCommand.height / 2;\n        const rectangle = this.rectanglePool.use();\n        rectangle.visible = true;\n        rectangle.x = centerx;\n        rectangle.y = centery;\n        rectangle.scale.x = renderCommand.width;\n        rectangle.scale.y = renderCommand.height;\n        doneRenderingSignal.sub(() => this.rectanglePool.recycle(rectangle));\n      } else if (renderCommand.shape === RenderShape.Line) {\n      }\n    }\n\n    doneRenderingSignal.dispatch();\n\n    window.requestAnimationFrame(this.update);\n  }\n\n  makeCircle() {\n    const ret = new PIXI.Graphics();\n    ret.beginFill(0x9966ff);\n    ret.drawCircle(0, 0, 1);\n    ret.endFill();\n    this.circles.push(ret);\n    this.app.stage.addChild(ret);\n    return ret;\n  }\n\n  makeRectangle() {\n    const ret = new PIXI.Graphics();\n    ret.beginFill(0x9966ff);\n    ret.drawRect(0, 0, 1, 1);\n    ret.endFill();\n    this.rectangles.push(ret);\n    this.app.stage.addChild(ret);\n    return ret;\n  }\n}\n</script>\n\n<style scoped>\n.fps {\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  margin: 20px;\n  background-color: white;\n  width: 50px;\n  text-align: center;\n}\n.nodes {\n  position: absolute;\n  bottom: 0;\n  right: 70px;\n  margin: 20px;\n  background-color: white;\n  padding-left: 10px;\n  padding-right: 10px;\n  text-align: center;\n}\n</style>\n"]}]}