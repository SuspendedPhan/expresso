{"remainingRequest":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/WasmNode.vue?vue&type=script&lang=ts","dependencies":[{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/WasmNode.vue","mtime":1714946187073},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/babel-loader/lib/index.js","mtime":1714947394795},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/ts-loader/index.js","mtime":1714947267504},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js","mtime":1714947393584}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgppbXBvcnQgQ29tcG9uZW50IGZyb20gInZ1ZS1jbGFzcy1jb21wb25lbnQiOwppbXBvcnQge0luamVjdCwgUHJvcH0gZnJvbSAidnVlLXByb3BlcnR5LWRlY29yYXRvciI7CmltcG9ydCBWdWUgZnJvbSAidnVlIjsKaW1wb3J0IFNlYXJjaGJveCBmcm9tICJAL2NvbXBvbmVudHMvU2VhcmNoYm94LnZ1ZSI7CmltcG9ydCBXYXNtUGVuIGZyb20gIkAvY29kZS9XYXNtUGVuIjsKaW1wb3J0IHtTdWJzY3JpcHRpb259IGZyb20gInJ4anMiOwppbXBvcnQgU3RvcmUsIHtTaWJsaW5nUm90YXRpb25EaXJlY3Rpb259IGZyb20gIkAvbW9kZWxzL1N0b3JlIjsKCkBDb21wb25lbnQoewogIGNvbXBvbmVudHM6IHtTZWFyY2hib3h9Cn0pCmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdhc21Ob2RlIGV4dGVuZHMgVnVlIHsKICBAUHJvcCgpIG5vZGU7CiAgQEluamVjdCgpIG5vZGVMYXlvdXQ7CiAgQEluamVjdCgpIHBlbjsKICBASW5qZWN0KCkgc2F2ZVN0b3JlRnVuY3RvcjsKCiAgY2hpbGRyZW4gPSBbXSBhcyBhbnk7CiAgdGV4dCA9ICcnCiAgcG9zaXRpb24gPSB7CiAgICB0b3A6IDAsCiAgICBsZWZ0OiAwLAogIH07CiAgbm9kZUNob2ljZXMgPSBbXTsKICBzZWFyY2hib3hBY3RpdmUgPSBmYWxzZTsKICBzZWxlY3RlZCA9IGZhbHNlOwogIG9uS2V5ZG93bkZ1bmN0aW9uOwogIHNlYXJjaGJveFF1ZXJ5ID0gJyc7CiAgbG9jYWxMYXlvdXRQb3NpdGlvblN1YnNjcmlwdGlvbiE6IFN1YnNjcmlwdGlvbjsKCiAgcHJpdmF0ZSBvblNlbGVjdGVkTm9kZUNoYW5nZWRGdW5jdG9yID0gKCkgPT4gdGhpcy5vblNlbGVjdGVkTm9kZUNoYW5nZWQoKTsKCiAgZ2V0IHN0eWxlKCkgewogICAgcmV0dXJuIGBsZWZ0OiAke3RoaXMucG9zaXRpb24ubGVmdH1weDsgdG9wOiAke3RoaXMucG9zaXRpb24udG9wfXB4O2A7CiAgfQoKICBhc3luYyBtb3VudGVkKCkgewogICAgY29uc3Qgbm9kZSA9IHRoaXMubm9kZTsKICAgIHRoaXMuY2hpbGRyZW4gPSBXYXNtTm9kZS5nZXRDaGlsZHJlbihub2RlKTsKCiAgICBpZiAobm9kZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnQWRkT3BOb2RlJykgewogICAgICB0aGlzLnRleHQgPSAnQWRkJzsKICAgIH0gZWxzZSBpZiAobm9kZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnU3ViT3BOb2RlJykgewogICAgICB0aGlzLnRleHQgPSAnU3ViJzsKICAgIH0gZWxzZSBpZiAobm9kZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnTXVsT3BOb2RlJykgewogICAgICB0aGlzLnRleHQgPSAnTXVsJzsKICAgIH0gZWxzZSBpZiAobm9kZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnRGl2T3BOb2RlJykgewogICAgICB0aGlzLnRleHQgPSAnRGl2JzsKICAgIH0gZWxzZSBpZiAobm9kZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnTW9kT3BOb2RlJykgewogICAgICB0aGlzLnRleHQgPSAnTW9kJzsKICAgIH0gZWxzZSBpZiAobm9kZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnTnVtYmVyTm9kZScpIHsKICAgICAgdGhpcy50ZXh0ID0gbm9kZS5nZXRWYWx1ZSgpOwogICAgfSBlbHNlIGlmIChub2RlLmNvbnN0cnVjdG9yLm5hbWUgPT09ICdBdHRyaWJ1dGVSZWZlcmVuY2VOb2RlJykgewogICAgICB0aGlzLnRleHQgPSBub2RlLmdldFJlZmVyZW5jZVJhdygpLmdldE5hbWUoKTsKICAgIH0gZWxzZSBpZiAobm9kZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnRnVuY3Rpb25DYWxsTm9kZScpIHsKICAgICAgdGhpcy50ZXh0ID0gbm9kZS5nZXRDYWxsZWRGdW5jdGlvbigpLmdldE5hbWUoKTsKICAgIH0gZWxzZSBpZiAobm9kZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnUGFyYW1ldGVyTm9kZScpIHsKICAgICAgdGhpcy50ZXh0ID0gbm9kZS5nZXRGdW5jdGlvblBhcmFtZXRlcigpLmdldE5hbWUoKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUuZXJyb3Iobm9kZS5jb25zdHJ1Y3Rvci5uYW1lKTsKICAgIH0KCiAgICAod2luZG93IGFzIGFueSkud2FzbU1vZHVsZS5FbWJpbmRVdGlsLnNldFNpZ25hbExpc3RlbmVyKG5vZGUuZ2V0T25DaGFuZ2VkU2lnbmFsKCksICgpID0+IHRoaXMub25Ob2RlQ2hhbmdlZCgpKTsKCiAgICB0aGlzLm5vZGVMYXlvdXQucmVnaXN0ZXJFbGVtZW50KHRoaXMuJHJlZnNbJ25vZGUnXSwgdGhpcy5ub2RlLmdldElkKCkpOwogICAgdGhpcy5sb2NhbExheW91dFBvc2l0aW9uU3Vic2NyaXB0aW9uID0gdGhpcy5ub2RlTGF5b3V0CiAgICAgICAgLmdldExvY2FsUG9zaXRpb25PYnNlcnZhYmxlKHRoaXMubm9kZS5nZXRJZCgpKQogICAgICAgIC5zdWJzY3JpYmUoKGxvY2FsUG9zaXRpb24pID0+IHsKICAgICAgICAgIGlmIChsb2NhbFBvc2l0aW9uID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICAgIHRoaXMucG9zaXRpb24udG9wID0gbG9jYWxQb3NpdGlvbi50b3A7CiAgICAgICAgICB0aGlzLnBvc2l0aW9uLmxlZnQgPSBsb2NhbFBvc2l0aW9uLmxlZnQ7CiAgICAgICAgfSk7CiAgICB0aGlzLnBlbi5vblNlbGVjdGVkTm9kZUNoYW5nZWQuc3ViKHRoaXMub25TZWxlY3RlZE5vZGVDaGFuZ2VkRnVuY3Rvcik7CgogICAgdGhpcy5vbktleWRvd25GdW5jdGlvbiA9IGV2ZW50ID0+IHRoaXMub25LZXlkb3duKGV2ZW50KTsKCiAgICAvLyBTZXQgdGltZW91dCwgb3RoZXJ3aXNlIG5vZGUgcmVwbGFjZW1lbnQgd2lsbCBnZXQgdGhlIGVudGVyIGtleSByaWdodCBhd2F5LgogICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gewogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5vbktleWRvd25GdW5jdGlvbik7CiAgICB9LCAwKTsKCiAgICAvLyBXZSBleHBlY3QgdGhlIG5vZGUgd2UgcmVwbGFjZWQgdG8gc2V0IHRoZSBwZW4ncyBzZWxlY3RlZCBub2RlIHRvIGJlIG91ciBub2RlCiAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMubm9kZS5nZXRJZCgpID09PSB0aGlzLnBlbi5nZXRTZWxlY3RlZE5vZGUoKT8uZ2V0SWQoKTsKICAgIGlmIChzZWxlY3RlZCkgewogICAgICB0aGlzLnNlbGVjdGVkID0gdHJ1ZTsKICAgIH0KICB9CgogIHByaXZhdGUgb25LZXlkb3duKGV2ZW50KSB7CiAgICBpZiAoIXRoaXMuc2VsZWN0ZWQpIHJldHVybjsKCiAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7CiAgICAgIHRoaXMuc2VhcmNoYm94QWN0aXZlID0gdHJ1ZTsKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICh0aGlzLiRyZWZzWydzZWFyY2hib3gnXSBhcyBhbnkpLmZvY3VzKCk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5vbktleWRvd25BcnJvd3MoZXZlbnQpOwogICAgfQogIH0KCiAgcHJpdmF0ZSBvbktleWRvd25BcnJvd3MoZXZlbnQpIHsKICAgIGlmICh0aGlzLm5vZGUuZ2V0UGFyZW50KCkgPT09IG51bGwpIHsKICAgICAgY29uc29sZS5lcnJvcignb25rZXlkb3duIGdldCBwYXJlbnQgbnVsbCcpOwogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgcGFyZW50ID0gdGhpcy5ub2RlLmdldFBhcmVudCgpOwogICAgaWYgKHBhcmVudC5pc05vZGUoKSkgewogICAgICB0aGlzLm9uS2V5ZG93bkRvd24oZXZlbnQpOwogICAgICBjb25zdCBwYXJlbnROb2RlID0gcGFyZW50LmdldE5vZGUoKTsKICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93VXAnKSB7CiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5wZW4uc2V0U2VsZWN0ZWROb2RlKHBhcmVudE5vZGUpLCAwKTsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93TGVmdCcpIHsKICAgICAgICBjb25zdCBzZWxlY3RlZE5vZGUgPSBTdG9yZS5nZXRTaWJsaW5nKHBhcmVudE5vZGUsIHRoaXMubm9kZSwgU2libGluZ1JvdGF0aW9uRGlyZWN0aW9uLkxlZnQpOwogICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHRoaXMucGVuLnNldFNlbGVjdGVkTm9kZShzZWxlY3RlZE5vZGUpLCAwKTsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93UmlnaHQnKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWROb2RlID0gU3RvcmUuZ2V0U2libGluZyhwYXJlbnROb2RlLCB0aGlzLm5vZGUsIFNpYmxpbmdSb3RhdGlvbkRpcmVjdGlvbi5SaWdodCk7CiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5wZW4uc2V0U2VsZWN0ZWROb2RlKHNlbGVjdGVkTm9kZSksIDApOwogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAocGFyZW50LmlzQXR0cmlidXRlKCkpIHsKICAgICAgdGhpcy5vbktleWRvd25Eb3duKGV2ZW50KTsKICAgIH0KICB9CgogIHByaXZhdGUgb25LZXlkb3duRG93bihldmVudCkgewogICAgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93RG93bicpIHsKICAgICAgY29uc3QgY2hpbGRyZW4gPSBXYXNtTm9kZS5nZXRDaGlsZHJlbih0aGlzLm5vZGUpOwogICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHRoaXMucGVuLnNldFNlbGVjdGVkTm9kZShjaGlsZHJlblswXSksIDApOwogICAgICB9CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9CiAgfQoKICBkZXN0cm95ZWQoKSB7CiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5vbktleWRvd25GdW5jdGlvbik7CiAgICB0aGlzLmxvY2FsTGF5b3V0UG9zaXRpb25TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgIHRoaXMucGVuLm9uU2VsZWN0ZWROb2RlQ2hhbmdlZC51bnN1Yih0aGlzLm9uU2VsZWN0ZWROb2RlQ2hhbmdlZEZ1bmN0b3IpOwogIH0KCiAgcHJpdmF0ZSBvbkNsaWNrKCkgewogICAgdGhpcy5wZW4uc2V0U2VsZWN0ZWROb2RlKHRoaXMubm9kZSk7CiAgICB0aGlzLnNlbGVjdGVkID0gdHJ1ZTsKICAgIHRoaXMubm9kZUNob2ljZXMgPSBXYXNtUGVuLmdldE5vZGVDaG9pY2VzKHRoaXMubm9kZSwgdGhpcy5zZWFyY2hib3hRdWVyeSk7CiAgfQoKICBwcml2YXRlIG9uU2VhcmNoYm94UXVlcnlJbnB1dChxdWVyeSkgewogICAgdGhpcy5zZWFyY2hib3hRdWVyeSA9IHF1ZXJ5OwogICAgdGhpcy5ub2RlQ2hvaWNlcyA9IFdhc21QZW4uZ2V0Tm9kZUNob2ljZXModGhpcy5ub2RlLCB0aGlzLnNlYXJjaGJveFF1ZXJ5KTsKICB9CgogIHByaXZhdGUgb25TZWFyY2hib3hCbHVyKCkgewogICAgdGhpcy5zZWFyY2hib3hBY3RpdmUgPSBmYWxzZTsKICB9CgogIHByaXZhdGUgb25TZWFyY2hib3hDaG9pY2VDb21taXR0ZWQoY2hvaWNlKSB7CiAgICBjb25zdCBuZXdOb2RlID0gY2hvaWNlLm5vZGVNYWtlckZ1bmN0aW9uKCk7CiAgICB0aGlzLm5vZGUucmVwbGFjZShuZXdOb2RlKTsKICAgIHRoaXMucGVuLnNldFNlbGVjdGVkTm9kZShuZXdOb2RlKTsKICAgIHRoaXMuc2F2ZVN0b3JlRnVuY3RvcigpOwogIH0KCiAgcHJpdmF0ZSBvblNlbGVjdGVkTm9kZUNoYW5nZWQoKSB7CiAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMucGVuLnNlbGVjdGVkTm9kZSA9PSBudWxsID8gZmFsc2UgOiB0aGlzLm5vZGUuZXF1YWxzKHRoaXMucGVuLnNlbGVjdGVkTm9kZSk7CiAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgdGhpcy5zZWxlY3RlZCA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgIHRoaXMuc2VhcmNoYm94QWN0aXZlID0gZmFsc2U7CiAgICAgIHRoaXMubm9kZUNob2ljZXMgPSBbXTsKICAgIH0KICB9CgogIHByaXZhdGUgb25Ob2RlQ2hhbmdlZCgpIHsKICAgIHRoaXMuY2hpbGRyZW4gPSBXYXNtTm9kZS5nZXRDaGlsZHJlbih0aGlzLm5vZGUpOwogICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gdGhpcy5ub2RlTGF5b3V0LnJlY2FsY3VsYXRlKCkpOwogIH0KCiAgcHVibGljIHN0YXRpYyBnZXRDaGlsZHJlbihub2RlKSB7CiAgICByZXR1cm4gU3RvcmUuZ2V0Q2hpbGRyZW4obm9kZSk7CiAgfQoKICBwcml2YXRlIHN0YXRpYyBpc0JpbmFyeU9wTm9kZShwYXJlbnRSYXcpIHsKICAgIHJldHVybiBTdG9yZS5pc0JpbmFyeU9wTm9kZShwYXJlbnRSYXcpOwogIH0KfQoK"},{"version":3,"sources":["WasmNode.vue"],"names":[],"mappings":";;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"WasmNode.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"absolute\" ref=\"node\" :style=\"style\">\n    <div :class=\"['border', 'border-black', {'border-opacity-0': !selected}]\">\n      <div class='bg-white' @click=\"onClick\">{{ text }}</div>\n      <Searchbox v-if=\"searchboxActive\" ref='searchbox' :choices=\"nodeChoices\" :query='searchboxQuery'\n                 @blur=\"onSearchboxBlur\" @queryInput=\"onSearchboxQueryInput\"\n                 @choiceCommitted=\"onSearchboxChoiceCommitted\"></Searchbox>\n    </div>\n    <WasmNode v-for=\"child of children\" :key='child.getId()' :node=\"child\"></WasmNode>\n  </div>\n</template>\n\n<script lang=\"ts\">\n\nimport Component from \"vue-class-component\";\nimport {Inject, Prop} from \"vue-property-decorator\";\nimport Vue from \"vue\";\nimport Searchbox from \"@/components/Searchbox.vue\";\nimport WasmPen from \"@/code/WasmPen\";\nimport {Subscription} from \"rxjs\";\nimport Store, {SiblingRotationDirection} from \"@/models/Store\";\n\n@Component({\n  components: {Searchbox}\n})\nexport default class WasmNode extends Vue {\n  @Prop() node;\n  @Inject() nodeLayout;\n  @Inject() pen;\n  @Inject() saveStoreFunctor;\n\n  children = [] as any;\n  text = ''\n  position = {\n    top: 0,\n    left: 0,\n  };\n  nodeChoices = [];\n  searchboxActive = false;\n  selected = false;\n  onKeydownFunction;\n  searchboxQuery = '';\n  localLayoutPositionSubscription!: Subscription;\n\n  private onSelectedNodeChangedFunctor = () => this.onSelectedNodeChanged();\n\n  get style() {\n    return `left: ${this.position.left}px; top: ${this.position.top}px;`;\n  }\n\n  async mounted() {\n    const node = this.node;\n    this.children = WasmNode.getChildren(node);\n\n    if (node.constructor.name === 'AddOpNode') {\n      this.text = 'Add';\n    } else if (node.constructor.name === 'SubOpNode') {\n      this.text = 'Sub';\n    } else if (node.constructor.name === 'MulOpNode') {\n      this.text = 'Mul';\n    } else if (node.constructor.name === 'DivOpNode') {\n      this.text = 'Div';\n    } else if (node.constructor.name === 'ModOpNode') {\n      this.text = 'Mod';\n    } else if (node.constructor.name === 'NumberNode') {\n      this.text = node.getValue();\n    } else if (node.constructor.name === 'AttributeReferenceNode') {\n      this.text = node.getReferenceRaw().getName();\n    } else if (node.constructor.name === 'FunctionCallNode') {\n      this.text = node.getCalledFunction().getName();\n    } else if (node.constructor.name === 'ParameterNode') {\n      this.text = node.getFunctionParameter().getName();\n    } else {\n      console.error(node.constructor.name);\n    }\n\n    (window as any).wasmModule.EmbindUtil.setSignalListener(node.getOnChangedSignal(), () => this.onNodeChanged());\n\n    this.nodeLayout.registerElement(this.$refs['node'], this.node.getId());\n    this.localLayoutPositionSubscription = this.nodeLayout\n        .getLocalPositionObservable(this.node.getId())\n        .subscribe((localPosition) => {\n          if (localPosition === undefined) return;\n          this.position.top = localPosition.top;\n          this.position.left = localPosition.left;\n        });\n    this.pen.onSelectedNodeChanged.sub(this.onSelectedNodeChangedFunctor);\n\n    this.onKeydownFunction = event => this.onKeydown(event);\n\n    // Set timeout, otherwise node replacement will get the enter key right away.\n    window.setTimeout(() => {\n      document.addEventListener('keydown', this.onKeydownFunction);\n    }, 0);\n\n    // We expect the node we replaced to set the pen's selected node to be our node\n    const selected = this.node.getId() === this.pen.getSelectedNode()?.getId();\n    if (selected) {\n      this.selected = true;\n    }\n  }\n\n  private onKeydown(event) {\n    if (!this.selected) return;\n\n    if (event.key === 'Enter') {\n      this.searchboxActive = true;\n      this.$nextTick(() => {\n        (this.$refs['searchbox'] as any).focus();\n      });\n    } else {\n      this.onKeydownArrows(event);\n    }\n  }\n\n  private onKeydownArrows(event) {\n    if (this.node.getParent() === null) {\n      console.error('onkeydown get parent null');\n      return;\n    }\n\n    const parent = this.node.getParent();\n    if (parent.isNode()) {\n      this.onKeydownDown(event);\n      const parentNode = parent.getNode();\n      if (event.key === 'ArrowUp') {\n        window.setTimeout(() => this.pen.setSelectedNode(parentNode), 0);\n        event.preventDefault();\n      } else if (event.key === 'ArrowLeft') {\n        const selectedNode = Store.getSibling(parentNode, this.node, SiblingRotationDirection.Left);\n        window.setTimeout(() => this.pen.setSelectedNode(selectedNode), 0);\n        event.preventDefault();\n      } else if (event.key === 'ArrowRight') {\n        const selectedNode = Store.getSibling(parentNode, this.node, SiblingRotationDirection.Right);\n        window.setTimeout(() => this.pen.setSelectedNode(selectedNode), 0);\n        event.preventDefault();\n      }\n    } else if (parent.isAttribute()) {\n      this.onKeydownDown(event);\n    }\n  }\n\n  private onKeydownDown(event) {\n    if (event.key === 'ArrowDown') {\n      const children = WasmNode.getChildren(this.node);\n      if (children.length > 0) {\n        window.setTimeout(() => this.pen.setSelectedNode(children[0]), 0);\n      }\n      event.preventDefault();\n    }\n  }\n\n  destroyed() {\n    document.removeEventListener('keydown', this.onKeydownFunction);\n    this.localLayoutPositionSubscription.unsubscribe();\n    this.pen.onSelectedNodeChanged.unsub(this.onSelectedNodeChangedFunctor);\n  }\n\n  private onClick() {\n    this.pen.setSelectedNode(this.node);\n    this.selected = true;\n    this.nodeChoices = WasmPen.getNodeChoices(this.node, this.searchboxQuery);\n  }\n\n  private onSearchboxQueryInput(query) {\n    this.searchboxQuery = query;\n    this.nodeChoices = WasmPen.getNodeChoices(this.node, this.searchboxQuery);\n  }\n\n  private onSearchboxBlur() {\n    this.searchboxActive = false;\n  }\n\n  private onSearchboxChoiceCommitted(choice) {\n    const newNode = choice.nodeMakerFunction();\n    this.node.replace(newNode);\n    this.pen.setSelectedNode(newNode);\n    this.saveStoreFunctor();\n  }\n\n  private onSelectedNodeChanged() {\n    const selected = this.pen.selectedNode == null ? false : this.node.equals(this.pen.selectedNode);\n    if (selected) {\n      this.selected = true;\n    } else {\n      this.selected = false;\n      this.searchboxActive = false;\n      this.nodeChoices = [];\n    }\n  }\n\n  private onNodeChanged() {\n    this.children = WasmNode.getChildren(this.node);\n    this.$nextTick(() => this.nodeLayout.recalculate());\n  }\n\n  public static getChildren(node) {\n    return Store.getChildren(node);\n  }\n\n  private static isBinaryOpNode(parentRaw) {\n    return Store.isBinaryOpNode(parentRaw);\n  }\n}\n\n</script>\n<style scoped>\n</style>"]}]}