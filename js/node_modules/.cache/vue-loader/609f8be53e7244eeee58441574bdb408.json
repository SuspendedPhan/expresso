{"remainingRequest":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/Organism.vue?vue&type=script&lang=ts","dependencies":[{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/components/Organism.vue","mtime":1714946187071},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/babel-loader/lib/index.js","mtime":1714947394795},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/ts-loader/index.js","mtime":1714947267504},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/vue-loader/lib/index.js","mtime":1714947393584}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB3dSBmcm9tICJ3dSI7CmltcG9ydCBSb290IGZyb20gIi4uL3N0b3JlL1Jvb3QiOwppbXBvcnQgQXR0cmlidXRlQ29tcG9uZW50IGZyb20gIi4vQXR0cmlidXRlLnZ1ZSI7CmltcG9ydCBSZXNpemVTZW5zb3IgZnJvbSAiY3NzLWVsZW1lbnQtcXVlcmllcy9zcmMvUmVzaXplU2Vuc29yIjsKaW1wb3J0IFZ1ZSBmcm9tICJ2dWUiOwppbXBvcnQgQ29tcG9uZW50IGZyb20gInZ1ZS1jbGFzcy1jb21wb25lbnQiOwppbXBvcnQgeyBQcm9wIH0gZnJvbSAidnVlLXByb3BlcnR5LWRlY29yYXRvciI7CmltcG9ydCBBdHRyaWJ1dGUgZnJvbSAiQC9tb2RlbHMvQXR0cmlidXRlIjsKaW1wb3J0IHtQcmltaXRpdmV9IGZyb20gIkAvbW9kZWxzL1R5cGUiOwoKQENvbXBvbmVudCh7IGNvbXBvbmVudHM6IHsgQXR0cmlidXRlOiBBdHRyaWJ1dGVDb21wb25lbnQgfSB9KQpleHBvcnQgZGVmYXVsdCBjbGFzcyBPcmdhbmlzbSBleHRlbmRzIFZ1ZSB7CiAgQFByb3AoKSBvcmdhbmlzbSE6IGFueTsKICBAUHJvcCgpIGlzUm9vdCE6IGJvb2xlYW47CgogIHJvb3QgPSBSb290OwogIGF0dHJpYnV0ZVN0b3JlID0gUm9vdC5hdHRyaWJ1dGVTdG9yZTsKICBtZXRhb3JnYW5pc21Db2xsZWN0aW9uID0gUm9vdC5tZXRhb3JnYW5pc21Db2xsZWN0aW9uOwogIHNlbGVjdGVkUHJpbWl0aXZlSWQgPSBSb290Lm1ldGFvcmdhbmlzbUNvbGxlY3Rpb24uZ2V0TWV0YW9yZ2FuaXNtcygpWzBdLmlkOwogIGF0dHJpYnV0ZU5hbWUgPSAiIjsKICBlZGl0YWJsZUF0dHJpYnV0ZXMgPSBbXSBhcyBhbnlbXTsKICBwb3NpdGlvbiA9IHsKICAgIHRvcDogMCwKICAgIGxlZnQ6IDAsCiAgfTsKCiAgZ2V0IHN0eWxlKCkgewogICAgcmV0dXJuIGBsZWZ0OiAke3RoaXMucG9zaXRpb24ubGVmdH1weDsgdG9wOiAke3RoaXMucG9zaXRpb24udG9wfXB4O2A7CiAgfQoKICBnZXROb2RlRm9yQXR0cmlidXRlKGF0dHJpYnV0ZSkgewogICAgUm9vdC5ub2RlQ29sbGVjdGlvbi5ub2RlUGFyZW50cy5sZW5ndGg7IC8vIHRyaWdnZXIgcmVhY3RpdmUKICAgIHJldHVybiBSb290Lm5vZGVTdG9yZS5nZXRDaGlsZCgKICAgICAgUm9vdC5hdHRyaWJ1dGVTdG9yZS5nZXRSb290Tm9kZShhdHRyaWJ1dGUpLAogICAgICAwCiAgICApOwogIH0KCiAgc3Bhd24oKSB7CiAgICBjb25zdCBtZXRhb3JnYW5pc20gPSB0aGlzLm1ldGFvcmdhbmlzbUNvbGxlY3Rpb24uZ2V0RnJvbUlkKAogICAgICB0aGlzLnNlbGVjdGVkUHJpbWl0aXZlSWQKICAgICk7CiAgICBjb25zdCBvcmdhbiA9IHRoaXMucm9vdC5vcmdhbmlzbUNvbGxlY3Rpb24ucHV0RnJvbU1ldGEoCiAgICAgIHRoaXMucm9vdC53b3JkQ29sbGVjdGlvbi5nZXRSYW5kb21Xb3JkKCksCiAgICAgIG1ldGFvcmdhbmlzbQogICAgKTsKICAgIHRoaXMucm9vdC5vcmdhbmlzbUNvbGxlY3Rpb24uYWRkQ2hpbGQodGhpcy5vcmdhbmlzbSwgb3JnYW4pOwogICAgdGhpcy5yb290LnNhdmUoKTsKICB9CgogIGFkZEF0dHJpYnV0ZSgpIHsKICAgIGNvbnN0IGF0dHJpYnV0ZU5hbWUgPQogICAgICB0aGlzLmF0dHJpYnV0ZU5hbWUgPT09ICIiCiAgICAgICAgPyB0aGlzLnJvb3Qud29yZENvbGxlY3Rpb24uZ2V0UmFuZG9tV29yZCgpCiAgICAgICAgOiB0aGlzLmF0dHJpYnV0ZU5hbWU7CiAgICB0aGlzLnJvb3QuYXR0cmlidXRlQ29sbGVjdGlvbi5wdXRFZGl0YWJsZSh0aGlzLm9yZ2FuaXNtLCBhdHRyaWJ1dGVOYW1lLCBQcmltaXRpdmUuVW5kZXRlcm1pbmVkKTsKICAgIHRoaXMucm9vdC5zYXZlKCk7CiAgfQoKICBjbGVhclN0b3JhZ2UoKSB7CiAgICB0aGlzLnJvb3QuY2xlYXJTdG9yYWdlKCk7CiAgfQoKICByZW1vdmVPcmdhbmlzbShvcmdhbmlzbSkgewogICAgdGhpcy5yb290Lm9yZ2FuaXNtQ29sbGVjdGlvbi5yZW1vdmUob3JnYW5pc20pOwogICAgdGhpcy5yb290LnNhdmUoKTsKICB9CgogIGluaXQoKSB7CiAgICBjb25zdCBlbGVtZW50ID0gdGhpcy4kcmVmc1sib3JnYW5pc20iXSBhcyBhbnk7CiAgICBuZXcgUmVzaXplU2Vuc29yKGVsZW1lbnQsICgpID0+IHsKICAgICAgdGhpcy5yb290Lm9yZ2FuaXNtTGF5b3V0LnJlY2FsY3VsYXRlKCk7CiAgICB9KTsKCiAgICB0aGlzLnJvb3Qub3JnYW5pc21MYXlvdXQucmVnaXN0ZXJFbGVtZW50KGVsZW1lbnQsIHRoaXMub3JnYW5pc20uaWQpOwogICAgdGhpcy5yb290Lm9yZ2FuaXNtTGF5b3V0CiAgICAgIC5nZXRMb2NhbFBvc2l0aW9uT2JzZXJ2YWJsZSh0aGlzLm9yZ2FuaXNtLmlkKQogICAgICAuc3Vic2NyaWJlKChsb2NhbFBvc2l0aW9uKSA9PiB7CiAgICAgICAgdGhpcy5wb3NpdGlvbi50b3AgPSBsb2NhbFBvc2l0aW9uLnRvcDsKICAgICAgICB0aGlzLnBvc2l0aW9uLmxlZnQgPSBsb2NhbFBvc2l0aW9uLmxlZnQ7CiAgICAgIH0pOwoKICAgIEF0dHJpYnV0ZS5vbkF0dHJpYnV0ZUNvdW50Q2hhbmdlZC5zdWIoKCkgPT4gewogICAgICBWdWUuc2V0KHRoaXMsICJlZGl0YWJsZUF0dHJpYnV0ZXMiLCB0aGlzLmdldEVkaXRhYmxlQXR0cmlidXRlcygpKTsKICAgIH0pOwogICAgdGhpcy5lZGl0YWJsZUF0dHJpYnV0ZXMgPSB0aGlzLmdldEVkaXRhYmxlQXR0cmlidXRlcygpOwogIH0KCiAgZ2V0RWRpdGFibGVBdHRyaWJ1dGVzKCkgewogICAgcmV0dXJuIEFycmF5LmZyb20oQXR0cmlidXRlLmdldEVkaXRhYmxlcyh0aGlzLm9yZ2FuaXNtKSk7CiAgfQoKICBnZXRNZXRhbmFtZShvcmdhbmlzbSkgewogICAgcmV0dXJuIHRoaXMucm9vdC5tZXRhb3JnYW5pc21Db2xsZWN0aW9uLmdldEZyb21JZChvcmdhbmlzbS5tZXRhb3JnYW5pc21JZCkubmFtZTsKICB9CgogIG1vdW50ZWQoKSB7CiAgICBpZiAodGhpcy5vcmdhbmlzbSA9PSBudWxsKSB7CiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHRoaXMuaW5pdCgpLCAyMDApOwogICAgICByZXR1cm47CiAgICB9IGVsc2UgewogICAgICB0aGlzLmluaXQoKTsKICAgIH0KICB9CgogIGRlc3Ryb3llZCgpIHsKICAgIHRoaXMucm9vdC5vcmdhbmlzbUxheW91dC5yZWNhbGN1bGF0ZSgpOwogIH0KfQo="},{"version":3,"sources":["Organism.vue"],"names":[],"mappings":";AA+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Organism.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div v-if=\"organism\" class=\"organism\" ref=\"organism\" :style=\"style\">\n    <div class=\"title-bar\">\n      <div class=\"organism-name\">\n        {{ organism.name }} ({{ getMetaname(organism) }})\n      </div>\n      <button\n        v-if=\"!isRoot\"\n        class=\"button\"\n        @click=\"removeOrganism(organism)\"\n      ></button>\n    </div>\n    <div class=\"controls\">\n      <select v-model=\"selectedPrimitiveId\">\n        <option\n          v-for=\"metaorganism in metaorganismCollection.getMetaorganisms()\"\n          :key=\"metaorganism.id\"\n          :value=\"metaorganism.id\"\n        >\n          {{ metaorganism.name }}\n        </option>\n      </select>\n      <button @click=\"spawn\">Spawn Suborganism</button>\n      <input placeholder=\"Attribute name\" v-model=\"attributeName\" />\n      <button @click=\"addAttribute\">Add Attribute</button>\n    </div>\n    <div class=\"attribute-group\">\n      <div\n        class=\"attribute\"\n        v-for=\"(attribute, index) in editableAttributes\"\n        :key=\"attribute.id\"\n      >\n        <div v-if=\"index !== 0\" class=\"divider\"></div>\n        <Attribute :attributeModel=\"attribute\" />\n      </div>\n    </div>\n    <Organism\n      class=\"organ\"\n      v-for=\"organ in root.organismCollection.getChildren(organism)\"\n      :key=\"organ.id\"\n      :organism=\"organ\"\n    >\n    </Organism>\n  </div>\n</template>\n\n<script lang='ts'>\nimport wu from \"wu\";\nimport Root from \"../store/Root\";\nimport AttributeComponent from \"./Attribute.vue\";\nimport ResizeSensor from \"css-element-queries/src/ResizeSensor\";\nimport Vue from \"vue\";\nimport Component from \"vue-class-component\";\nimport { Prop } from \"vue-property-decorator\";\nimport Attribute from \"@/models/Attribute\";\nimport {Primitive} from \"@/models/Type\";\n\n@Component({ components: { Attribute: AttributeComponent } })\nexport default class Organism extends Vue {\n  @Prop() organism!: any;\n  @Prop() isRoot!: boolean;\n\n  root = Root;\n  attributeStore = Root.attributeStore;\n  metaorganismCollection = Root.metaorganismCollection;\n  selectedPrimitiveId = Root.metaorganismCollection.getMetaorganisms()[0].id;\n  attributeName = \"\";\n  editableAttributes = [] as any[];\n  position = {\n    top: 0,\n    left: 0,\n  };\n\n  get style() {\n    return `left: ${this.position.left}px; top: ${this.position.top}px;`;\n  }\n\n  getNodeForAttribute(attribute) {\n    Root.nodeCollection.nodeParents.length; // trigger reactive\n    return Root.nodeStore.getChild(\n      Root.attributeStore.getRootNode(attribute),\n      0\n    );\n  }\n\n  spawn() {\n    const metaorganism = this.metaorganismCollection.getFromId(\n      this.selectedPrimitiveId\n    );\n    const organ = this.root.organismCollection.putFromMeta(\n      this.root.wordCollection.getRandomWord(),\n      metaorganism\n    );\n    this.root.organismCollection.addChild(this.organism, organ);\n    this.root.save();\n  }\n\n  addAttribute() {\n    const attributeName =\n      this.attributeName === \"\"\n        ? this.root.wordCollection.getRandomWord()\n        : this.attributeName;\n    this.root.attributeCollection.putEditable(this.organism, attributeName, Primitive.Undetermined);\n    this.root.save();\n  }\n\n  clearStorage() {\n    this.root.clearStorage();\n  }\n\n  removeOrganism(organism) {\n    this.root.organismCollection.remove(organism);\n    this.root.save();\n  }\n\n  init() {\n    const element = this.$refs[\"organism\"] as any;\n    new ResizeSensor(element, () => {\n      this.root.organismLayout.recalculate();\n    });\n\n    this.root.organismLayout.registerElement(element, this.organism.id);\n    this.root.organismLayout\n      .getLocalPositionObservable(this.organism.id)\n      .subscribe((localPosition) => {\n        this.position.top = localPosition.top;\n        this.position.left = localPosition.left;\n      });\n\n    Attribute.onAttributeCountChanged.sub(() => {\n      Vue.set(this, \"editableAttributes\", this.getEditableAttributes());\n    });\n    this.editableAttributes = this.getEditableAttributes();\n  }\n\n  getEditableAttributes() {\n    return Array.from(Attribute.getEditables(this.organism));\n  }\n\n  getMetaname(organism) {\n    return this.root.metaorganismCollection.getFromId(organism.metaorganismId).name;\n  }\n\n  mounted() {\n    if (this.organism == null) {\n      window.setTimeout(() => this.init(), 200);\n      return;\n    } else {\n      this.init();\n    }\n  }\n\n  destroyed() {\n    this.root.organismLayout.recalculate();\n  }\n}\n</script>\n\n<style scoped>\n.organism {\n  position: absolute;\n  /* margin-bottom: 20px; */\n  border: 1px solid black;\n  padding-left: 20px;\n  padding-right: 20px;\n  padding-top: 20px;\n  border-radius: 2px;\n  /* margin-top: 10px; */\n  background-color: white;\n}\n.controls {\n  display: grid;\n  grid-template-columns: max-content max-content;\n  gap: 10px;\n  margin-top: 10px;\n  margin-bottom: 10px;\n}\n.attribute-group {\n  display: grid;\n  grid-auto-rows: auto;\n  /* gap: 10px; */\n}\n.divider {\n  border-bottom: 2px solid rgba(0, 0, 0, 0.2);\n  margin-bottom: 20px;\n  margin-top: 10px;\n}\n.organism-name {\n  color: #4dc47d;\n  font-weight: 500;\n  font-size: 24px;\n}\n.title-bar {\n  display: flex;\n  justify-content: space-between;\n}\n.button {\n  background-image: url(\"/icons/remove.svg\");\n  background-size: 16px 16px;\n  background-repeat: no-repeat;\n  background-position: center;\n  width: 20px;\n  height: 20px;\n  border: none;\n}\n</style>\n"]}]}