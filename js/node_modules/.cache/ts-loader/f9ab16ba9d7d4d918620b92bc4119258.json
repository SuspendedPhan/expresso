{"remainingRequest":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/babel-loader/lib/index.js!/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/ts-loader/index.js??ref--14-2!/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/eslint-loader/index.js??ref--13-0!/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/store/Pen.ts","dependencies":[{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/store/Pen.ts","mtime":1714946187077},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/babel.config.js","mtime":1714946187052},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/cache-loader/dist/cjs.js","mtime":1714947270264},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/babel-loader/lib/index.js","mtime":1714947394795},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/ts-loader/index.js","mtime":1714947267504},{"path":"/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/eslint-loader/index.js","mtime":1714947270651}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCB3dSBmcm9tICJ3dSI7CmltcG9ydCBGdW5jdGlvbnMgZnJvbSAiLi4vY29kZS9GdW5jdGlvbnMiOwppbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICJldmVudHMiOwppbXBvcnQgeyBQcmltaXRpdmUgfSBmcm9tICJAL21vZGVscy9UeXBlIjsKaW1wb3J0IEF0dHJpYnV0ZSBmcm9tICJAL21vZGVscy9BdHRyaWJ1dGUiOwppbXBvcnQgTWV0YXN0cnVjdCBmcm9tICJAL21vZGVscy9NZXRhc3RydWN0IjsKaW1wb3J0IE5vZGUgZnJvbSAiQC9tb2RlbHMvTm9kZSI7CmV4cG9ydCB2YXIgUGVuUG9zaXRpb25SZWxhdGlvbjsKKGZ1bmN0aW9uIChQZW5Qb3NpdGlvblJlbGF0aW9uKSB7CiAgUGVuUG9zaXRpb25SZWxhdGlvblsiT24iXSA9ICJPbiI7CiAgUGVuUG9zaXRpb25SZWxhdGlvblsiQWZ0ZXIiXSA9ICJBZnRlciI7CiAgUGVuUG9zaXRpb25SZWxhdGlvblsiQmVmb3JlIl0gPSAiQmVmb3JlIjsKfSkoUGVuUG9zaXRpb25SZWxhdGlvbiB8fCAoUGVuUG9zaXRpb25SZWxhdGlvbiA9IHt9KSk7CmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBlbiB7CiAgY29uc3RydWN0b3Iocm9vdCkgewogICAgdGhpcy5yb290ID0gcm9vdDsKICAgIHRoaXMucGVuUG9zaXRpb24gPSB7CiAgICAgIHBvc2l0aW9uVHlwZTogIk5vbmUiCiAgICB9OwogICAgdGhpcy5xdWVyeSA9ICIiOwogICAgdGhpcy5pc1F1ZXJ5aW5nID0gZmFsc2U7CiAgICB0aGlzLnNlbGVjdGlvbiA9IG51bGw7CiAgICB0aGlzLmV2ZW50cyA9IG5ldyBFdmVudEVtaXR0ZXIoKTsKICAgIHRoaXMuZXZlbnRzLnNldE1heExpc3RlbmVycygxMDAwKTsKICB9CiAgZ2V0IG5vZGVDb2xsZWN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucm9vdC5ub2RlU3RvcmU7CiAgfQogIC8vIC0tLSBHRVRTIC0tLQogIGdldE5vZGVDaG9pY2VzKCkgewogICAgaWYgKCF0aGlzLmlzUXVlcnlpbmcpIHJldHVybiB3dShbXSk7CiAgICBjb25zdCBhbnN3ZXIgPSBbXTsKICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5xdWVyeTsKICAgIGNvbnN0IHJlcXVpcmVkVHlwZSA9IHRoaXMuZ2V0UG9pbnRlZE5vZGUoKS5kYXRhdHlwZTsKICAgIC8vIC0tLSBudW1iZXIgLS0tCiAgICBjb25zdCBudW1iZXIgPSBOdW1iZXIucGFyc2VGbG9hdCh0aGlzLnF1ZXJ5KTsKICAgIGlmICghTnVtYmVyLmlzTmFOKG51bWJlcikpIHsKICAgICAgaWYgKHJlcXVpcmVkVHlwZSA9PT0gUHJpbWl0aXZlLk51bWJlciB8fCByZXF1aXJlZFR5cGUgPT09IFByaW1pdGl2ZS5VbmRldGVybWluZWQpIHsKICAgICAgICBhbnN3ZXIucHVzaCh7CiAgICAgICAgICB0ZXh0OiBudW1iZXIudG9TdHJpbmcoKSwKICAgICAgICAgIGFkZE5vZGVGdW5jdGlvbjogKCkgPT4gdGhpcy5ub2RlQ29sbGVjdGlvbi5hZGROdW1iZXIobnVtYmVyKQogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHJlcXVpcmVkVHlwZSBpbnN0YW5jZW9mIE1ldGFzdHJ1Y3QpIHsKICAgICAgICBjb25zb2xlLmxvZygiZHVubm8gd2hhdCB0byBkbyB3aXRoIHN0cnVjdHMiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmFzc2VydChmYWxzZSwgcmVxdWlyZWRUeXBlKTsKICAgICAgfQogICAgICByZXR1cm4gd3UoYW5zd2VyKTsKICAgIH0KICAgIC8vIC0tLSBhdHRyaWJ1dGVzIC0tLQogICAgY29uc3QgcG9pbnRlZEF0dHJpYnV0ZSA9IHRoaXMucm9vdC5hdHRyaWJ1dGVDb2xsZWN0aW9uLmdldEF0dHJpYnV0ZUZvck5vZGUodGhpcy5nZXRQb2ludGVkTm9kZSgpKTsKICAgIGNvbnN0IHBvaW50ZWRPcmdhbmlzbSA9IHRoaXMucm9vdC5hdHRyaWJ1dGVDb2xsZWN0aW9uLmdldE9yZ2FuaXNtRm9yQXR0cmlidXRlKHBvaW50ZWRBdHRyaWJ1dGUpOwogICAgY29uc3QgYW5jZXN0b3JzID0gdGhpcy5yb290Lm9yZ2FuaXNtQ29sbGVjdGlvbi5nZXRBbmNlc3RvcnMocG9pbnRlZE9yZ2FuaXNtKTsKICAgIGZvciAoY29uc3Qgb3JnYW5pc20gb2Ygd3UuY2hhaW4oW3BvaW50ZWRPcmdhbmlzbV0sIGFuY2VzdG9ycykpIHsKICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHRoaXMucm9vdC5hdHRyaWJ1dGVDb2xsZWN0aW9uLmdldEF0dHJpYnV0ZXNGb3JPcmdhbmlzbShvcmdhbmlzbSk7CiAgICAgIGZvciAoY29uc3QgYXR0cmlidXRlIG9mIGF0dHJpYnV0ZXMuZmlsdGVyKGF0dHJpYnV0ZSA9PiBhdHRyaWJ1dGUgIT09IHBvaW50ZWRBdHRyaWJ1dGUpKSB7CiAgICAgICAgY29uc3Qgbm9kZUNob2ljZXMgPSB0aGlzLmdldE5vZGVDaG9pY2VzRm9yQXR0cmlidXRlKHF1ZXJ5LCBvcmdhbmlzbSwgYXR0cmlidXRlLCByZXF1aXJlZFR5cGUpOwogICAgICAgIGZvciAoY29uc3Qgbm9kZUNob2ljZSBvZiBub2RlQ2hvaWNlcykgewogICAgICAgICAgYW5zd2VyLnB1c2gobm9kZUNob2ljZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyAtLS0gZnVuY3Rpb25zIC0tLQogICAgZm9yIChjb25zdCBtZXRhZnVuIG9mIHRoaXMucm9vdC5tZXRhZnVuU3RvcmUuZ2V0RnVucygpKSB7CiAgICAgIGNvbnN0IGlzU3Vic2VxdWVuY2UgPSBGdW5jdGlvbnMuaXNTdWJzZXF1ZW5jZShxdWVyeS50b0xvd2VyQ2FzZSgpLCBtZXRhZnVuLm5hbWUudG9Mb3dlckNhc2UoKSk7CiAgICAgIGNvbnN0IGlucHV0VHlwZXNGcm9tT3V0cHV0VHlwZSA9IG1ldGFmdW4gPT09IG51bGwgfHwgbWV0YWZ1biA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWV0YWZ1bi5pbnB1dFR5cGVzRnJvbU91dHB1dFR5cGU7CiAgICAgIGNvbnN0IG11c3RCZU51bWJlclR5cGUgPSBpbnB1dFR5cGVzRnJvbU91dHB1dFR5cGUgPT09IHVuZGVmaW5lZDsKICAgICAgY29uc3QgdmFsaWRPdXRwdXRUeXBlID0gKGlucHV0VHlwZXNGcm9tT3V0cHV0VHlwZSA9PT0gbnVsbCB8fCBpbnB1dFR5cGVzRnJvbU91dHB1dFR5cGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlucHV0VHlwZXNGcm9tT3V0cHV0VHlwZShyZXF1aXJlZFR5cGUpKSAhPT0gdW5kZWZpbmVkOwogICAgICBjb25zdCBva051bWJlclR5cGUgPSBtdXN0QmVOdW1iZXJUeXBlICYmIHJlcXVpcmVkVHlwZSA9PT0gUHJpbWl0aXZlLk51bWJlcjsKICAgICAgY29uc3QgaXNVbmRldGVybWluZWQgPSByZXF1aXJlZFR5cGUgPT09IFByaW1pdGl2ZS5VbmRldGVybWluZWQ7CiAgICAgIGNvbnN0IG9rID0gKHF1ZXJ5ID09PSAiIiB8fCBpc1N1YnNlcXVlbmNlKSAmJiAob2tOdW1iZXJUeXBlIHx8IHZhbGlkT3V0cHV0VHlwZSB8fCBpc1VuZGV0ZXJtaW5lZCk7CiAgICAgIGlmICghb2spIGNvbnRpbnVlOwogICAgICBsZXQgb3V0cHV0VHlwZSA9IHJlcXVpcmVkVHlwZTsKICAgICAgaWYgKG91dHB1dFR5cGUgPT09IFByaW1pdGl2ZS5VbmRldGVybWluZWQpIHsKICAgICAgICBpZiAobXVzdEJlTnVtYmVyVHlwZSkgewogICAgICAgICAgb3V0cHV0VHlwZSA9IFByaW1pdGl2ZS5OdW1iZXI7CiAgICAgICAgfSBlbHNlIGlmICgiZGVmYXVsdE91dHB1dFR5cGUiIGluIG1ldGFmdW4pIHsKICAgICAgICAgIG91dHB1dFR5cGUgPSBtZXRhZnVuLmRlZmF1bHRPdXRwdXRUeXBlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmFzc2VydChmYWxzZSwgbWV0YWZ1bik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGFuc3dlci5wdXNoKHsKICAgICAgICB0ZXh0OiBtZXRhZnVuLm5hbWUsCiAgICAgICAgYWRkTm9kZUZ1bmN0aW9uOiAoKSA9PiB0aGlzLm5vZGVDb2xsZWN0aW9uLmFkZEZ1bihtZXRhZnVuLCBvdXRwdXRUeXBlKQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiB3dShhbnN3ZXIpOwogIH0KICAqZ2V0Tm9kZUNob2ljZXNGb3JBdHRyaWJ1dGUocXVlcnksIG9yZ2FuaXNtLCBhdHRyaWJ1dGUsIHJlcXVpcmVkVHlwZSkgewogICAgY29uc3QgaXNTdWJzZXF1ZW5jZSA9IEZ1bmN0aW9ucy5pc1N1YnNlcXVlbmNlKHF1ZXJ5LnRvTG93ZXJDYXNlKCksIGF0dHJpYnV0ZS5uYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgaWYgKGF0dHJpYnV0ZS5kYXRhdHlwZSBpbnN0YW5jZW9mIE1ldGFzdHJ1Y3QpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhdHRyaWJ1dGUuZGF0YXR5cGUubWVtYmVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IG1lbWJlciA9IGF0dHJpYnV0ZS5kYXRhdHlwZS5tZW1iZXJzW2ldOwogICAgICAgIGNvbnNvbGUuYXNzZXJ0KG1lbWJlci50eXBlID09PSBQcmltaXRpdmUuTnVtYmVyLCBtZW1iZXIpOwogICAgICAgIGNvbnN0IHBhdGggPSBgJHtvcmdhbmlzbS5uYW1lfS4ke2F0dHJpYnV0ZS5uYW1lfS4ke21lbWJlci5uYW1lfWA7CiAgICAgICAgY29uc3QgaXNTdWJzZXF1ZW5jZSA9IEZ1bmN0aW9ucy5pc1N1YnNlcXVlbmNlKHF1ZXJ5LnRvTG93ZXJDYXNlKCksIHBhdGgudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgY29uc3Qgb2sgPSAocXVlcnkgPT09ICIiIHx8IGlzU3Vic2VxdWVuY2UpICYmIG1lbWJlci50eXBlID09PSByZXF1aXJlZFR5cGU7CiAgICAgICAgaWYgKG9rKSB7CiAgICAgICAgICB5aWVsZCB7CiAgICAgICAgICAgIHRleHQ6IHBhdGgsCiAgICAgICAgICAgIGFkZE5vZGVGdW5jdGlvbjogKCkgPT4gdGhpcy5ub2RlQ29sbGVjdGlvbi5hZGRTdHJ1Y3RNZW1iZXJSZWZlcmVuY2UoYXR0cmlidXRlLmdldFJvb3ROb2RlKCksIGkpCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3Qgb2sgPSAocXVlcnkgPT09ICIiIHx8IGlzU3Vic2VxdWVuY2UpICYmIChhdHRyaWJ1dGUuZGF0YXR5cGUgPT09IHJlcXVpcmVkVHlwZSB8fCByZXF1aXJlZFR5cGUgPT09IFByaW1pdGl2ZS5VbmRldGVybWluZWQpICYmIGF0dHJpYnV0ZS5kYXRhdHlwZSAhPT0gUHJpbWl0aXZlLlVuZGV0ZXJtaW5lZDsKICAgIGlmICghb2spIHJldHVybjsKICAgIGNvbnN0IHJvb3ROb2RlID0gdGhpcy5yb290LmF0dHJpYnV0ZUNvbGxlY3Rpb24uZ2V0Um9vdE5vZGUoYXR0cmlidXRlKTsKICAgIHlpZWxkIHsKICAgICAgdGV4dDogYCR7b3JnYW5pc20ubmFtZX0uJHthdHRyaWJ1dGUubmFtZX1gLAogICAgICBhZGROb2RlRnVuY3Rpb246ICgpID0+IHRoaXMubm9kZUNvbGxlY3Rpb24uYWRkUmVmZXJlbmNlKHJvb3ROb2RlKQogICAgfTsKICB9CiAgZ2V0SXNRdWVyeWluZygpIHsKICAgIHJldHVybiB0aGlzLmlzUXVlcnlpbmc7CiAgfQogIGdldFNlcmlhbGl6ZWQoKSB7CiAgICByZXR1cm4ge307CiAgfQogIGdldFF1ZXJ5KCkgewogICAgcmV0dXJuIHRoaXMucXVlcnk7CiAgfQogIGdldFBlblBvc2l0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucGVuUG9zaXRpb247CiAgfQogIGdldEFubm90YXRlZFRleHRGb3JBdHRyaWJ1dGUoYXR0cmlidXRlKSB7CiAgICBjb25zdCByb290Tm9kZSA9IHRoaXMucm9vdC5hdHRyaWJ1dGVDb2xsZWN0aW9uLmdldFJvb3ROb2RlKGF0dHJpYnV0ZSk7CiAgICBjb25zdCBub2RlID0gdGhpcy5yb290Lm5vZGVDb2xsZWN0aW9uLmdldENoaWxkKHJvb3ROb2RlLCAwKTsKICAgIHJldHVybiB0aGlzLmdldEFubm90YXRlZFRleHRGb3JOb2RlKG5vZGUpOwogIH0KICBnZXRUZXh0Rm9yQXR0cmlidXRlKGF0dHJpYnV0ZSkgewogICAgcmV0dXJuIHRoaXMuZ2V0QW5ub3RhdGVkVGV4dEZvckF0dHJpYnV0ZShhdHRyaWJ1dGUpLm1hcCh0ID0+IHQuY2hhcikuam9pbigiIik7CiAgfQogIGdldFNlbGVjdGlvbigpIHsKICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbjsKICB9CiAgZ2V0QW5ub3RhdGVkVGV4dEZvck5vZGUoYXN0Tm9kZSkgewogICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdDsKICAgIGlmIChhc3ROb2RlLm1ldGFuYW1lID09PSAiTnVtYmVyIikgewogICAgICByZXR1cm4gUGVuLnRleHRUb0Fubm90YXRlZFRleHQoYXN0Tm9kZS52YWx1ZS50b1N0cmluZygpLCBhc3ROb2RlKTsKICAgIH0gZWxzZSBpZiAoYXN0Tm9kZS5tZXRhbmFtZSA9PT0gIlN0cnVjdCIgJiYgYXN0Tm9kZS5kYXRhdHlwZS5pZCA9PT0gTWV0YXN0cnVjdC5idWlsdGluTWV0YXN0cnVjdHMuVmVjdG9yLmlkKSB7CiAgICAgIGNvbnNvbGUuYXNzZXJ0KHJvb3Qubm9kZUNvbGxlY3Rpb24uZ2V0Q2hpbGRyZW4oYXN0Tm9kZSkudG9BcnJheSgpLmxlbmd0aCA9PSAyLCAiQXR0cmlidXRlLnZ1ZSB2ZWN0b3IiKTsKICAgICAgY29uc29sZS5hc3NlcnQoYXN0Tm9kZSk7CiAgICAgIGNvbnN0IHhOb2RlID0gcm9vdC5ub2RlQ29sbGVjdGlvbi5nZXRDaGlsZChhc3ROb2RlLCAwKTsKICAgICAgY29uc3QgeU5vZGUgPSByb290Lm5vZGVDb2xsZWN0aW9uLmdldENoaWxkKGFzdE5vZGUsIDEpOwogICAgICBsZXQgYW5zd2VyID0gW107CiAgICAgIGFuc3dlci5wdXNoKHsKICAgICAgICBjaGFyOiAiPCIsCiAgICAgICAgbm9kZTogYXN0Tm9kZQogICAgICB9KTsKICAgICAgYW5zd2VyID0gYW5zd2VyLmNvbmNhdCh0aGlzLmdldEFubm90YXRlZFRleHRGb3JOb2RlKHhOb2RlKSk7CiAgICAgIGFuc3dlci5wdXNoKHsKICAgICAgICBjaGFyOiAiLCIsCiAgICAgICAgbm9kZTogbnVsbAogICAgICB9KTsKICAgICAgYW5zd2VyID0gYW5zd2VyLmNvbmNhdCh0aGlzLmdldEFubm90YXRlZFRleHRGb3JOb2RlKHlOb2RlKSk7CiAgICAgIGFuc3dlci5wdXNoKHsKICAgICAgICBjaGFyOiAiPiIsCiAgICAgICAgbm9kZTogbnVsbAogICAgICB9KTsKICAgICAgcmV0dXJuIGFuc3dlcjsKICAgIH0gZWxzZSBpZiAoYXN0Tm9kZS5tZXRhbmFtZSA9PT0gIlJlZmVyZW5jZSIpIHsKICAgICAgcmV0dXJuIFBlbi50ZXh0VG9Bbm5vdGF0ZWRUZXh0KFBlbi5yZWZlcmVuY2VUb1N0cmluZyhhc3ROb2RlLCByb290KSwgYXN0Tm9kZSk7CiAgICB9IGVsc2UgaWYgKGFzdE5vZGUubWV0YW5hbWUgPT09ICJGdW5jdGlvbiIpIHsKICAgICAgY29uc3QgZnVuTmFtZSA9IFBlbi5mdW5Ub1N0cmluZyhhc3ROb2RlLCByb290KTsKICAgICAgY29uc3QgY2hpbGRyZW4gPSBBcnJheS5mcm9tKHJvb3Qubm9kZUNvbGxlY3Rpb24uZ2V0Q2hpbGRyZW4oYXN0Tm9kZSkpOwogICAgICBsZXQgYW5zd2VyID0gW107CiAgICAgIGFuc3dlciA9IGFuc3dlci5jb25jYXQoUGVuLnRleHRUb0Fubm90YXRlZFRleHQoZnVuTmFtZSwgYXN0Tm9kZSkpOwogICAgICBhbnN3ZXIucHVzaCh7CiAgICAgICAgY2hhcjogIigiLAogICAgICAgIG5vZGU6IG51bGwKICAgICAgfSk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuW2ldOwogICAgICAgIGlmIChpICE9PSAwKSB7CiAgICAgICAgICBhbnN3ZXIucHVzaCh7CiAgICAgICAgICAgIGNoYXI6ICIsIiwKICAgICAgICAgICAgbm9kZTogbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGFuc3dlciA9IGFuc3dlci5jb25jYXQodGhpcy5nZXRBbm5vdGF0ZWRUZXh0Rm9yTm9kZShjaGlsZCkpOwogICAgICB9CiAgICAgIGFuc3dlci5wdXNoKHsKICAgICAgICBjaGFyOiAiKSIsCiAgICAgICAgbm9kZTogbnVsbAogICAgICB9KTsKICAgICAgcmV0dXJuIGFuc3dlcjsKICAgIH0gZWxzZSBpZiAoYXN0Tm9kZS5tZXRhbmFtZSA9PT0gIlZhcmlhYmxlIikgewogICAgICBjb25zb2xlLmVycm9yKCJBdHRyaWJ1dGUudnVlIG5vdCBleHBlY3RpbmcgVmFyaWFibGUiKTsKICAgIH0gZWxzZSBpZiAoYXN0Tm9kZS5tZXRhbmFtZSA9PT0gIlZvaWQiKSB7CiAgICAgIHJldHVybiBQZW4udGV4dFRvQW5ub3RhdGVkVGV4dCgiTm9uZSIsIGFzdE5vZGUpOwogICAgfSBlbHNlIGlmIChhc3ROb2RlLm1ldGFuYW1lID09PSAiU3RydWN0TWVtYmVyUmVmZXJlbmNlIikgewogICAgICByZXR1cm4gUGVuLnRleHRUb0Fubm90YXRlZFRleHQoUGVuLnN0cnVjdE1lbWJlclJlZmVyZW5jZVRvU3RyaW5nKGFzdE5vZGUpLCBhc3ROb2RlKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIkF0dHJpYnV0ZS52dWUgVW5rbm93biBtZXRhbmFtZSIpOwogICAgfQogIH0KICBzZXRQb2ludGVkTm9kZShub2RlKSB7CiAgICBjb25zdCBhdHRyaWJ1dGUgPSB0aGlzLnJvb3QuYXR0cmlidXRlQ29sbGVjdGlvbi5nZXRBdHRyaWJ1dGVGb3JOb2RlKG5vZGUpOwogICAgY29uc3QgYW5ub3RhdGVkVGV4dCA9IHRoaXMuZ2V0QW5ub3RhdGVkVGV4dEZvckF0dHJpYnV0ZShhdHRyaWJ1dGUpOwogICAgdGhpcy5zZWxlY3Rpb24gPSBQZW4ubWFrZVNlbGVjdGlvbkZvck5vZGUobm9kZSwgYW5ub3RhdGVkVGV4dCwgYXR0cmlidXRlLmlkKTsKICB9CiAgZ2V0UG9pbnRlZE5vZGUoKSB7CiAgICBjb25zdCBzZWxlY3Rpb24gPSB0aGlzLmdldFNlbGVjdGlvbigpOwogICAgaWYgKHNlbGVjdGlvbiA9PT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgICBjb25zdCBhdHRyaWJ1dGUgPSB0aGlzLnJvb3QuYXR0cmlidXRlQ29sbGVjdGlvbi5nZXRBdHRyaWJ1dGVGcm9tSWQoc2VsZWN0aW9uLmF0dHJpYnV0ZUlkKTsKICAgIGNvbnN0IGFubm90YXRlZFRleHQgPSB0aGlzLmdldEFubm90YXRlZFRleHRGb3JBdHRyaWJ1dGUoYXR0cmlidXRlKTsKICAgIHJldHVybiBhbm5vdGF0ZWRUZXh0W3NlbGVjdGlvbi5zdGFydEluZGV4XS5ub2RlOwogIH0KICBzdGF0aWMgcmVmZXJlbmNlVG9TdHJpbmcocmVmZXJlbmNlTm9kZSwgcm9vdCkgewogICAgY29uc3QgdGFyZ2V0Tm9kZSA9IHJvb3Qubm9kZVN0b3JlLmdldFRhcmdldE5vZGVGb3JSZWZlcmVuY2UocmVmZXJlbmNlTm9kZSk7CiAgICByZXR1cm4gcm9vdC5hdHRyaWJ1dGVTdG9yZS5nZXRBdHRyaWJ1dGVGb3JOb2RlKHRhcmdldE5vZGUpLm5hbWU7CiAgfQogIHN0YXRpYyBzdHJ1Y3RNZW1iZXJSZWZlcmVuY2VUb1N0cmluZyhub2RlKSB7CiAgICBjb25zdCB0YXJnZXROb2RlID0gTm9kZS5nZXRGcm9tSWQobm9kZS50YXJnZXRWYXJpYWJsZU5vZGVJZCk7CiAgICBjb25zdCBtZW1iZXJOYW1lID0gdGFyZ2V0Tm9kZS5kYXRhdHlwZS5tZW1iZXJzW25vZGUubWVtYmVySW5kZXhdLm5hbWU7CiAgICBjb25zdCBhdHRyaWJ1dGVOYW1lID0gQXR0cmlidXRlLmdldEF0dHJpYnV0ZUZvck5vZGUodGFyZ2V0Tm9kZSkubmFtZTsKICAgIHJldHVybiBgJHthdHRyaWJ1dGVOYW1lfS4ke21lbWJlck5hbWV9YDsKICB9CiAgc3RhdGljIGZ1blRvU3RyaW5nKGZ1bk5vZGUsIHJvb3QpIHsKICAgIGNvbnN0IG1ldGFmdW4gPSByb290Lm1ldGFmdW5TdG9yZS5nZXRGcm9tTmFtZShmdW5Ob2RlLm1ldGFmdW5OYW1lKTsKICAgIHJldHVybiBtZXRhZnVuLm5hbWU7CiAgfQogIHN0YXRpYyB0ZXh0VG9Bbm5vdGF0ZWRUZXh0KHRleHQsIGFzdE5vZGUpIHsKICAgIHJldHVybiB0ZXh0LnNwbGl0KCIiKS5tYXAodCA9PiAoewogICAgICBjaGFyOiB0LAogICAgICBub2RlOiBhc3ROb2RlCiAgICB9KSk7CiAgfQogIHN0YXRpYyBnZXRDaGFyQm91bmRzRm9yTm9kZShhc3ROb2RlLCBhbm5vdGF0ZWRUZXh0KSB7CiAgICBsZXQgc3RhcnRJbmRleCA9IG51bGw7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFubm90YXRlZFRleHQubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGFubm90YXRlZFRleHRbaV0ubm9kZSA9PT0gYXN0Tm9kZSkgewogICAgICAgIHN0YXJ0SW5kZXggPSBpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBsZXQgZW5kSW5kZXggPSBudWxsOwogICAgZm9yIChsZXQgaSA9IGFubm90YXRlZFRleHQubGVuZ3RoOyBpID4gMDsgaS0tKSB7CiAgICAgIGlmIChhbm5vdGF0ZWRUZXh0W2kgLSAxXS5ub2RlID09PSBhc3ROb2RlKSB7CiAgICAgICAgZW5kSW5kZXggPSBpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zb2xlLmFzc2VydChzdGFydEluZGV4ICE9PSBudWxsKTsKICAgIGNvbnNvbGUuYXNzZXJ0KGVuZEluZGV4ICE9PSBudWxsKTsKICAgIHJldHVybiB7CiAgICAgIHN0YXJ0SW5kZXgsCiAgICAgIGVuZEluZGV4CiAgICB9OwogIH0KICAvLyAtLS0gQUNUSU9OUyAtLS0KICBkZXNlcmlhbGl6ZShzdG9yZSkgewogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBzdG9yZSk7CiAgfQogIHNldElzUXVlcnlpbmcoaXNRdWVyeWluZykgewogICAgdGhpcy5pc1F1ZXJ5aW5nID0gaXNRdWVyeWluZzsKICAgIGlmICghaXNRdWVyeWluZykgewogICAgICB0aGlzLnNldFF1ZXJ5KCIiKTsKICAgIH0KICB9CiAgc2V0U2VsZWN0aW9uKHNlbGVjdGlvbikgewogICAgdGhpcy5zZWxlY3Rpb24gPSB0aGlzLmNhbGNTZWxlY3Rpb24oc2VsZWN0aW9uLCB0aGlzLnNlbGVjdGlvbik7CiAgfQogIGNhbGNTZWxlY3Rpb24oc2VsZWN0aW9uLCBwcmV2U2VsZWN0aW9uKSB7CiAgICBpZiAoc2VsZWN0aW9uID09PSBudWxsKSByZXR1cm4gbnVsbDsKICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHRoaXMucm9vdC5hdHRyaWJ1dGVDb2xsZWN0aW9uLmdldEF0dHJpYnV0ZUZyb21JZChzZWxlY3Rpb24uYXR0cmlidXRlSWQpOwogICAgY29uc3QgYW5ub3RhdGVkVGV4dCA9IHRoaXMuZ2V0QW5ub3RhdGVkVGV4dEZvckF0dHJpYnV0ZShhdHRyaWJ1dGUpOwogICAgY29uc29sZS5hc3NlcnQoc2VsZWN0aW9uLnN0YXJ0SW5kZXggPj0gMCk7CiAgICBjb25zb2xlLmFzc2VydChzZWxlY3Rpb24uZW5kSW5kZXggPD0gYW5ub3RhdGVkVGV4dC5sZW5ndGgpOwogICAgaWYgKFBlbi5kaWRQYXNzT3ZlclNpbmdsZUNoYXJOb2RlKHByZXZTZWxlY3Rpb24sIHNlbGVjdGlvbiwgYW5ub3RhdGVkVGV4dCkpIHsKICAgICAgbGV0IG5vZGU7CiAgICAgIGlmIChQZW4uZGlkR29MZWZ0KHByZXZTZWxlY3Rpb24sIHNlbGVjdGlvbikpIHsKICAgICAgICB2YXIgX25vZGU7CiAgICAgICAgbm9kZSA9IGFubm90YXRlZFRleHRbc2VsZWN0aW9uLnN0YXJ0SW5kZXhdLm5vZGU7CiAgICAgICAgbm9kZSA9IChfbm9kZSA9IG5vZGUpICE9PSBudWxsICYmIF9ub2RlICE9PSB2b2lkIDAgPyBfbm9kZSA6IFBlbi5nZXROb2RlVG9MZWZ0T2ZDaGFyKHNlbGVjdGlvbi5zdGFydEluZGV4LCBhbm5vdGF0ZWRUZXh0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBub2RlID0gUGVuLmdldE5vZGVUb0xlZnRPZkNoYXIoc2VsZWN0aW9uLnN0YXJ0SW5kZXgsIGFubm90YXRlZFRleHQpOwogICAgICB9CiAgICAgIHJldHVybiBQZW4ubWFrZVNlbGVjdGlvbkZvck5vZGUobm9kZSwgYW5ub3RhdGVkVGV4dCwgc2VsZWN0aW9uLmF0dHJpYnV0ZUlkKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBfYW5ub3RhdGVkVGV4dCRzZWxlY3QsIF9hbm5vdGF0ZWRUZXh0JHNlbGVjdDI7CiAgICAgIGNvbnN0IG5vZGUgPSAoX2Fubm90YXRlZFRleHQkc2VsZWN0ID0gKF9hbm5vdGF0ZWRUZXh0JHNlbGVjdDIgPSBhbm5vdGF0ZWRUZXh0W3NlbGVjdGlvbi5zdGFydEluZGV4XSkgPT09IG51bGwgfHwgX2Fubm90YXRlZFRleHQkc2VsZWN0MiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Fubm90YXRlZFRleHQkc2VsZWN0Mi5ub2RlKSAhPT0gbnVsbCAmJiBfYW5ub3RhdGVkVGV4dCRzZWxlY3QgIT09IHZvaWQgMCA/IF9hbm5vdGF0ZWRUZXh0JHNlbGVjdCA6IG51bGw7CiAgICAgIGlmIChub2RlID09PSBudWxsKSB7CiAgICAgICAgaWYgKFBlbi5kaWRHb0xlZnQocHJldlNlbGVjdGlvbiwgc2VsZWN0aW9uKSkgewogICAgICAgICAgY29uc3QgbGVmdE5vZGUgPSBQZW4uZ2V0Tm9kZVRvTGVmdE9mQ2hhcihzZWxlY3Rpb24uc3RhcnRJbmRleCwgYW5ub3RhdGVkVGV4dCk7CiAgICAgICAgICByZXR1cm4gUGVuLm1ha2VTZWxlY3Rpb25Gb3JOb2RlKGxlZnROb2RlLCBhbm5vdGF0ZWRUZXh0LCBzZWxlY3Rpb24uYXR0cmlidXRlSWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBFaXRoZXIgcmlnaHQgb3IgbmV3IHNlbGVjdGlvbgogICAgICAgICAgY29uc3QgcmlnaHROb2RlID0gUGVuLmdldE5vZGVUb1JpZ2h0T2ZDaGFyKHNlbGVjdGlvbi5zdGFydEluZGV4LCBhbm5vdGF0ZWRUZXh0KTsKICAgICAgICAgIGlmIChyaWdodE5vZGUgPT09IG51bGwpIHsKICAgICAgICAgICAgY29uc3QgbGVmdE5vZGUgPSBQZW4uZ2V0Tm9kZVRvTGVmdE9mQ2hhcihzZWxlY3Rpb24uc3RhcnRJbmRleCwgYW5ub3RhdGVkVGV4dCk7CiAgICAgICAgICAgIHJldHVybiBQZW4ubWFrZVNlbGVjdGlvbkZvck5vZGUobGVmdE5vZGUsIGFubm90YXRlZFRleHQsIHNlbGVjdGlvbi5hdHRyaWJ1dGVJZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gUGVuLm1ha2VGcm9udFNlbGVjdGlvbkZvck5vZGUocmlnaHROb2RlLCBhbm5vdGF0ZWRUZXh0LCBzZWxlY3Rpb24uYXR0cmlidXRlSWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoUGVuLmlzSW5kZXhJbnNpZGVOb2RlKHNlbGVjdGlvbi5zdGFydEluZGV4LCBub2RlLCBhbm5vdGF0ZWRUZXh0KSkgewogICAgICAgICAgcmV0dXJuIFBlbi5tYWtlU2VsZWN0aW9uRm9yTm9kZShub2RlLCBhbm5vdGF0ZWRUZXh0LCBzZWxlY3Rpb24uYXR0cmlidXRlSWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gUGVuLm1ha2VGcm9udFNlbGVjdGlvbkZvck5vZGUobm9kZSwgYW5ub3RhdGVkVGV4dCwgc2VsZWN0aW9uLmF0dHJpYnV0ZUlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIGRpZFBhc3NPdmVyU2luZ2xlQ2hhck5vZGUocHJldlNlbGVjdGlvbiwgc2VsZWN0aW9uLCBhbm5vdGF0ZWRUZXh0KSB7CiAgICBpZiAocHJldlNlbGVjdGlvbiA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgaWYgKHByZXZTZWxlY3Rpb24uYXR0cmlidXRlSWQgIT09IHNlbGVjdGlvbi5hdHRyaWJ1dGVJZCkgcmV0dXJuIGZhbHNlOwogICAgY29uc3QgZnJvbnRJbmRleCA9IE1hdGgubWluKHNlbGVjdGlvbi5zdGFydEluZGV4LCBwcmV2U2VsZWN0aW9uLnN0YXJ0SW5kZXgpOwogICAgY29uc3QgYmFja0luZGV4ID0gTWF0aC5tYXgoc2VsZWN0aW9uLnN0YXJ0SW5kZXgsIHByZXZTZWxlY3Rpb24uc3RhcnRJbmRleCk7CiAgICBjb25zdCBub2RlID0gYW5ub3RhdGVkVGV4dFtmcm9udEluZGV4XS5ub2RlOwogICAgaWYgKG5vZGUgPT09IG51bGwpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IHByZXZTaW5nbGVDaGFyID0gcHJldlNlbGVjdGlvbi5zdGFydEluZGV4ID09PSBwcmV2U2VsZWN0aW9uLmVuZEluZGV4OwogICAgY29uc3QgY3VycmVudFNpbmdsZUNoYXIgPSBzZWxlY3Rpb24uc3RhcnRJbmRleCA9PT0gc2VsZWN0aW9uLmVuZEluZGV4OwogICAgY29uc3QgY2hhckJvdW5kc0Zvck5vZGUgPSBQZW4uZ2V0Q2hhckJvdW5kc0Zvck5vZGUobm9kZSwgYW5ub3RhdGVkVGV4dCk7CiAgICBjb25zdCBvbmVDaGFyQXBhcnQgPSBjaGFyQm91bmRzRm9yTm9kZS5lbmRJbmRleCAtIGNoYXJCb3VuZHNGb3JOb2RlLnN0YXJ0SW5kZXggPT09IDE7CiAgICBjb25zdCBza2lwcGVkT3Zlck5vZGUgPSBmcm9udEluZGV4ID09PSBjaGFyQm91bmRzRm9yTm9kZS5zdGFydEluZGV4ICYmIGJhY2tJbmRleCA9PT0gY2hhckJvdW5kc0Zvck5vZGUuZW5kSW5kZXg7CiAgICByZXR1cm4gcHJldlNpbmdsZUNoYXIgJiYgY3VycmVudFNpbmdsZUNoYXIgJiYgb25lQ2hhckFwYXJ0ICYmIHNraXBwZWRPdmVyTm9kZTsKICB9CiAgc3RhdGljIGlzSW5kZXhJbnNpZGVOb2RlKGNoYXJJbmRleCwgbm9kZSwgYW5ub3RhdGVkVGV4dCkgewogICAgY29uc3QgY2hhckJvdW5kc0Zvck5vZGUgPSBQZW4uZ2V0Q2hhckJvdW5kc0Zvck5vZGUobm9kZSwgYW5ub3RhdGVkVGV4dCk7CiAgICByZXR1cm4gY2hhckluZGV4ID4gY2hhckJvdW5kc0Zvck5vZGUuc3RhcnRJbmRleCAmJiBjaGFySW5kZXggPCBjaGFyQm91bmRzRm9yTm9kZS5lbmRJbmRleDsKICB9CiAgc3RhdGljIGRpZEdvTGVmdChwcmV2U2VsZWN0aW9uLCBzZWxlY3Rpb24pIHsKICAgIGlmIChwcmV2U2VsZWN0aW9uID09PSBudWxsKSByZXR1cm4gZmFsc2U7CiAgICBpZiAocHJldlNlbGVjdGlvbi5hdHRyaWJ1dGVJZCAhPT0gc2VsZWN0aW9uLmF0dHJpYnV0ZUlkKSByZXR1cm4gZmFsc2U7CiAgICBpZiAoc2VsZWN0aW9uLnN0YXJ0SW5kZXggPCBwcmV2U2VsZWN0aW9uLnN0YXJ0SW5kZXgpIHJldHVybiB0cnVlOwogICAgaWYgKHNlbGVjdGlvbi5zdGFydEluZGV4ID4gcHJldlNlbGVjdGlvbi5zdGFydEluZGV4KSByZXR1cm4gZmFsc2U7CiAgICBpZiAoc2VsZWN0aW9uLmVuZEluZGV4IDwgcHJldlNlbGVjdGlvbi5lbmRJbmRleCkgcmV0dXJuIHRydWU7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHN0YXRpYyBnZXROb2RlVG9MZWZ0T2ZDaGFyKGluZGV4LCBhbm5vdGF0ZWRUZXh0KSB7CiAgICBsZXQgbm9kZSA9IG51bGw7CiAgICBmb3IgKGxldCBpID0gaW5kZXggLSAxOyBpID49IDA7IGktLSkgewogICAgICBub2RlID0gYW5ub3RhdGVkVGV4dFtpXS5ub2RlOwogICAgICBpZiAobm9kZSAhPT0gbnVsbCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbm9kZTsKICB9CiAgc3RhdGljIGdldE5vZGVUb1JpZ2h0T2ZDaGFyKGluZGV4LCBhbm5vdGF0ZWRUZXh0KSB7CiAgICBsZXQgbm9kZSA9IG51bGw7CiAgICBmb3IgKGxldCBpID0gaW5kZXg7IGkgPCBhbm5vdGF0ZWRUZXh0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIG5vZGUgPSBhbm5vdGF0ZWRUZXh0W2ldLm5vZGU7CiAgICAgIGlmIChub2RlICE9PSBudWxsKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBub2RlOwogIH0KICBzdGF0aWMgbWFrZVNlbGVjdGlvbkZvck5vZGUobm9kZSwgYW5ub3RhdGVkVGV4dCwgYXR0cmlidXRlSWQpIHsKICAgIHJldHVybiB7CiAgICAgIC4uLlBlbi5nZXRDaGFyQm91bmRzRm9yTm9kZShub2RlLCBhbm5vdGF0ZWRUZXh0KSwKICAgICAgYXR0cmlidXRlSWQKICAgIH07CiAgfQogIHN0YXRpYyBtYWtlRnJvbnRTZWxlY3Rpb25Gb3JOb2RlKG5vZGUsIGFubm90YXRlZFRleHQsIGF0dHJpYnV0ZUlkKSB7CiAgICBjb25zdCBjaGFyQm91bmRzRm9yTm9kZSA9IFBlbi5nZXRDaGFyQm91bmRzRm9yTm9kZShub2RlLCBhbm5vdGF0ZWRUZXh0KTsKICAgIHJldHVybiB7CiAgICAgIHN0YXJ0SW5kZXg6IGNoYXJCb3VuZHNGb3JOb2RlLnN0YXJ0SW5kZXgsCiAgICAgIGVuZEluZGV4OiBjaGFyQm91bmRzRm9yTm9kZS5zdGFydEluZGV4LAogICAgICBhdHRyaWJ1dGVJZAogICAgfTsKICB9CiAgc2V0UXVlcnkocXVlcnkpIHsKICAgIHRoaXMucXVlcnkgPSBxdWVyeTsKICB9CiAgY29tbWl0Tm9kZUNob2ljZShub2RlQ2hvaWNlKSB7CiAgICBjb25zdCBub2RlID0gbm9kZUNob2ljZS5hZGROb2RlRnVuY3Rpb24oKTsKICAgIGNvbnN0IHJlZmVyZW5jZU5vZGUgPSB0aGlzLmdldFBvaW50ZWROb2RlKCk7CiAgICBjb25zdCBhdHRyaWJ1dGUgPSB0aGlzLnJvb3QuYXR0cmlidXRlQ29sbGVjdGlvbi5nZXRBdHRyaWJ1dGVGcm9tSWQodGhpcy5nZXRTZWxlY3Rpb24oKS5hdHRyaWJ1dGVJZCk7CiAgICBjb25zdCBpc1VuZGV0ZXJtaW5lZEF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhdHlwZSA9PT0gUHJpbWl0aXZlLlVuZGV0ZXJtaW5lZDsKICAgIGlmIChpc1VuZGV0ZXJtaW5lZEF0dHJpYnV0ZSkgewogICAgICBjb25zb2xlLmFzc2VydChOb2RlLmdldENoaWxkKGF0dHJpYnV0ZS5nZXRSb290Tm9kZSgpLCAwKS5pZCA9PT0gcmVmZXJlbmNlTm9kZS5pZCk7CiAgICAgIGNvbnNvbGUuYXNzZXJ0KHJlZmVyZW5jZU5vZGUuZGF0YXR5cGUgPT09IFByaW1pdGl2ZS5VbmRldGVybWluZWQsIHJlZmVyZW5jZU5vZGUpOwogICAgfQogICAgaWYgKHRoaXMuaXNDdXJzb3JJbnNlcnRpbmcoKSAmJiAhaXNVbmRldGVybWluZWRBdHRyaWJ1dGUpIHsKICAgICAgdGhpcy5ub2RlQ29sbGVjdGlvbi5pbnNlcnROb2RlQXNQYXJlbnQocmVmZXJlbmNlTm9kZSwgbm9kZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLm5vZGVDb2xsZWN0aW9uLnJlcGxhY2VOb2RlKHJlZmVyZW5jZU5vZGUsIG5vZGUpOwogICAgfQogICAgaWYgKGlzVW5kZXRlcm1pbmVkQXR0cmlidXRlKSB7CiAgICAgIGF0dHJpYnV0ZS5kYXRhdHlwZSA9IG5vZGUuZGF0YXR5cGU7CiAgICAgIGF0dHJpYnV0ZS5nZXRSb290Tm9kZSgpLmRhdGF0eXBlID0gbm9kZS5kYXRhdHlwZTsKICAgIH0KICAgIGNvbnN0IGFubm90YXRlZFRleHQgPSB0aGlzLmdldEFubm90YXRlZFRleHRGb3JBdHRyaWJ1dGUoYXR0cmlidXRlKTsKICAgIHRoaXMuc2VsZWN0aW9uID0gUGVuLm1ha2VTZWxlY3Rpb25Gb3JOb2RlKG5vZGUsIGFubm90YXRlZFRleHQsIGF0dHJpYnV0ZS5pZCk7CiAgICB0aGlzLm1vdmVDdXJzb3JSaWdodCgpOwogICAgdGhpcy5tb3ZlQ3Vyc29yUmlnaHQoKTsKICAgIHRoaXMuZXZlbnRzLmVtaXQoImFmdGVyUGVuQ29tbWl0Iik7CiAgfQogIG1vdmVDdXJzb3JSaWdodCgpIHsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uOwogICAgY29uc3QgYW5ub3RhdGVkVGV4dCA9IHRoaXMuZ2V0QW5ub3RhdGVkVGV4dEZvckF0dHJpYnV0ZSh0aGlzLmdldFNlbGVjdGVkQXR0cmlidXRlKCkpOwogICAgY29uc3QgaW5kZXggPSBNYXRoLm1pbihzZWxlY3Rpb24uZW5kSW5kZXgsIGFubm90YXRlZFRleHQubGVuZ3RoKTsKICAgIHRoaXMuc2V0U2VsZWN0aW9uKHsKICAgICAgLi4uc2VsZWN0aW9uLAogICAgICBzdGFydEluZGV4OiBpbmRleCwKICAgICAgZW5kSW5kZXg6IGluZGV4CiAgICB9KTsKICB9CiAgdHJ5UHJvbW90ZVNlbGVjdGlvblRvUm9vdCgpIHsKICAgIGNvbnNvbGUuYXNzZXJ0KCF0aGlzLmdldElzUXVlcnlpbmcoKSk7CiAgICBjb25zdCBub2RlID0gdGhpcy5nZXRQb2ludGVkTm9kZSgpOwogICAgY29uc29sZS5hc3NlcnQobm9kZSAhPSBudWxsKTsKICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHRoaXMuZ2V0U2VsZWN0ZWRBdHRyaWJ1dGUoKTsKICAgIGNvbnN0IHJvb3ROb2RlID0gdGhpcy5yb290LmF0dHJpYnV0ZUNvbGxlY3Rpb24uZ2V0Um9vdE5vZGUoYXR0cmlidXRlKTsKICAgIGlmIChub2RlLmRhdGF0eXBlID09PSByb290Tm9kZS5kYXRhdHlwZSkgewogICAgICB0aGlzLm5vZGVDb2xsZWN0aW9uLnJlcGFyZW50KHsKICAgICAgICBjaGlsZDogbm9kZSwKICAgICAgICBuZXdQYXJlbnQ6IHJvb3ROb2RlLAogICAgICAgIGNoaWxkSW5kZXg6IDAKICAgICAgfSk7CiAgICAgIGNvbnN0IGFubm90YXRlZFRleHQgPSB0aGlzLmdldEFubm90YXRlZFRleHRGb3JBdHRyaWJ1dGUoYXR0cmlidXRlKTsKICAgICAgdGhpcy5zZWxlY3Rpb24gPSBQZW4ubWFrZVNlbGVjdGlvbkZvck5vZGUobm9kZSwgYW5ub3RhdGVkVGV4dCwgYXR0cmlidXRlLmlkKTsKICAgICAgdGhpcy5ldmVudHMuZW1pdCgiYWZ0ZXJQZW5Db21taXQiKTsKICAgIH0KICB9CiAgaXNDdXJzb3JJbnNlcnRpbmcoKSB7CiAgICBjb25zdCBzZWxlY3Rpb24gPSB0aGlzLmdldFNlbGVjdGlvbigpOwogICAgY29uc29sZS5hc3NlcnQoc2VsZWN0aW9uICE9PSBudWxsKTsKICAgIGNvbnN0IGlzWmVyb0xlbmd0aFNlbGVjdGlvbiA9IHNlbGVjdGlvbi5zdGFydEluZGV4ID09PSBzZWxlY3Rpb24uZW5kSW5kZXg7CiAgICByZXR1cm4gaXNaZXJvTGVuZ3RoU2VsZWN0aW9uOwogIH0KICBnZXRTZWxlY3RlZEF0dHJpYnV0ZSgpIHsKICAgIGNvbnNvbGUuYXNzZXJ0KHRoaXMuZ2V0U2VsZWN0aW9uKCkgIT09IG51bGwpOwogICAgcmV0dXJuIHRoaXMucm9vdC5hdHRyaWJ1dGVDb2xsZWN0aW9uLmdldEF0dHJpYnV0ZUZyb21JZCh0aGlzLmdldFNlbGVjdGlvbigpLmF0dHJpYnV0ZUlkKTsKICB9CiAgY29tbWl0Rmlyc3ROb2RlQ2hvaWNlKCkgewogICAgdGhpcy5jb21taXROb2RlQ2hvaWNlKHRoaXMuZ2V0Tm9kZUNob2ljZXMoKS5uZXh0KCkudmFsdWUpOwogIH0KfQ=="},{"version":3,"names":["wu","Functions","EventEmitter","Primitive","Attribute","Metastruct","Node","PenPositionRelation","Pen","constructor","root","penPosition","positionType","query","isQuerying","selection","events","setMaxListeners","nodeCollection","nodeStore","getNodeChoices","answer","requiredType","getPointedNode","datatype","number","Number","parseFloat","isNaN","Undetermined","push","text","toString","addNodeFunction","addNumber","console","log","assert","pointedAttribute","attributeCollection","getAttributeForNode","pointedOrganism","getOrganismForAttribute","ancestors","organismCollection","getAncestors","organism","chain","attributes","getAttributesForOrganism","attribute","filter","nodeChoices","getNodeChoicesForAttribute","nodeChoice","metafun","metafunStore","getFuns","isSubsequence","toLowerCase","name","inputTypesFromOutputType","mustBeNumberType","undefined","validOutputType","okNumberType","isUndetermined","ok","outputType","defaultOutputType","addFun","i","members","length","member","type","path","addStructMemberReference","getRootNode","rootNode","addReference","getIsQuerying","getSerialized","getQuery","getPenPosition","getAnnotatedTextForAttribute","node","getChild","getAnnotatedTextForNode","getTextForAttribute","map","t","char","join","getSelection","astNode","metaname","textToAnnotatedText","value","id","builtinMetastructs","Vector","getChildren","toArray","xNode","yNode","concat","referenceToString","funName","funToString","children","Array","from","child","error","structMemberReferenceToString","setPointedNode","annotatedText","makeSelectionForNode","getAttributeFromId","attributeId","startIndex","referenceNode","targetNode","getTargetNodeForReference","attributeStore","getFromId","targetVariableNodeId","memberName","memberIndex","attributeName","funNode","getFromName","metafunName","split","getCharBoundsForNode","endIndex","deserialize","store","Object","assign","setIsQuerying","setQuery","setSelection","calcSelection","prevSelection","didPassOverSingleCharNode","didGoLeft","_node","getNodeToLeftOfChar","_annotatedText$select","_annotatedText$select2","leftNode","rightNode","getNodeToRightOfChar","makeFrontSelectionForNode","isIndexInsideNode","frontIndex","Math","min","backIndex","max","prevSingleChar","currentSingleChar","charBoundsForNode","oneCharApart","skippedOverNode","charIndex","index","commitNodeChoice","isUndeterminedAttribute","isCursorInserting","insertNodeAsParent","replaceNode","moveCursorRight","emit","getSelectedAttribute","tryPromoteSelectionToRoot","reparent","newParent","childIndex","isZeroLengthSelection","commitFirstNodeChoice","next"],"sources":["/Users/dylan.phan/stuff/expr-explorations/expresso/js/node_modules/eslint-loader/index.js??ref--13-0!/Users/dylan.phan/stuff/expr-explorations/expresso/js/src/store/Pen.ts"],"sourcesContent":["import wu from \"wu\";\nimport { Root } from \"./Root\";\nimport Functions from \"../code/Functions\";\nimport { EventEmitter } from \"events\";\nimport Type, { Primitive } from \"@/models/Type\";\nimport Attribute from \"@/models/Attribute\";\nimport Metastruct from \"@/models/Metastruct\";\nimport Node from \"@/models/Node\";\n\ninterface NonePenPosition {\n  positionType: \"None\";\n}\n\ninterface NodePenPosition {\n  positionType: \"Node\";\n  referenceNodeId: string;\n  relation: PenPositionRelation;\n}\n\ntype PenPosition = NonePenPosition | NodePenPosition;\n\nexport enum PenPositionRelation {\n  On = \"On\",\n  After = \"After\",\n  Before = \"Before\"\n}\n\nexport interface Selection {\n  attributeId: string;\n\n  // Character index\n  startIndex: number;\n\n  // Character index\n  endIndex: number;\n}\n\ninterface AnnotatedText {\n  char: string[1];\n  node: any;\n}\n\ninterface Bounds {\n  startIndex: number;\n  endIndex: number;\n}\n\nexport default class Pen {\n  penPosition = { positionType: \"None\" } as PenPosition;\n  query = \"\";\n  isQuerying = false;\n  selection = null as Selection | null;\n  events = new EventEmitter();\n\n  constructor(private root: Root) {\n    this.events.setMaxListeners(1000);\n  }\n\n  get nodeCollection() {\n    return this.root.nodeStore;\n  }\n\n  // --- GETS ---\n\n  getNodeChoices() {\n    if (!this.isQuerying) return wu([]);\n\n    const answer = [] as any;\n    const query = this.query;\n\n    const requiredType = this.getPointedNode().datatype;\n\n    // --- number ---\n\n    const number = Number.parseFloat(this.query);\n    if (!Number.isNaN(number)) {\n      if (\n        requiredType === Primitive.Number ||\n        requiredType === Primitive.Undetermined\n      ) {\n        answer.push({\n          text: number.toString(),\n          addNodeFunction: () => this.nodeCollection.addNumber(number)\n        });\n      } else if (requiredType instanceof Metastruct) {\n        console.log(\"dunno what to do with structs\");\n      } else {\n        console.assert(false, requiredType);\n      }\n      return wu(answer);\n    }\n\n    // --- attributes ---\n\n    const pointedAttribute = this.root.attributeCollection.getAttributeForNode(\n      this.getPointedNode()\n    );\n    const pointedOrganism = this.root.attributeCollection.getOrganismForAttribute(\n      pointedAttribute\n    );\n\n    const ancestors = this.root.organismCollection.getAncestors(\n      pointedOrganism\n    );\n    for (const organism of wu.chain([pointedOrganism], ancestors)) {\n      const attributes = this.root.attributeCollection.getAttributesForOrganism(\n        organism\n      );\n      for (const attribute of attributes.filter(\n        attribute => attribute !== pointedAttribute\n      )) {\n        const nodeChoices = this.getNodeChoicesForAttribute(\n          query,\n          organism,\n          attribute,\n          requiredType\n        );\n        for (const nodeChoice of nodeChoices) {\n          answer.push(nodeChoice);\n        }\n      }\n    }\n\n    // --- functions ---\n\n    for (const metafun of this.root.metafunStore.getFuns()) {\n      const isSubsequence = Functions.isSubsequence(\n        query.toLowerCase(),\n        metafun.name.toLowerCase()\n      );\n      const inputTypesFromOutputType = (metafun as any)\n        ?.inputTypesFromOutputType;\n      const mustBeNumberType = inputTypesFromOutputType === undefined;\n      const validOutputType =\n        inputTypesFromOutputType?.(requiredType) !== undefined;\n      const okNumberType =\n        mustBeNumberType && requiredType === Primitive.Number;\n      const isUndetermined = requiredType === Primitive.Undetermined;\n      const ok =\n        (query === \"\" || isSubsequence) &&\n        (okNumberType || validOutputType || isUndetermined);\n      if (!ok) continue;\n\n      let outputType = requiredType;\n      if (outputType === Primitive.Undetermined) {\n        if (mustBeNumberType) {\n          outputType = Primitive.Number;\n        } else if (\"defaultOutputType\" in metafun) {\n          outputType = metafun.defaultOutputType;\n        } else {\n          console.assert(false, metafun);\n        }\n      }\n      answer.push({\n        text: metafun.name,\n        addNodeFunction: () => this.nodeCollection.addFun(metafun, outputType)\n      });\n    }\n\n    return wu(answer);\n  }\n\n  private *getNodeChoicesForAttribute(\n    query: string,\n    organism,\n    attribute: Attribute,\n    requiredType\n  ) {\n    const isSubsequence = Functions.isSubsequence(\n      query.toLowerCase(),\n      attribute.name.toLowerCase()\n    );\n\n    if (attribute.datatype instanceof Metastruct) {\n      for (let i = 0; i < attribute.datatype.members.length; i++) {\n        const member = attribute.datatype.members[i];\n        console.assert(member.type === Primitive.Number, member);\n\n        const path = `${organism.name}.${attribute.name}.${member.name}`;\n        const isSubsequence = Functions.isSubsequence(\n          query.toLowerCase(),\n          path.toLowerCase()\n        );\n        const ok =\n          (query === \"\" || isSubsequence) && member.type === requiredType;\n        if (ok) {\n          yield {\n            text: path,\n            addNodeFunction: () => this.nodeCollection.addStructMemberReference(attribute.getRootNode(), i)\n          };\n        }\n      }\n    }\n\n    const ok =\n      (query === \"\" || isSubsequence) &&\n      (attribute.datatype === requiredType ||\n        requiredType === Primitive.Undetermined) &&\n      attribute.datatype !== Primitive.Undetermined;\n    if (!ok) return;\n\n    const rootNode = this.root.attributeCollection.getRootNode(attribute);\n    yield {\n      text: `${organism.name}.${attribute.name}`,\n      addNodeFunction: () => this.nodeCollection.addReference(rootNode)\n    };\n  }\n\n  getIsQuerying() {\n    return this.isQuerying;\n  }\n\n  getSerialized() {\n    return {};\n  }\n\n  getQuery() {\n    return this.query;\n  }\n\n  getPenPosition() {\n    return this.penPosition;\n  }\n\n  public getAnnotatedTextForAttribute(attribute: any) {\n    const rootNode = this.root.attributeCollection.getRootNode(attribute);\n    const node = this.root.nodeCollection.getChild(rootNode, 0);\n    return this.getAnnotatedTextForNode(node);\n  }\n\n  getTextForAttribute(attribute: any) {\n    return this.getAnnotatedTextForAttribute(attribute)\n      .map(t => t.char)\n      .join(\"\");\n  }\n\n  getSelection() {\n    return this.selection;\n  }\n\n  private getAnnotatedTextForNode(astNode) {\n    const root = this.root;\n    if (astNode.metaname === \"Number\") {\n      return Pen.textToAnnotatedText(astNode.value.toString(), astNode);\n    } else if (\n      astNode.metaname === \"Struct\" &&\n      astNode.datatype.id === Metastruct.builtinMetastructs.Vector.id\n    ) {\n      console.assert(\n        root.nodeCollection.getChildren(astNode).toArray().length == 2,\n        \"Attribute.vue vector\"\n      );\n      console.assert(astNode);\n      const xNode = root.nodeCollection.getChild(astNode, 0);\n      const yNode = root.nodeCollection.getChild(astNode, 1);\n      let answer = [] as any;\n      answer.push({ char: \"<\", node: astNode });\n      answer = answer.concat(this.getAnnotatedTextForNode(xNode));\n      answer.push({ char: \",\", node: null });\n      answer = answer.concat(this.getAnnotatedTextForNode(yNode));\n      answer.push({ char: \">\", node: null });\n      return answer;\n    } else if (astNode.metaname === \"Reference\") {\n      return Pen.textToAnnotatedText(\n        Pen.referenceToString(astNode, root),\n        astNode\n      );\n    } else if (astNode.metaname === \"Function\") {\n      const funName = Pen.funToString(astNode, root);\n      const children = Array.from(root.nodeCollection.getChildren(astNode));\n      let answer = [] as any;\n      answer = answer.concat(Pen.textToAnnotatedText(funName, astNode));\n      answer.push({ char: \"(\", node: null });\n      for (let i = 0; i < children.length; i++) {\n        const child = children[i];\n        if (i !== 0) {\n          answer.push({ char: \",\", node: null });\n        }\n        answer = answer.concat(this.getAnnotatedTextForNode(child));\n      }\n      answer.push({ char: \")\", node: null });\n      return answer;\n    } else if (astNode.metaname === \"Variable\") {\n      console.error(\"Attribute.vue not expecting Variable\");\n    } else if (astNode.metaname === \"Void\") {\n      return Pen.textToAnnotatedText(\"None\", astNode);\n    } else if(astNode.metaname===\"StructMemberReference\"){\n      return Pen.textToAnnotatedText(Pen.structMemberReferenceToString(astNode), astNode);\n    } else {\n      console.error(\"Attribute.vue Unknown metaname\");\n    }\n  }\n\n  public setPointedNode(node) {\n    const attribute = this.root.attributeCollection.getAttributeForNode(node);\n    const annotatedText = this.getAnnotatedTextForAttribute(attribute);\n    this.selection = Pen.makeSelectionForNode(\n      node,\n      annotatedText,\n      attribute!.id\n    );\n  }\n\n  public getPointedNode() {\n    const selection = this.getSelection();\n    if (selection === null) return null;\n\n    const attribute = this.root.attributeCollection.getAttributeFromId(\n      selection.attributeId\n    );\n    const annotatedText = this.getAnnotatedTextForAttribute(attribute);\n    return annotatedText[selection.startIndex].node;\n  }\n\n  private static referenceToString(referenceNode, root) {\n    const targetNode = root.nodeStore.getTargetNodeForReference(referenceNode);\n    return root.attributeStore.getAttributeForNode(targetNode).name;\n  }\n\n  private static structMemberReferenceToString(node) {\n    const targetNode = Node.getFromId(node.targetVariableNodeId);\n    const memberName = targetNode.datatype.members[node.memberIndex].name;\n    const attributeName = Attribute.getAttributeForNode(targetNode).name;\n    return`${attributeName}.${memberName}`;\n  }\n\n  private static funToString(funNode, root) {\n    const metafun = root.metafunStore.getFromName(funNode.metafunName);\n    return metafun.name;\n  }\n\n  private static textToAnnotatedText(text, astNode) {\n    return text.split(\"\").map(t => ({\n      char: t,\n      node: astNode\n    }));\n  }\n\n  private static getCharBoundsForNode(astNode, annotatedText) {\n    let startIndex = null as null | number;\n    for (let i = 0; i < annotatedText.length; i++) {\n      if (annotatedText[i].node === astNode) {\n        startIndex = i;\n        break;\n      }\n    }\n\n    let endIndex = null as null | number;\n    for (let i = annotatedText.length; i > 0; i--) {\n      if (annotatedText[i - 1].node === astNode) {\n        endIndex = i;\n        break;\n      }\n    }\n    console.assert(startIndex !== null);\n    console.assert(endIndex !== null);\n    return { startIndex, endIndex } as Bounds;\n  }\n\n  // --- ACTIONS ---\n\n  deserialize(store) {\n    Object.assign(this, store);\n  }\n\n  setIsQuerying(isQuerying) {\n    this.isQuerying = isQuerying;\n    if (!isQuerying) {\n      this.setQuery(\"\");\n    }\n  }\n\n  setSelection(selection: Selection | null) {\n    this.selection = this.calcSelection(selection, this.selection);\n  }\n\n  private calcSelection(\n    selection: Selection | null,\n    prevSelection: Selection | null\n  ): Selection | null {\n    if (selection === null) return null;\n\n    const attribute = this.root.attributeCollection.getAttributeFromId(\n      selection.attributeId\n    );\n    const annotatedText = this.getAnnotatedTextForAttribute(attribute);\n    console.assert(selection.startIndex >= 0);\n    console.assert(selection.endIndex <= annotatedText.length);\n\n    if (\n      Pen.didPassOverSingleCharNode(prevSelection, selection, annotatedText)\n    ) {\n      let node;\n      if (Pen.didGoLeft(prevSelection, selection)) {\n        node = annotatedText[selection.startIndex].node;\n        node =\n          node ?? Pen.getNodeToLeftOfChar(selection.startIndex, annotatedText);\n      } else {\n        node = Pen.getNodeToLeftOfChar(selection.startIndex, annotatedText);\n      }\n      return Pen.makeSelectionForNode(\n        node,\n        annotatedText,\n        selection.attributeId\n      );\n    } else {\n      const node = annotatedText[selection.startIndex]?.node ?? null;\n      if (node === null) {\n        if (Pen.didGoLeft(prevSelection, selection)) {\n          const leftNode = Pen.getNodeToLeftOfChar(\n            selection.startIndex,\n            annotatedText\n          );\n          return Pen.makeSelectionForNode(\n            leftNode,\n            annotatedText,\n            selection.attributeId\n          );\n        } else {\n          // Either right or new selection\n          const rightNode = Pen.getNodeToRightOfChar(\n            selection.startIndex,\n            annotatedText\n          );\n          if (rightNode === null) {\n            const leftNode = Pen.getNodeToLeftOfChar(\n              selection.startIndex,\n              annotatedText\n            );\n            return Pen.makeSelectionForNode(\n              leftNode,\n              annotatedText,\n              selection.attributeId\n            );\n          } else {\n            return Pen.makeFrontSelectionForNode(\n              rightNode,\n              annotatedText,\n              selection.attributeId\n            );\n          }\n        }\n      } else {\n        if (Pen.isIndexInsideNode(selection.startIndex, node, annotatedText)) {\n          return Pen.makeSelectionForNode(\n            node,\n            annotatedText,\n            selection.attributeId\n          );\n        } else {\n          return Pen.makeFrontSelectionForNode(\n            node,\n            annotatedText,\n            selection.attributeId\n          );\n        }\n      }\n    }\n  }\n\n  private static didPassOverSingleCharNode(\n    prevSelection: Selection | null,\n    selection: Selection,\n    annotatedText: AnnotatedText[]\n  ) {\n    if (prevSelection === null) return false;\n    if (prevSelection.attributeId !== selection.attributeId) return false;\n\n    const frontIndex = Math.min(selection.startIndex, prevSelection.startIndex);\n    const backIndex = Math.max(selection.startIndex, prevSelection.startIndex);\n    const node = annotatedText[frontIndex].node;\n    if (node === null) return false;\n\n    const prevSingleChar = prevSelection.startIndex === prevSelection.endIndex;\n    const currentSingleChar = selection.startIndex === selection.endIndex;\n\n    const charBoundsForNode = Pen.getCharBoundsForNode(node, annotatedText);\n    const oneCharApart =\n      charBoundsForNode.endIndex - charBoundsForNode.startIndex === 1;\n    const skippedOverNode =\n      frontIndex === charBoundsForNode.startIndex &&\n      backIndex === charBoundsForNode.endIndex;\n\n    return (\n      prevSingleChar && currentSingleChar && oneCharApart && skippedOverNode\n    );\n  }\n\n  private static isIndexInsideNode(charIndex, node, annotatedText) {\n    const charBoundsForNode = Pen.getCharBoundsForNode(node, annotatedText);\n    return (\n      charIndex > charBoundsForNode.startIndex &&\n      charIndex < charBoundsForNode.endIndex\n    );\n  }\n\n  private static didGoLeft(prevSelection, selection) {\n    if (prevSelection === null) return false;\n    if (prevSelection.attributeId !== selection.attributeId) return false;\n    if (selection.startIndex < prevSelection.startIndex) return true;\n    if (selection.startIndex > prevSelection.startIndex) return false;\n    if (selection.endIndex < prevSelection.endIndex) return true;\n    return false;\n  }\n\n  private static getNodeToLeftOfChar(index, annotatedText: AnnotatedText[]) {\n    let node = null;\n    for (let i = index - 1; i >= 0; i--) {\n      node = annotatedText[i].node;\n      if (node !== null) {\n        break;\n      }\n    }\n    return node;\n  }\n\n  private static getNodeToRightOfChar(index, annotatedText: AnnotatedText[]) {\n    let node = null;\n    for (let i = index; i < annotatedText.length; i++) {\n      node = annotatedText[i].node;\n      if (node !== null) {\n        break;\n      }\n    }\n    return node;\n  }\n\n  private static makeSelectionForNode(node, annotatedText, attributeId) {\n    return { ...Pen.getCharBoundsForNode(node, annotatedText), attributeId };\n  }\n\n  private static makeFrontSelectionForNode(node, annotatedText, attributeId) {\n    const charBoundsForNode = Pen.getCharBoundsForNode(node, annotatedText);\n    return {\n      startIndex: charBoundsForNode.startIndex,\n      endIndex: charBoundsForNode.startIndex,\n      attributeId\n    };\n  }\n\n  setQuery(query) {\n    this.query = query;\n  }\n\n  commitNodeChoice(nodeChoice) {\n    const node = nodeChoice.addNodeFunction();\n    const referenceNode = this.getPointedNode();\n    const attribute = this.root.attributeCollection.getAttributeFromId(\n      this.getSelection()!.attributeId\n    ) as Attribute;\n\n    const isUndeterminedAttribute = attribute.datatype === Primitive.Undetermined;\n    if (isUndeterminedAttribute) {\n      console.assert(Node.getChild(attribute.getRootNode(),0).id === referenceNode.id);\n      console.assert(referenceNode.datatype === Primitive.Undetermined, referenceNode);\n    }\n\n    if (this.isCursorInserting() && !isUndeterminedAttribute) {\n      this.nodeCollection.insertNodeAsParent(referenceNode, node);\n    } else {\n      this.nodeCollection.replaceNode(referenceNode, node);\n    }\n\n    if (isUndeterminedAttribute) {\n      attribute.datatype = node.datatype;\n      attribute.getRootNode().datatype = node.datatype;\n    }\n\n    const annotatedText = this.getAnnotatedTextForAttribute(attribute);\n    this.selection = Pen.makeSelectionForNode(\n      node,\n      annotatedText,\n      attribute!.id\n    );\n    this.moveCursorRight();\n    this.moveCursorRight();\n\n    this.events.emit(\"afterPenCommit\");\n  }\n\n  private moveCursorRight() {\n    const selection = this.selection as Selection;\n    const annotatedText = this.getAnnotatedTextForAttribute(\n      this.getSelectedAttribute()\n    );\n    const index = Math.min(selection.endIndex, annotatedText.length);\n    this.setSelection({\n      ...selection,\n      startIndex: index,\n      endIndex: index\n    });\n  }\n\n  tryPromoteSelectionToRoot() {\n    console.assert(!this.getIsQuerying());\n    const node = this.getPointedNode();\n    console.assert(node != null);\n\n    const attribute = this.getSelectedAttribute();\n    const rootNode = this.root.attributeCollection.getRootNode(attribute);\n    if (node.datatype === rootNode.datatype) {\n      this.nodeCollection.reparent({\n        child: node,\n        newParent: rootNode,\n        childIndex: 0\n      });\n      const annotatedText = this.getAnnotatedTextForAttribute(attribute);\n      this.selection = Pen.makeSelectionForNode(\n        node,\n        annotatedText,\n        attribute!.id\n      );\n      this.events.emit(\"afterPenCommit\");\n    }\n  }\n\n  public isCursorInserting(): boolean {\n    const selection = this.getSelection() as Selection;\n    console.assert(selection !== null);\n    const isZeroLengthSelection = selection.startIndex === selection.endIndex;\n    return isZeroLengthSelection;\n  }\n\n  public getSelectedAttribute() {\n    console.assert(this.getSelection() !== null);\n    return this.root.attributeCollection.getAttributeFromId(\n      this.getSelection()!.attributeId\n    );\n  }\n\n  commitFirstNodeChoice() {\n    this.commitNodeChoice(this.getNodeChoices().next().value);\n  }\n}\n"],"mappings":";AAAA,OAAOA,EAAE,MAAM,IAAI;AAEnB,OAAOC,SAAS,MAAM,mBAAmB;AACzC,SAASC,YAAY,QAAQ,QAAQ;AACrC,SAAeC,SAAS,QAAQ,eAAe;AAC/C,OAAOC,SAAS,MAAM,oBAAoB;AAC1C,OAAOC,UAAU,MAAM,qBAAqB;AAC5C,OAAOC,IAAI,MAAM,eAAe;AAchC,WAAYC,mBAIX;AAJD,WAAYA,mBAAmB;EAC7BA,mBAAA,aAAS;EACTA,mBAAA,mBAAe;EACfA,mBAAA,qBAAiB;AACnB,CAAC,EAJWA,mBAAmB,KAAnBA,mBAAmB;AA0B/B,eAAc,MAAOC,GAAG;EAOtBC,YAAoBC,IAAU;IAAV,KAAAA,IAAI,GAAJA,IAAI;IANxB,KAAAC,WAAW,GAAG;MAAEC,YAAY,EAAE;IAAM,CAAiB;IACrD,KAAAC,KAAK,GAAG,EAAE;IACV,KAAAC,UAAU,GAAG,KAAK;IAClB,KAAAC,SAAS,GAAG,IAAwB;IACpC,KAAAC,MAAM,GAAG,IAAId,YAAY,EAAE;IAGzB,IAAI,CAACc,MAAM,CAACC,eAAe,CAAC,IAAI,CAAC;EACnC;EAEA,IAAIC,cAAcA,CAAA;IAChB,OAAO,IAAI,CAACR,IAAI,CAACS,SAAS;EAC5B;EAEA;EAEAC,cAAcA,CAAA;IACZ,IAAI,CAAC,IAAI,CAACN,UAAU,EAAE,OAAOd,EAAE,CAAC,EAAE,CAAC;IAEnC,MAAMqB,MAAM,GAAG,EAAS;IACxB,MAAMR,KAAK,GAAG,IAAI,CAACA,KAAK;IAExB,MAAMS,YAAY,GAAG,IAAI,CAACC,cAAc,EAAE,CAACC,QAAQ;IAEnD;IAEA,MAAMC,MAAM,GAAGC,MAAM,CAACC,UAAU,CAAC,IAAI,CAACd,KAAK,CAAC;IAC5C,IAAI,CAACa,MAAM,CAACE,KAAK,CAACH,MAAM,CAAC,EAAE;MACzB,IACEH,YAAY,KAAKnB,SAAS,CAACuB,MAAM,IACjCJ,YAAY,KAAKnB,SAAS,CAAC0B,YAAY,EACvC;QACAR,MAAM,CAACS,IAAI,CAAC;UACVC,IAAI,EAAEN,MAAM,CAACO,QAAQ,EAAE;UACvBC,eAAe,EAAEA,CAAA,KAAM,IAAI,CAACf,cAAc,CAACgB,SAAS,CAACT,MAAM;SAC5D,CAAC;OACH,MAAM,IAAIH,YAAY,YAAYjB,UAAU,EAAE;QAC7C8B,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC;OAC7C,MAAM;QACLD,OAAO,CAACE,MAAM,CAAC,KAAK,EAAEf,YAAY,CAAC;;MAErC,OAAOtB,EAAE,CAACqB,MAAM,CAAC;;IAGnB;IAEA,MAAMiB,gBAAgB,GAAG,IAAI,CAAC5B,IAAI,CAAC6B,mBAAmB,CAACC,mBAAmB,CACxE,IAAI,CAACjB,cAAc,EAAE,CACtB;IACD,MAAMkB,eAAe,GAAG,IAAI,CAAC/B,IAAI,CAAC6B,mBAAmB,CAACG,uBAAuB,CAC3EJ,gBAAgB,CACjB;IAED,MAAMK,SAAS,GAAG,IAAI,CAACjC,IAAI,CAACkC,kBAAkB,CAACC,YAAY,CACzDJ,eAAe,CAChB;IACD,KAAK,MAAMK,QAAQ,IAAI9C,EAAE,CAAC+C,KAAK,CAAC,CAACN,eAAe,CAAC,EAAEE,SAAS,CAAC,EAAE;MAC7D,MAAMK,UAAU,GAAG,IAAI,CAACtC,IAAI,CAAC6B,mBAAmB,CAACU,wBAAwB,CACvEH,QAAQ,CACT;MACD,KAAK,MAAMI,SAAS,IAAIF,UAAU,CAACG,MAAM,CACvCD,SAAS,IAAIA,SAAS,KAAKZ,gBAAgB,CAC5C,EAAE;QACD,MAAMc,WAAW,GAAG,IAAI,CAACC,0BAA0B,CACjDxC,KAAK,EACLiC,QAAQ,EACRI,SAAS,EACT5B,YAAY,CACb;QACD,KAAK,MAAMgC,UAAU,IAAIF,WAAW,EAAE;UACpC/B,MAAM,CAACS,IAAI,CAACwB,UAAU,CAAC;;;;IAK7B;IAEA,KAAK,MAAMC,OAAO,IAAI,IAAI,CAAC7C,IAAI,CAAC8C,YAAY,CAACC,OAAO,EAAE,EAAE;MACtD,MAAMC,aAAa,GAAGzD,SAAS,CAACyD,aAAa,CAC3C7C,KAAK,CAAC8C,WAAW,EAAE,EACnBJ,OAAO,CAACK,IAAI,CAACD,WAAW,EAAE,CAC3B;MACD,MAAME,wBAAwB,GAAIN,OAAe,aAAfA,OAAe,uBAAfA,OAAe,CAC7CM,wBAAwB;MAC5B,MAAMC,gBAAgB,GAAGD,wBAAwB,KAAKE,SAAS;MAC/D,MAAMC,eAAe,GACnB,CAAAH,wBAAwB,aAAxBA,wBAAwB,uBAAxBA,wBAAwB,CAAGvC,YAAY,CAAC,MAAKyC,SAAS;MACxD,MAAME,YAAY,GAChBH,gBAAgB,IAAIxC,YAAY,KAAKnB,SAAS,CAACuB,MAAM;MACvD,MAAMwC,cAAc,GAAG5C,YAAY,KAAKnB,SAAS,CAAC0B,YAAY;MAC9D,MAAMsC,EAAE,GACN,CAACtD,KAAK,KAAK,EAAE,IAAI6C,aAAa,MAC7BO,YAAY,IAAID,eAAe,IAAIE,cAAc,CAAC;MACrD,IAAI,CAACC,EAAE,EAAE;MAET,IAAIC,UAAU,GAAG9C,YAAY;MAC7B,IAAI8C,UAAU,KAAKjE,SAAS,CAAC0B,YAAY,EAAE;QACzC,IAAIiC,gBAAgB,EAAE;UACpBM,UAAU,GAAGjE,SAAS,CAACuB,MAAM;SAC9B,MAAM,IAAI,mBAAmB,IAAI6B,OAAO,EAAE;UACzCa,UAAU,GAAGb,OAAO,CAACc,iBAAiB;SACvC,MAAM;UACLlC,OAAO,CAACE,MAAM,CAAC,KAAK,EAAEkB,OAAO,CAAC;;;MAGlClC,MAAM,CAACS,IAAI,CAAC;QACVC,IAAI,EAAEwB,OAAO,CAACK,IAAI;QAClB3B,eAAe,EAAEA,CAAA,KAAM,IAAI,CAACf,cAAc,CAACoD,MAAM,CAACf,OAAO,EAAEa,UAAU;OACtE,CAAC;;IAGJ,OAAOpE,EAAE,CAACqB,MAAM,CAAC;EACnB;EAEQ,CAACgC,0BAA0BA,CACjCxC,KAAa,EACbiC,QAAQ,EACRI,SAAoB,EACpB5B,YAAY;IAEZ,MAAMoC,aAAa,GAAGzD,SAAS,CAACyD,aAAa,CAC3C7C,KAAK,CAAC8C,WAAW,EAAE,EACnBT,SAAS,CAACU,IAAI,CAACD,WAAW,EAAE,CAC7B;IAED,IAAIT,SAAS,CAAC1B,QAAQ,YAAYnB,UAAU,EAAE;MAC5C,KAAK,IAAIkE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGrB,SAAS,CAAC1B,QAAQ,CAACgD,OAAO,CAACC,MAAM,EAAEF,CAAC,EAAE,EAAE;QAC1D,MAAMG,MAAM,GAAGxB,SAAS,CAAC1B,QAAQ,CAACgD,OAAO,CAACD,CAAC,CAAC;QAC5CpC,OAAO,CAACE,MAAM,CAACqC,MAAM,CAACC,IAAI,KAAKxE,SAAS,CAACuB,MAAM,EAAEgD,MAAM,CAAC;QAExD,MAAME,IAAI,GAAG,GAAG9B,QAAQ,CAACc,IAAI,IAAIV,SAAS,CAACU,IAAI,IAAIc,MAAM,CAACd,IAAI,EAAE;QAChE,MAAMF,aAAa,GAAGzD,SAAS,CAACyD,aAAa,CAC3C7C,KAAK,CAAC8C,WAAW,EAAE,EACnBiB,IAAI,CAACjB,WAAW,EAAE,CACnB;QACD,MAAMQ,EAAE,GACN,CAACtD,KAAK,KAAK,EAAE,IAAI6C,aAAa,KAAKgB,MAAM,CAACC,IAAI,KAAKrD,YAAY;QACjE,IAAI6C,EAAE,EAAE;UACN,MAAM;YACJpC,IAAI,EAAE6C,IAAI;YACV3C,eAAe,EAAEA,CAAA,KAAM,IAAI,CAACf,cAAc,CAAC2D,wBAAwB,CAAC3B,SAAS,CAAC4B,WAAW,EAAE,EAAEP,CAAC;WAC/F;;;;IAKP,MAAMJ,EAAE,GACN,CAACtD,KAAK,KAAK,EAAE,IAAI6C,aAAa,MAC7BR,SAAS,CAAC1B,QAAQ,KAAKF,YAAY,IAClCA,YAAY,KAAKnB,SAAS,CAAC0B,YAAY,CAAC,IAC1CqB,SAAS,CAAC1B,QAAQ,KAAKrB,SAAS,CAAC0B,YAAY;IAC/C,IAAI,CAACsC,EAAE,EAAE;IAET,MAAMY,QAAQ,GAAG,IAAI,CAACrE,IAAI,CAAC6B,mBAAmB,CAACuC,WAAW,CAAC5B,SAAS,CAAC;IACrE,MAAM;MACJnB,IAAI,EAAE,GAAGe,QAAQ,CAACc,IAAI,IAAIV,SAAS,CAACU,IAAI,EAAE;MAC1C3B,eAAe,EAAEA,CAAA,KAAM,IAAI,CAACf,cAAc,CAAC8D,YAAY,CAACD,QAAQ;KACjE;EACH;EAEAE,aAAaA,CAAA;IACX,OAAO,IAAI,CAACnE,UAAU;EACxB;EAEAoE,aAAaA,CAAA;IACX,OAAO,EAAE;EACX;EAEAC,QAAQA,CAAA;IACN,OAAO,IAAI,CAACtE,KAAK;EACnB;EAEAuE,cAAcA,CAAA;IACZ,OAAO,IAAI,CAACzE,WAAW;EACzB;EAEO0E,4BAA4BA,CAACnC,SAAc;IAChD,MAAM6B,QAAQ,GAAG,IAAI,CAACrE,IAAI,CAAC6B,mBAAmB,CAACuC,WAAW,CAAC5B,SAAS,CAAC;IACrE,MAAMoC,IAAI,GAAG,IAAI,CAAC5E,IAAI,CAACQ,cAAc,CAACqE,QAAQ,CAACR,QAAQ,EAAE,CAAC,CAAC;IAC3D,OAAO,IAAI,CAACS,uBAAuB,CAACF,IAAI,CAAC;EAC3C;EAEAG,mBAAmBA,CAACvC,SAAc;IAChC,OAAO,IAAI,CAACmC,4BAA4B,CAACnC,SAAS,CAAC,CAChDwC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAChBC,IAAI,CAAC,EAAE,CAAC;EACb;EAEAC,YAAYA,CAAA;IACV,OAAO,IAAI,CAAC/E,SAAS;EACvB;EAEQyE,uBAAuBA,CAACO,OAAO;IACrC,MAAMrF,IAAI,GAAG,IAAI,CAACA,IAAI;IACtB,IAAIqF,OAAO,CAACC,QAAQ,KAAK,QAAQ,EAAE;MACjC,OAAOxF,GAAG,CAACyF,mBAAmB,CAACF,OAAO,CAACG,KAAK,CAAClE,QAAQ,EAAE,EAAE+D,OAAO,CAAC;KAClE,MAAM,IACLA,OAAO,CAACC,QAAQ,KAAK,QAAQ,IAC7BD,OAAO,CAACvE,QAAQ,CAAC2E,EAAE,KAAK9F,UAAU,CAAC+F,kBAAkB,CAACC,MAAM,CAACF,EAAE,EAC/D;MACAhE,OAAO,CAACE,MAAM,CACZ3B,IAAI,CAACQ,cAAc,CAACoF,WAAW,CAACP,OAAO,CAAC,CAACQ,OAAO,EAAE,CAAC9B,MAAM,IAAI,CAAC,EAC9D,sBAAsB,CACvB;MACDtC,OAAO,CAACE,MAAM,CAAC0D,OAAO,CAAC;MACvB,MAAMS,KAAK,GAAG9F,IAAI,CAACQ,cAAc,CAACqE,QAAQ,CAACQ,OAAO,EAAE,CAAC,CAAC;MACtD,MAAMU,KAAK,GAAG/F,IAAI,CAACQ,cAAc,CAACqE,QAAQ,CAACQ,OAAO,EAAE,CAAC,CAAC;MACtD,IAAI1E,MAAM,GAAG,EAAS;MACtBA,MAAM,CAACS,IAAI,CAAC;QAAE8D,IAAI,EAAE,GAAG;QAAEN,IAAI,EAAES;MAAO,CAAE,CAAC;MACzC1E,MAAM,GAAGA,MAAM,CAACqF,MAAM,CAAC,IAAI,CAAClB,uBAAuB,CAACgB,KAAK,CAAC,CAAC;MAC3DnF,MAAM,CAACS,IAAI,CAAC;QAAE8D,IAAI,EAAE,GAAG;QAAEN,IAAI,EAAE;MAAI,CAAE,CAAC;MACtCjE,MAAM,GAAGA,MAAM,CAACqF,MAAM,CAAC,IAAI,CAAClB,uBAAuB,CAACiB,KAAK,CAAC,CAAC;MAC3DpF,MAAM,CAACS,IAAI,CAAC;QAAE8D,IAAI,EAAE,GAAG;QAAEN,IAAI,EAAE;MAAI,CAAE,CAAC;MACtC,OAAOjE,MAAM;KACd,MAAM,IAAI0E,OAAO,CAACC,QAAQ,KAAK,WAAW,EAAE;MAC3C,OAAOxF,GAAG,CAACyF,mBAAmB,CAC5BzF,GAAG,CAACmG,iBAAiB,CAACZ,OAAO,EAAErF,IAAI,CAAC,EACpCqF,OAAO,CACR;KACF,MAAM,IAAIA,OAAO,CAACC,QAAQ,KAAK,UAAU,EAAE;MAC1C,MAAMY,OAAO,GAAGpG,GAAG,CAACqG,WAAW,CAACd,OAAO,EAAErF,IAAI,CAAC;MAC9C,MAAMoG,QAAQ,GAAGC,KAAK,CAACC,IAAI,CAACtG,IAAI,CAACQ,cAAc,CAACoF,WAAW,CAACP,OAAO,CAAC,CAAC;MACrE,IAAI1E,MAAM,GAAG,EAAS;MACtBA,MAAM,GAAGA,MAAM,CAACqF,MAAM,CAAClG,GAAG,CAACyF,mBAAmB,CAACW,OAAO,EAAEb,OAAO,CAAC,CAAC;MACjE1E,MAAM,CAACS,IAAI,CAAC;QAAE8D,IAAI,EAAE,GAAG;QAAEN,IAAI,EAAE;MAAI,CAAE,CAAC;MACtC,KAAK,IAAIf,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuC,QAAQ,CAACrC,MAAM,EAAEF,CAAC,EAAE,EAAE;QACxC,MAAM0C,KAAK,GAAGH,QAAQ,CAACvC,CAAC,CAAC;QACzB,IAAIA,CAAC,KAAK,CAAC,EAAE;UACXlD,MAAM,CAACS,IAAI,CAAC;YAAE8D,IAAI,EAAE,GAAG;YAAEN,IAAI,EAAE;UAAI,CAAE,CAAC;;QAExCjE,MAAM,GAAGA,MAAM,CAACqF,MAAM,CAAC,IAAI,CAAClB,uBAAuB,CAACyB,KAAK,CAAC,CAAC;;MAE7D5F,MAAM,CAACS,IAAI,CAAC;QAAE8D,IAAI,EAAE,GAAG;QAAEN,IAAI,EAAE;MAAI,CAAE,CAAC;MACtC,OAAOjE,MAAM;KACd,MAAM,IAAI0E,OAAO,CAACC,QAAQ,KAAK,UAAU,EAAE;MAC1C7D,OAAO,CAAC+E,KAAK,CAAC,sCAAsC,CAAC;KACtD,MAAM,IAAInB,OAAO,CAACC,QAAQ,KAAK,MAAM,EAAE;MACtC,OAAOxF,GAAG,CAACyF,mBAAmB,CAAC,MAAM,EAAEF,OAAO,CAAC;KAChD,MAAM,IAAGA,OAAO,CAACC,QAAQ,KAAG,uBAAuB,EAAC;MACnD,OAAOxF,GAAG,CAACyF,mBAAmB,CAACzF,GAAG,CAAC2G,6BAA6B,CAACpB,OAAO,CAAC,EAAEA,OAAO,CAAC;KACpF,MAAM;MACL5D,OAAO,CAAC+E,KAAK,CAAC,gCAAgC,CAAC;;EAEnD;EAEOE,cAAcA,CAAC9B,IAAI;IACxB,MAAMpC,SAAS,GAAG,IAAI,CAACxC,IAAI,CAAC6B,mBAAmB,CAACC,mBAAmB,CAAC8C,IAAI,CAAC;IACzE,MAAM+B,aAAa,GAAG,IAAI,CAAChC,4BAA4B,CAACnC,SAAS,CAAC;IAClE,IAAI,CAACnC,SAAS,GAAGP,GAAG,CAAC8G,oBAAoB,CACvChC,IAAI,EACJ+B,aAAa,EACbnE,SAAU,CAACiD,EAAE,CACd;EACH;EAEO5E,cAAcA,CAAA;IACnB,MAAMR,SAAS,GAAG,IAAI,CAAC+E,YAAY,EAAE;IACrC,IAAI/E,SAAS,KAAK,IAAI,EAAE,OAAO,IAAI;IAEnC,MAAMmC,SAAS,GAAG,IAAI,CAACxC,IAAI,CAAC6B,mBAAmB,CAACgF,kBAAkB,CAChExG,SAAS,CAACyG,WAAW,CACtB;IACD,MAAMH,aAAa,GAAG,IAAI,CAAChC,4BAA4B,CAACnC,SAAS,CAAC;IAClE,OAAOmE,aAAa,CAACtG,SAAS,CAAC0G,UAAU,CAAC,CAACnC,IAAI;EACjD;EAEQ,OAAOqB,iBAAiBA,CAACe,aAAa,EAAEhH,IAAI;IAClD,MAAMiH,UAAU,GAAGjH,IAAI,CAACS,SAAS,CAACyG,yBAAyB,CAACF,aAAa,CAAC;IAC1E,OAAOhH,IAAI,CAACmH,cAAc,CAACrF,mBAAmB,CAACmF,UAAU,CAAC,CAAC/D,IAAI;EACjE;EAEQ,OAAOuD,6BAA6BA,CAAC7B,IAAI;IAC/C,MAAMqC,UAAU,GAAGrH,IAAI,CAACwH,SAAS,CAACxC,IAAI,CAACyC,oBAAoB,CAAC;IAC5D,MAAMC,UAAU,GAAGL,UAAU,CAACnG,QAAQ,CAACgD,OAAO,CAACc,IAAI,CAAC2C,WAAW,CAAC,CAACrE,IAAI;IACrE,MAAMsE,aAAa,GAAG9H,SAAS,CAACoC,mBAAmB,CAACmF,UAAU,CAAC,CAAC/D,IAAI;IACpE,OAAM,GAAGsE,aAAa,IAAIF,UAAU,EAAE;EACxC;EAEQ,OAAOnB,WAAWA,CAACsB,OAAO,EAAEzH,IAAI;IACtC,MAAM6C,OAAO,GAAG7C,IAAI,CAAC8C,YAAY,CAAC4E,WAAW,CAACD,OAAO,CAACE,WAAW,CAAC;IAClE,OAAO9E,OAAO,CAACK,IAAI;EACrB;EAEQ,OAAOqC,mBAAmBA,CAAClE,IAAI,EAAEgE,OAAO;IAC9C,OAAOhE,IAAI,CAACuG,KAAK,CAAC,EAAE,CAAC,CAAC5C,GAAG,CAACC,CAAC,KAAK;MAC9BC,IAAI,EAAED,CAAC;MACPL,IAAI,EAAES;KACP,CAAC,CAAC;EACL;EAEQ,OAAOwC,oBAAoBA,CAACxC,OAAO,EAAEsB,aAAa;IACxD,IAAII,UAAU,GAAG,IAAqB;IACtC,KAAK,IAAIlD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG8C,aAAa,CAAC5C,MAAM,EAAEF,CAAC,EAAE,EAAE;MAC7C,IAAI8C,aAAa,CAAC9C,CAAC,CAAC,CAACe,IAAI,KAAKS,OAAO,EAAE;QACrC0B,UAAU,GAAGlD,CAAC;QACd;;;IAIJ,IAAIiE,QAAQ,GAAG,IAAqB;IACpC,KAAK,IAAIjE,CAAC,GAAG8C,aAAa,CAAC5C,MAAM,EAAEF,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAE;MAC7C,IAAI8C,aAAa,CAAC9C,CAAC,GAAG,CAAC,CAAC,CAACe,IAAI,KAAKS,OAAO,EAAE;QACzCyC,QAAQ,GAAGjE,CAAC;QACZ;;;IAGJpC,OAAO,CAACE,MAAM,CAACoF,UAAU,KAAK,IAAI,CAAC;IACnCtF,OAAO,CAACE,MAAM,CAACmG,QAAQ,KAAK,IAAI,CAAC;IACjC,OAAO;MAAEf,UAAU;MAAEe;IAAQ,CAAY;EAC3C;EAEA;EAEAC,WAAWA,CAACC,KAAK;IACfC,MAAM,CAACC,MAAM,CAAC,IAAI,EAAEF,KAAK,CAAC;EAC5B;EAEAG,aAAaA,CAAC/H,UAAU;IACtB,IAAI,CAACA,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACA,UAAU,EAAE;MACf,IAAI,CAACgI,QAAQ,CAAC,EAAE,CAAC;;EAErB;EAEAC,YAAYA,CAAChI,SAA2B;IACtC,IAAI,CAACA,SAAS,GAAG,IAAI,CAACiI,aAAa,CAACjI,SAAS,EAAE,IAAI,CAACA,SAAS,CAAC;EAChE;EAEQiI,aAAaA,CACnBjI,SAA2B,EAC3BkI,aAA+B;IAE/B,IAAIlI,SAAS,KAAK,IAAI,EAAE,OAAO,IAAI;IAEnC,MAAMmC,SAAS,GAAG,IAAI,CAACxC,IAAI,CAAC6B,mBAAmB,CAACgF,kBAAkB,CAChExG,SAAS,CAACyG,WAAW,CACtB;IACD,MAAMH,aAAa,GAAG,IAAI,CAAChC,4BAA4B,CAACnC,SAAS,CAAC;IAClEf,OAAO,CAACE,MAAM,CAACtB,SAAS,CAAC0G,UAAU,IAAI,CAAC,CAAC;IACzCtF,OAAO,CAACE,MAAM,CAACtB,SAAS,CAACyH,QAAQ,IAAInB,aAAa,CAAC5C,MAAM,CAAC;IAE1D,IACEjE,GAAG,CAAC0I,yBAAyB,CAACD,aAAa,EAAElI,SAAS,EAAEsG,aAAa,CAAC,EACtE;MACA,IAAI/B,IAAI;MACR,IAAI9E,GAAG,CAAC2I,SAAS,CAACF,aAAa,EAAElI,SAAS,CAAC,EAAE;QAAA,IAAAqI,KAAA;QAC3C9D,IAAI,GAAG+B,aAAa,CAACtG,SAAS,CAAC0G,UAAU,CAAC,CAACnC,IAAI;QAC/CA,IAAI,IAAA8D,KAAA,GACF9D,IAAI,cAAA8D,KAAA,cAAAA,KAAA,GAAI5I,GAAG,CAAC6I,mBAAmB,CAACtI,SAAS,CAAC0G,UAAU,EAAEJ,aAAa,CAAC;OACvE,MAAM;QACL/B,IAAI,GAAG9E,GAAG,CAAC6I,mBAAmB,CAACtI,SAAS,CAAC0G,UAAU,EAAEJ,aAAa,CAAC;;MAErE,OAAO7G,GAAG,CAAC8G,oBAAoB,CAC7BhC,IAAI,EACJ+B,aAAa,EACbtG,SAAS,CAACyG,WAAW,CACtB;KACF,MAAM;MAAA,IAAA8B,qBAAA,EAAAC,sBAAA;MACL,MAAMjE,IAAI,IAAAgE,qBAAA,IAAAC,sBAAA,GAAGlC,aAAa,CAACtG,SAAS,CAAC0G,UAAU,CAAC,cAAA8B,sBAAA,uBAAnCA,sBAAA,CAAqCjE,IAAI,cAAAgE,qBAAA,cAAAA,qBAAA,GAAI,IAAI;MAC9D,IAAIhE,IAAI,KAAK,IAAI,EAAE;QACjB,IAAI9E,GAAG,CAAC2I,SAAS,CAACF,aAAa,EAAElI,SAAS,CAAC,EAAE;UAC3C,MAAMyI,QAAQ,GAAGhJ,GAAG,CAAC6I,mBAAmB,CACtCtI,SAAS,CAAC0G,UAAU,EACpBJ,aAAa,CACd;UACD,OAAO7G,GAAG,CAAC8G,oBAAoB,CAC7BkC,QAAQ,EACRnC,aAAa,EACbtG,SAAS,CAACyG,WAAW,CACtB;SACF,MAAM;UACL;UACA,MAAMiC,SAAS,GAAGjJ,GAAG,CAACkJ,oBAAoB,CACxC3I,SAAS,CAAC0G,UAAU,EACpBJ,aAAa,CACd;UACD,IAAIoC,SAAS,KAAK,IAAI,EAAE;YACtB,MAAMD,QAAQ,GAAGhJ,GAAG,CAAC6I,mBAAmB,CACtCtI,SAAS,CAAC0G,UAAU,EACpBJ,aAAa,CACd;YACD,OAAO7G,GAAG,CAAC8G,oBAAoB,CAC7BkC,QAAQ,EACRnC,aAAa,EACbtG,SAAS,CAACyG,WAAW,CACtB;WACF,MAAM;YACL,OAAOhH,GAAG,CAACmJ,yBAAyB,CAClCF,SAAS,EACTpC,aAAa,EACbtG,SAAS,CAACyG,WAAW,CACtB;;;OAGN,MAAM;QACL,IAAIhH,GAAG,CAACoJ,iBAAiB,CAAC7I,SAAS,CAAC0G,UAAU,EAAEnC,IAAI,EAAE+B,aAAa,CAAC,EAAE;UACpE,OAAO7G,GAAG,CAAC8G,oBAAoB,CAC7BhC,IAAI,EACJ+B,aAAa,EACbtG,SAAS,CAACyG,WAAW,CACtB;SACF,MAAM;UACL,OAAOhH,GAAG,CAACmJ,yBAAyB,CAClCrE,IAAI,EACJ+B,aAAa,EACbtG,SAAS,CAACyG,WAAW,CACtB;;;;EAIT;EAEQ,OAAO0B,yBAAyBA,CACtCD,aAA+B,EAC/BlI,SAAoB,EACpBsG,aAA8B;IAE9B,IAAI4B,aAAa,KAAK,IAAI,EAAE,OAAO,KAAK;IACxC,IAAIA,aAAa,CAACzB,WAAW,KAAKzG,SAAS,CAACyG,WAAW,EAAE,OAAO,KAAK;IAErE,MAAMqC,UAAU,GAAGC,IAAI,CAACC,GAAG,CAAChJ,SAAS,CAAC0G,UAAU,EAAEwB,aAAa,CAACxB,UAAU,CAAC;IAC3E,MAAMuC,SAAS,GAAGF,IAAI,CAACG,GAAG,CAAClJ,SAAS,CAAC0G,UAAU,EAAEwB,aAAa,CAACxB,UAAU,CAAC;IAC1E,MAAMnC,IAAI,GAAG+B,aAAa,CAACwC,UAAU,CAAC,CAACvE,IAAI;IAC3C,IAAIA,IAAI,KAAK,IAAI,EAAE,OAAO,KAAK;IAE/B,MAAM4E,cAAc,GAAGjB,aAAa,CAACxB,UAAU,KAAKwB,aAAa,CAACT,QAAQ;IAC1E,MAAM2B,iBAAiB,GAAGpJ,SAAS,CAAC0G,UAAU,KAAK1G,SAAS,CAACyH,QAAQ;IAErE,MAAM4B,iBAAiB,GAAG5J,GAAG,CAAC+H,oBAAoB,CAACjD,IAAI,EAAE+B,aAAa,CAAC;IACvE,MAAMgD,YAAY,GAChBD,iBAAiB,CAAC5B,QAAQ,GAAG4B,iBAAiB,CAAC3C,UAAU,KAAK,CAAC;IACjE,MAAM6C,eAAe,GACnBT,UAAU,KAAKO,iBAAiB,CAAC3C,UAAU,IAC3CuC,SAAS,KAAKI,iBAAiB,CAAC5B,QAAQ;IAE1C,OACE0B,cAAc,IAAIC,iBAAiB,IAAIE,YAAY,IAAIC,eAAe;EAE1E;EAEQ,OAAOV,iBAAiBA,CAACW,SAAS,EAAEjF,IAAI,EAAE+B,aAAa;IAC7D,MAAM+C,iBAAiB,GAAG5J,GAAG,CAAC+H,oBAAoB,CAACjD,IAAI,EAAE+B,aAAa,CAAC;IACvE,OACEkD,SAAS,GAAGH,iBAAiB,CAAC3C,UAAU,IACxC8C,SAAS,GAAGH,iBAAiB,CAAC5B,QAAQ;EAE1C;EAEQ,OAAOW,SAASA,CAACF,aAAa,EAAElI,SAAS;IAC/C,IAAIkI,aAAa,KAAK,IAAI,EAAE,OAAO,KAAK;IACxC,IAAIA,aAAa,CAACzB,WAAW,KAAKzG,SAAS,CAACyG,WAAW,EAAE,OAAO,KAAK;IACrE,IAAIzG,SAAS,CAAC0G,UAAU,GAAGwB,aAAa,CAACxB,UAAU,EAAE,OAAO,IAAI;IAChE,IAAI1G,SAAS,CAAC0G,UAAU,GAAGwB,aAAa,CAACxB,UAAU,EAAE,OAAO,KAAK;IACjE,IAAI1G,SAAS,CAACyH,QAAQ,GAAGS,aAAa,CAACT,QAAQ,EAAE,OAAO,IAAI;IAC5D,OAAO,KAAK;EACd;EAEQ,OAAOa,mBAAmBA,CAACmB,KAAK,EAAEnD,aAA8B;IACtE,IAAI/B,IAAI,GAAG,IAAI;IACf,KAAK,IAAIf,CAAC,GAAGiG,KAAK,GAAG,CAAC,EAAEjG,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;MACnCe,IAAI,GAAG+B,aAAa,CAAC9C,CAAC,CAAC,CAACe,IAAI;MAC5B,IAAIA,IAAI,KAAK,IAAI,EAAE;QACjB;;;IAGJ,OAAOA,IAAI;EACb;EAEQ,OAAOoE,oBAAoBA,CAACc,KAAK,EAAEnD,aAA8B;IACvE,IAAI/B,IAAI,GAAG,IAAI;IACf,KAAK,IAAIf,CAAC,GAAGiG,KAAK,EAAEjG,CAAC,GAAG8C,aAAa,CAAC5C,MAAM,EAAEF,CAAC,EAAE,EAAE;MACjDe,IAAI,GAAG+B,aAAa,CAAC9C,CAAC,CAAC,CAACe,IAAI;MAC5B,IAAIA,IAAI,KAAK,IAAI,EAAE;QACjB;;;IAGJ,OAAOA,IAAI;EACb;EAEQ,OAAOgC,oBAAoBA,CAAChC,IAAI,EAAE+B,aAAa,EAAEG,WAAW;IAClE,OAAO;MAAE,GAAGhH,GAAG,CAAC+H,oBAAoB,CAACjD,IAAI,EAAE+B,aAAa,CAAC;MAAEG;IAAW,CAAE;EAC1E;EAEQ,OAAOmC,yBAAyBA,CAACrE,IAAI,EAAE+B,aAAa,EAAEG,WAAW;IACvE,MAAM4C,iBAAiB,GAAG5J,GAAG,CAAC+H,oBAAoB,CAACjD,IAAI,EAAE+B,aAAa,CAAC;IACvE,OAAO;MACLI,UAAU,EAAE2C,iBAAiB,CAAC3C,UAAU;MACxCe,QAAQ,EAAE4B,iBAAiB,CAAC3C,UAAU;MACtCD;KACD;EACH;EAEAsB,QAAQA,CAACjI,KAAK;IACZ,IAAI,CAACA,KAAK,GAAGA,KAAK;EACpB;EAEA4J,gBAAgBA,CAACnH,UAAU;IACzB,MAAMgC,IAAI,GAAGhC,UAAU,CAACrB,eAAe,EAAE;IACzC,MAAMyF,aAAa,GAAG,IAAI,CAACnG,cAAc,EAAE;IAC3C,MAAM2B,SAAS,GAAG,IAAI,CAACxC,IAAI,CAAC6B,mBAAmB,CAACgF,kBAAkB,CAChE,IAAI,CAACzB,YAAY,EAAG,CAAC0B,WAAW,CACpB;IAEd,MAAMkD,uBAAuB,GAAGxH,SAAS,CAAC1B,QAAQ,KAAKrB,SAAS,CAAC0B,YAAY;IAC7E,IAAI6I,uBAAuB,EAAE;MAC3BvI,OAAO,CAACE,MAAM,CAAC/B,IAAI,CAACiF,QAAQ,CAACrC,SAAS,CAAC4B,WAAW,EAAE,EAAC,CAAC,CAAC,CAACqB,EAAE,KAAKuB,aAAa,CAACvB,EAAE,CAAC;MAChFhE,OAAO,CAACE,MAAM,CAACqF,aAAa,CAAClG,QAAQ,KAAKrB,SAAS,CAAC0B,YAAY,EAAE6F,aAAa,CAAC;;IAGlF,IAAI,IAAI,CAACiD,iBAAiB,EAAE,IAAI,CAACD,uBAAuB,EAAE;MACxD,IAAI,CAACxJ,cAAc,CAAC0J,kBAAkB,CAAClD,aAAa,EAAEpC,IAAI,CAAC;KAC5D,MAAM;MACL,IAAI,CAACpE,cAAc,CAAC2J,WAAW,CAACnD,aAAa,EAAEpC,IAAI,CAAC;;IAGtD,IAAIoF,uBAAuB,EAAE;MAC3BxH,SAAS,CAAC1B,QAAQ,GAAG8D,IAAI,CAAC9D,QAAQ;MAClC0B,SAAS,CAAC4B,WAAW,EAAE,CAACtD,QAAQ,GAAG8D,IAAI,CAAC9D,QAAQ;;IAGlD,MAAM6F,aAAa,GAAG,IAAI,CAAChC,4BAA4B,CAACnC,SAAS,CAAC;IAClE,IAAI,CAACnC,SAAS,GAAGP,GAAG,CAAC8G,oBAAoB,CACvChC,IAAI,EACJ+B,aAAa,EACbnE,SAAU,CAACiD,EAAE,CACd;IACD,IAAI,CAAC2E,eAAe,EAAE;IACtB,IAAI,CAACA,eAAe,EAAE;IAEtB,IAAI,CAAC9J,MAAM,CAAC+J,IAAI,CAAC,gBAAgB,CAAC;EACpC;EAEQD,eAAeA,CAAA;IACrB,MAAM/J,SAAS,GAAG,IAAI,CAACA,SAAsB;IAC7C,MAAMsG,aAAa,GAAG,IAAI,CAAChC,4BAA4B,CACrD,IAAI,CAAC2F,oBAAoB,EAAE,CAC5B;IACD,MAAMR,KAAK,GAAGV,IAAI,CAACC,GAAG,CAAChJ,SAAS,CAACyH,QAAQ,EAAEnB,aAAa,CAAC5C,MAAM,CAAC;IAChE,IAAI,CAACsE,YAAY,CAAC;MAChB,GAAGhI,SAAS;MACZ0G,UAAU,EAAE+C,KAAK;MACjBhC,QAAQ,EAAEgC;KACX,CAAC;EACJ;EAEAS,yBAAyBA,CAAA;IACvB9I,OAAO,CAACE,MAAM,CAAC,CAAC,IAAI,CAAC4C,aAAa,EAAE,CAAC;IACrC,MAAMK,IAAI,GAAG,IAAI,CAAC/D,cAAc,EAAE;IAClCY,OAAO,CAACE,MAAM,CAACiD,IAAI,IAAI,IAAI,CAAC;IAE5B,MAAMpC,SAAS,GAAG,IAAI,CAAC8H,oBAAoB,EAAE;IAC7C,MAAMjG,QAAQ,GAAG,IAAI,CAACrE,IAAI,CAAC6B,mBAAmB,CAACuC,WAAW,CAAC5B,SAAS,CAAC;IACrE,IAAIoC,IAAI,CAAC9D,QAAQ,KAAKuD,QAAQ,CAACvD,QAAQ,EAAE;MACvC,IAAI,CAACN,cAAc,CAACgK,QAAQ,CAAC;QAC3BjE,KAAK,EAAE3B,IAAI;QACX6F,SAAS,EAAEpG,QAAQ;QACnBqG,UAAU,EAAE;OACb,CAAC;MACF,MAAM/D,aAAa,GAAG,IAAI,CAAChC,4BAA4B,CAACnC,SAAS,CAAC;MAClE,IAAI,CAACnC,SAAS,GAAGP,GAAG,CAAC8G,oBAAoB,CACvChC,IAAI,EACJ+B,aAAa,EACbnE,SAAU,CAACiD,EAAE,CACd;MACD,IAAI,CAACnF,MAAM,CAAC+J,IAAI,CAAC,gBAAgB,CAAC;;EAEtC;EAEOJ,iBAAiBA,CAAA;IACtB,MAAM5J,SAAS,GAAG,IAAI,CAAC+E,YAAY,EAAe;IAClD3D,OAAO,CAACE,MAAM,CAACtB,SAAS,KAAK,IAAI,CAAC;IAClC,MAAMsK,qBAAqB,GAAGtK,SAAS,CAAC0G,UAAU,KAAK1G,SAAS,CAACyH,QAAQ;IACzE,OAAO6C,qBAAqB;EAC9B;EAEOL,oBAAoBA,CAAA;IACzB7I,OAAO,CAACE,MAAM,CAAC,IAAI,CAACyD,YAAY,EAAE,KAAK,IAAI,CAAC;IAC5C,OAAO,IAAI,CAACpF,IAAI,CAAC6B,mBAAmB,CAACgF,kBAAkB,CACrD,IAAI,CAACzB,YAAY,EAAG,CAAC0B,WAAW,CACjC;EACH;EAEA8D,qBAAqBA,CAAA;IACnB,IAAI,CAACb,gBAAgB,CAAC,IAAI,CAACrJ,cAAc,EAAE,CAACmK,IAAI,EAAE,CAACrF,KAAK,CAAC;EAC3D","ignoreList":[]}]}